// src/core/constants.js
var PLANETARY_ORBS = {
  sun: 10,
  // User specified: 10째
  moon: 3,
  // User specified: 3째 (Strict)
  mercury: 5,
  // Standard
  venus: 5,
  // Standard
  mars: 5,
  // Standard
  jupiter: 6,
  // Reduced from 9
  saturn: 8,
  // Updated to 8 per Part 2 transcript
  uranus: 4,
  // Reduced from 5
  neptune: 4,
  // Reduced from 5
  pluto: 2,
  // User specified: 2째 (Strict Limit)
  chiron: 1.5,
  // User specified: 1.5째 (Asteroid)
  meanLilith: 1.5,
  // Asteroid/Point
  trueLilith: 1.5
  // Asteroid/Point
};
var PLANETARY_TIERS = {
  ultrapersonal: ["sun", "moon"],
  personal: ["mercury", "venus"],
  extrapersonal: ["mars"],
  transpersonal: ["jupiter", "saturn"],
  metapersonal: ["uranus", "neptune", "pluto"],
  other: ["chiron", "meanLilith", "trueLilith"]
};
var PLANET_TO_TIER = {
  sun: "ultrapersonal",
  moon: "ultrapersonal",
  mercury: "personal",
  venus: "personal",
  mars: "extrapersonal",
  jupiter: "transpersonal",
  saturn: "transpersonal",
  uranus: "metapersonal",
  neptune: "metapersonal",
  pluto: "metapersonal",
  chiron: "other",
  meanLilith: "other",
  trueLilith: "other"
};
var ZODIAC_SIGNS = [
  "aries",
  "taurus",
  "gemini",
  "cancer",
  "leo",
  "virgo",
  "libra",
  "scorpio",
  "sagittarius",
  "capricorn",
  "aquarius",
  "pisces"
];
var SIGN_SYMBOLS = {
  aries: "\u2648",
  taurus: "\u2649",
  gemini: "\u264A",
  cancer: "\u264B",
  leo: "\u264C",
  virgo: "\u264D",
  libra: "\u264E",
  scorpio: "\u264F",
  sagittarius: "\u2650",
  capricorn: "\u2651",
  aquarius: "\u2652",
  pisces: "\u2653"
};
var PLANET_SYMBOLS = {
  sun: "\u2609",
  moon: "\u263D",
  mercury: "\u263F",
  venus: "\u2640",
  mars: "\u2642",
  jupiter: "\u2643",
  saturn: "\u2644",
  uranus: "\u2645",
  neptune: "\u2646",
  pluto: "\u2647",
  chiron: "\u26B7",
  meanLilith: "\u26B8",
  trueLilith: "\u26B8"
};
var SIGN_RULERS = {
  aries: "mars",
  taurus: "venus",
  gemini: "mercury",
  cancer: "moon",
  leo: "sun",
  virgo: "mercury",
  libra: "venus",
  scorpio: "pluto",
  // Modern (Traditional: Mars)
  sagittarius: "jupiter",
  capricorn: "saturn",
  aquarius: "uranus",
  // Modern (Traditional: Saturn)
  pisces: "neptune"
  // Modern (Traditional: Jupiter)
};
var SIGN_ELEMENTS = {
  aries: "fire",
  leo: "fire",
  sagittarius: "fire",
  taurus: "earth",
  virgo: "earth",
  capricorn: "earth",
  gemini: "air",
  libra: "air",
  aquarius: "air",
  cancer: "water",
  scorpio: "water",
  pisces: "water"
};
var SIGN_MODALITIES = {
  aries: "cardinal",
  cancer: "cardinal",
  libra: "cardinal",
  capricorn: "cardinal",
  taurus: "fixed",
  leo: "fixed",
  scorpio: "fixed",
  aquarius: "fixed",
  gemini: "mutable",
  virgo: "mutable",
  sagittarius: "mutable",
  pisces: "mutable"
};
var MAJOR_ASPECTS = {
  conjunction: { degrees: 0, symbol: "\u260C", nature: "power", keyword: "TOGETHER", maxOrb: null },
  semiSextile: { degrees: 30, symbol: "\u26BA", nature: "growth", keyword: "HARD STOP", maxOrb: 2 },
  sextile: { degrees: 60, symbol: "\u26B9", nature: "companion", keyword: "COMPANION", maxOrb: 2 },
  quintile: { degrees: 72, symbol: "Q", nature: "creative", keyword: "CREATIVE MANIFESTOR", maxOrb: 2 },
  square: { degrees: 90, symbol: "\u25A1", nature: "growth", keyword: "CONFLICT/GROWTH", maxOrb: null },
  trine: { degrees: 120, symbol: "\u25B3", nature: "direct", keyword: "DIRECT EFFECT", maxOrb: null },
  biQuintile: { degrees: 144, symbol: "bQ", nature: "creative", keyword: "INTERNAL PROBLEM-SOLVER", maxOrb: 2 },
  quincunx: { degrees: 150, symbol: "\u26BB", nature: "toggle", keyword: "TOGGLE", maxOrb: 2 },
  opposition: { degrees: 180, symbol: "\u260D", nature: "balance", keyword: "COUNTERBALANCE", maxOrb: null }
};
var MOTION_STATES = {
  prograde: { name: "Prograde", description: "Normal forward motion - energy flows outward naturally" },
  pregrade: { name: "Pre-grade", description: "Slowing before retrograde - preparing for internal review" },
  retrograde: { name: "Retrograde", description: "Inward motion - internalized energy, review period" },
  postgrade: { name: "Post-grade", description: "Implementing after retrograde - integrating lessons learned" }
};
var DECANS = {
  aries: ["aries", "leo", "sagittarius"],
  taurus: ["taurus", "virgo", "capricorn"],
  gemini: ["gemini", "libra", "aquarius"],
  cancer: ["cancer", "scorpio", "pisces"],
  leo: ["leo", "sagittarius", "aries"],
  virgo: ["virgo", "capricorn", "taurus"],
  libra: ["libra", "aquarius", "gemini"],
  scorpio: ["scorpio", "pisces", "cancer"],
  sagittarius: ["sagittarius", "aries", "leo"],
  capricorn: ["capricorn", "taurus", "virgo"],
  aquarius: ["aquarius", "gemini", "libra"],
  pisces: ["pisces", "cancer", "scorpio"]
};
var HOUSE_THEMES = {
  1: {
    name: "Emergence/Vitality Anchor",
    keywords: ["physical body", "immediate reaction", "emergence", "survival style"],
    beginnerExplanation: 'The "Vitality Anchor"\u2014your physical body and your immediate reaction to the world. It is the style in which your authentic self first emerged into a potentially stressful reality.'
  },
  2: {
    name: "Internal Value/Resources",
    keywords: ["self-worth", "personal resources", "consumption", "survival security"],
    beginnerExplanation: 'Your "Internal Value." It is not just money, but your sense of self-worth that was forged in response to how you were valued as a child.'
  },
  3: {
    name: "Mental Identity/Local Field",
    keywords: ["processing style", "local environment", "early learning", "communication as safety"],
    beginnerExplanation: 'The "Local Field"\u2014how your mind learned to process information and communicate to navigate your immediate childhood environment.'
  },
  4: {
    name: "Emotional Foundations/Roots",
    keywords: ["mother attachment", "home environment", "private roots", "foundational safety"],
    beginnerExplanation: 'Your "Foundational Safety"\u2014the roots of your emotional world and your primary attachment (often the mother). It is the base from which you grow.'
  },
  5: {
    name: "Vitality Spark/Authentic Play",
    keywords: ["creative expression", "romance", "risk", "the inner child"],
    beginnerExplanation: 'The "Vitality Spark"\u2014where you seek to be "seen" and where your inner child expresses its authentic joy and creative risk.'
  },
  6: {
    name: "Daily Reality/Efficiency",
    keywords: ["routine", "daily work", "health as stress management", "service"],
    beginnerExplanation: 'The "Daily Reality"\u2014how you manage the survival burdens of life. It reveals your relationship to efficiency and how stress manifests in your daily routine.'
  },
  7: {
    name: "Submergence/The Mirror",
    keywords: ["partnership", "marriage", "contracts", "the other as reflection"],
    beginnerExplanation: 'The "Mirror of the Other"\u2014how you submerge your individual self into partnerships. It reveals your adaptations for maintaining attachment in one-on-one relationships.'
  },
  8: {
    name: "Intimacy/Deep Psychology",
    keywords: ["shared power", "intimacy", "transformation", "unconscious bonding"],
    beginnerExplanation: 'The "Deep Bond"\u2014where your ego dissolves into shared resources or psychological intimacy. It is where you face your deepest fears and transformations.'
  },
  9: {
    name: "Expansion/The Search for Meaning",
    keywords: ["philosophy", "higher learning", "belief systems", "flight from the local"],
    beginnerExplanation: 'The "Search for Meaning"\u2014your drive to expand beyond your early environment to find a larger philosophical or spiritual truth.'
  },
  10: {
    name: "Authority/Public Identity",
    keywords: ["career as status", "public reputation", "father energy", "legitimacy"],
    beginnerExplanation: 'The "Public Identity"\u2014how you seek legitimacy and authority in the world. It often reflects your adaptation to the expectations of "the father" or society.'
  },
  11: {
    name: "Community/Future Vision",
    keywords: ["hopes", "networks", "group attachment", "social contribution"],
    beginnerExplanation: 'The "Social Field"\u2014where you seek a sense of belonging in a larger community and how you envision your future contribution to the collective.'
  },
  12: {
    name: "The Subconscious/Sacred Isolation",
    keywords: ["hidden self", "spirituality", "dissolution", "undoing of ego"],
    beginnerExplanation: 'The "Sacred Isolation"\u2014the place where you keep what was "hidden" to survive. It is your direct line to the subconscious and the spiritual dissolution of the self.'
  }
};

// node_modules/astronomy-engine/esm/astronomy.js
var C_AUDAY = 173.1446326846693;
var KM_PER_AU = 14959787069098932e-8;
var DEG2RAD = 0.017453292519943295;
var RAD2DEG = 57.29577951308232;
var DAYS_PER_TROPICAL_YEAR = 365.24217;
var J2000 = /* @__PURE__ */ new Date("2000-01-01T12:00:00Z");
var PI2 = 2 * Math.PI;
var ARC = 3600 * (180 / Math.PI);
var ASEC2RAD = 484813681109536e-20;
var ASEC180 = 180 * 60 * 60;
var ASEC360 = 2 * ASEC180;
var AU_PER_PARSEC = ASEC180 / Math.PI;
var SUN_MAG_1AU = -0.17 - 5 * Math.log10(AU_PER_PARSEC);
var SECONDS_PER_DAY = 24 * 3600;
var MILLIS_PER_DAY = SECONDS_PER_DAY * 1e3;
var SUN_RADIUS_KM = 695700;
var SUN_RADIUS_AU = SUN_RADIUS_KM / KM_PER_AU;
var EARTH_FLATTENING = 0.996647180302104;
var EARTH_FLATTENING_SQUARED = EARTH_FLATTENING * EARTH_FLATTENING;
var EARTH_EQUATORIAL_RADIUS_KM = 6378.1366;
var EARTH_EQUATORIAL_RADIUS_AU = EARTH_EQUATORIAL_RADIUS_KM / KM_PER_AU;
var EARTH_POLAR_RADIUS_KM = EARTH_EQUATORIAL_RADIUS_KM * EARTH_FLATTENING;
var EARTH_MEAN_RADIUS_KM = 6371;
var EARTH_ATMOSPHERE_KM = 88;
var EARTH_ECLIPSE_RADIUS_KM = EARTH_MEAN_RADIUS_KM + EARTH_ATMOSPHERE_KM;
var MOON_EQUATORIAL_RADIUS_KM = 1738.1;
var MOON_EQUATORIAL_RADIUS_AU = MOON_EQUATORIAL_RADIUS_KM / KM_PER_AU;
var MOON_POLAR_RADIUS_KM = 1736;
var MOON_POLAR_RADIUS_AU = MOON_POLAR_RADIUS_KM / KM_PER_AU;
var REFRACTION_NEAR_HORIZON = 34 / 60;
var EARTH_MOON_MASS_RATIO = 81.30056;
var SUN_GM = 2959122082855911e-19;
var EARTH_GM = 8887692390113509e-25;
var JUPITER_GM = 2825345909524226e-22;
var SATURN_GM = 8459715185680659e-23;
var URANUS_GM = 1292024916781969e-23;
var NEPTUNE_GM = 1524358900784276e-23;
var MOON_GM = EARTH_GM / EARTH_MOON_MASS_RATIO;
function VerifyBoolean(b) {
  if (b !== true && b !== false) {
    console.trace();
    throw `Value is not boolean: ${b}`;
  }
  return b;
}
function VerifyNumber(x) {
  if (!Number.isFinite(x)) {
    console.trace();
    throw `Value is not a finite number: ${x}`;
  }
  return x;
}
function Frac(x) {
  return x - Math.floor(x);
}
var Body;
(function(Body2) {
  Body2["Sun"] = "Sun";
  Body2["Moon"] = "Moon";
  Body2["Mercury"] = "Mercury";
  Body2["Venus"] = "Venus";
  Body2["Earth"] = "Earth";
  Body2["Mars"] = "Mars";
  Body2["Jupiter"] = "Jupiter";
  Body2["Saturn"] = "Saturn";
  Body2["Uranus"] = "Uranus";
  Body2["Neptune"] = "Neptune";
  Body2["Pluto"] = "Pluto";
  Body2["SSB"] = "SSB";
  Body2["EMB"] = "EMB";
  Body2["Star1"] = "Star1";
  Body2["Star2"] = "Star2";
  Body2["Star3"] = "Star3";
  Body2["Star4"] = "Star4";
  Body2["Star5"] = "Star5";
  Body2["Star6"] = "Star6";
  Body2["Star7"] = "Star7";
  Body2["Star8"] = "Star8";
})(Body || (Body = {}));
var StarList = [
  Body.Star1,
  Body.Star2,
  Body.Star3,
  Body.Star4,
  Body.Star5,
  Body.Star6,
  Body.Star7,
  Body.Star8
];
var StarTable = [
  { ra: 0, dec: 0, dist: 0 },
  { ra: 0, dec: 0, dist: 0 },
  { ra: 0, dec: 0, dist: 0 },
  { ra: 0, dec: 0, dist: 0 },
  { ra: 0, dec: 0, dist: 0 },
  { ra: 0, dec: 0, dist: 0 },
  { ra: 0, dec: 0, dist: 0 },
  { ra: 0, dec: 0, dist: 0 }
];
function GetStar(body) {
  const index = StarList.indexOf(body);
  return index >= 0 ? StarTable[index] : null;
}
function UserDefinedStar(body) {
  const star = GetStar(body);
  return star && star.dist > 0 ? star : null;
}
var PrecessDirection;
(function(PrecessDirection2) {
  PrecessDirection2[PrecessDirection2["From2000"] = 0] = "From2000";
  PrecessDirection2[PrecessDirection2["Into2000"] = 1] = "Into2000";
})(PrecessDirection || (PrecessDirection = {}));
var vsop = {
  Mercury: [
    [
      [
        [4.40250710144, 0, 0],
        [0.40989414977, 1.48302034195, 26087.9031415742],
        [0.050462942, 4.47785489551, 52175.8062831484],
        [0.00855346844, 1.16520322459, 78263.70942472259],
        [0.00165590362, 4.11969163423, 104351.61256629678],
        [34561897e-11, 0.77930768443, 130439.51570787099],
        [7583476e-11, 3.71348404924, 156527.41884944518]
      ],
      [
        [26087.90313685529, 0, 0],
        [0.01131199811, 6.21874197797, 26087.9031415742],
        [0.00292242298, 3.04449355541, 52175.8062831484],
        [75775081e-11, 6.08568821653, 78263.70942472259],
        [19676525e-11, 2.80965111777, 104351.61256629678]
      ]
    ],
    [
      [
        [0.11737528961, 1.98357498767, 26087.9031415742],
        [0.02388076996, 5.03738959686, 52175.8062831484],
        [0.01222839532, 3.14159265359, 0],
        [0.0054325181, 1.79644363964, 78263.70942472259],
        [0.0012977877, 4.83232503958, 104351.61256629678],
        [31866927e-11, 1.58088495658, 130439.51570787099],
        [7963301e-11, 4.60972126127, 156527.41884944518]
      ],
      [
        [0.00274646065, 3.95008450011, 26087.9031415742],
        [99737713e-11, 3.14159265359, 0]
      ]
    ],
    [
      [
        [0.39528271651, 0, 0],
        [0.07834131818, 6.19233722598, 26087.9031415742],
        [0.00795525558, 2.95989690104, 52175.8062831484],
        [0.00121281764, 6.01064153797, 78263.70942472259],
        [21921969e-11, 2.77820093972, 104351.61256629678],
        [4354065e-11, 5.82894543774, 130439.51570787099]
      ],
      [
        [0.0021734774, 4.65617158665, 26087.9031415742],
        [44141826e-11, 1.42385544001, 52175.8062831484]
      ]
    ]
  ],
  Venus: [
    [
      [
        [3.17614666774, 0, 0],
        [0.01353968419, 5.59313319619, 10213.285546211],
        [89891645e-11, 5.30650047764, 20426.571092422],
        [5477194e-11, 4.41630661466, 7860.4193924392],
        [3455741e-11, 2.6996444782, 11790.6290886588],
        [2372061e-11, 2.99377542079, 3930.2096962196],
        [1317168e-11, 5.18668228402, 26.2983197998],
        [1664146e-11, 4.25018630147, 1577.3435424478],
        [1438387e-11, 4.15745084182, 9683.5945811164],
        [1200521e-11, 6.15357116043, 30639.856638633]
      ],
      [
        [10213.28554621638, 0, 0],
        [95617813e-11, 2.4640651111, 10213.285546211],
        [7787201e-11, 0.6247848222, 20426.571092422]
      ]
    ],
    [
      [
        [0.05923638472, 0.26702775812, 10213.285546211],
        [40107978e-11, 1.14737178112, 20426.571092422],
        [32814918e-11, 3.14159265359, 0]
      ],
      [
        [0.00287821243, 1.88964962838, 10213.285546211]
      ]
    ],
    [
      [
        [0.72334820891, 0, 0],
        [0.00489824182, 4.02151831717, 10213.285546211],
        [1658058e-11, 4.90206728031, 20426.571092422],
        [1378043e-11, 1.12846591367, 11790.6290886588],
        [1632096e-11, 2.84548795207, 7860.4193924392],
        [498395e-11, 2.58682193892, 9683.5945811164],
        [221985e-11, 2.01346696541, 19367.1891622328],
        [237454e-11, 2.55136053886, 15720.8387848784]
      ],
      [
        [34551041e-11, 0.89198706276, 10213.285546211]
      ]
    ]
  ],
  Earth: [
    [
      [
        [1.75347045673, 0, 0],
        [0.03341656453, 4.66925680415, 6283.0758499914],
        [34894275e-11, 4.62610242189, 12566.1516999828],
        [3417572e-11, 2.82886579754, 3.523118349],
        [3497056e-11, 2.74411783405, 5753.3848848968],
        [3135899e-11, 3.62767041756, 77713.7714681205],
        [2676218e-11, 4.41808345438, 7860.4193924392],
        [2342691e-11, 6.13516214446, 3930.2096962196],
        [1273165e-11, 2.03709657878, 529.6909650946],
        [1324294e-11, 0.74246341673, 11506.7697697936],
        [901854e-11, 2.04505446477, 26.2983197998],
        [1199167e-11, 1.10962946234, 1577.3435424478],
        [857223e-11, 3.50849152283, 398.1490034082],
        [779786e-11, 1.17882681962, 5223.6939198022],
        [99025e-10, 5.23268072088, 5884.9268465832],
        [753141e-11, 2.53339052847, 5507.5532386674],
        [505267e-11, 4.58292599973, 18849.2275499742],
        [492392e-11, 4.20505711826, 775.522611324],
        [356672e-11, 2.91954114478, 0.0673103028],
        [284125e-11, 1.89869240932, 796.2980068164],
        [242879e-11, 0.34481445893, 5486.777843175],
        [317087e-11, 5.84901948512, 11790.6290886588],
        [271112e-11, 0.31486255375, 10977.078804699],
        [206217e-11, 4.80646631478, 2544.3144198834],
        [205478e-11, 1.86953770281, 5573.1428014331],
        [202318e-11, 2.45767790232, 6069.7767545534],
        [126225e-11, 1.08295459501, 20.7753954924],
        [155516e-11, 0.83306084617, 213.299095438]
      ],
      [
        [6283.0758499914, 0, 0],
        [0.00206058863, 2.67823455808, 6283.0758499914],
        [4303419e-11, 2.63512233481, 12566.1516999828]
      ],
      [
        [8721859e-11, 1.07253635559, 6283.0758499914]
      ]
    ],
    [
      [],
      [
        [0.00227777722, 3.4137662053, 6283.0758499914],
        [3805678e-11, 3.37063423795, 12566.1516999828]
      ]
    ],
    [
      [
        [1.00013988784, 0, 0],
        [0.01670699632, 3.09846350258, 6283.0758499914],
        [13956024e-11, 3.05524609456, 12566.1516999828],
        [308372e-10, 5.19846674381, 77713.7714681205],
        [1628463e-11, 1.17387558054, 5753.3848848968],
        [1575572e-11, 2.84685214877, 7860.4193924392],
        [924799e-11, 5.45292236722, 11506.7697697936],
        [542439e-11, 4.56409151453, 3930.2096962196],
        [47211e-10, 3.66100022149, 5884.9268465832],
        [85831e-11, 1.27079125277, 161000.6857376741],
        [57056e-11, 2.01374292245, 83996.84731811189],
        [55736e-11, 5.2415979917, 71430.69561812909],
        [174844e-11, 3.01193636733, 18849.2275499742],
        [243181e-11, 4.2734953079, 11790.6290886588]
      ],
      [
        [0.00103018607, 1.10748968172, 6283.0758499914],
        [1721238e-11, 1.06442300386, 12566.1516999828]
      ],
      [
        [4359385e-11, 5.78455133808, 6283.0758499914]
      ]
    ]
  ],
  Mars: [
    [
      [
        [6.20347711581, 0, 0],
        [0.18656368093, 5.0503710027, 3340.6124266998],
        [0.01108216816, 5.40099836344, 6681.2248533996],
        [91798406e-11, 5.75478744667, 10021.8372800994],
        [27744987e-11, 5.97049513147, 3.523118349],
        [10610235e-11, 2.93958560338, 2281.2304965106],
        [12315897e-11, 0.84956094002, 2810.9214616052],
        [8926784e-11, 4.15697846427, 0.0172536522],
        [8715691e-11, 6.11005153139, 13362.4497067992],
        [6797556e-11, 0.36462229657, 398.1490034082],
        [7774872e-11, 3.33968761376, 5621.8429232104],
        [3575078e-11, 1.6618650571, 2544.3144198834],
        [4161108e-11, 0.22814971327, 2942.4634232916],
        [3075252e-11, 0.85696614132, 191.4482661116],
        [2628117e-11, 0.64806124465, 3337.0893083508],
        [2937546e-11, 6.07893711402, 0.0673103028],
        [2389414e-11, 5.03896442664, 796.2980068164],
        [2579844e-11, 0.02996736156, 3344.1355450488],
        [1528141e-11, 1.14979301996, 6151.533888305],
        [1798806e-11, 0.65634057445, 529.6909650946],
        [1264357e-11, 3.62275122593, 5092.1519581158],
        [1286228e-11, 3.06796065034, 2146.1654164752],
        [1546404e-11, 2.91579701718, 1751.539531416],
        [1024902e-11, 3.69334099279, 8962.4553499102],
        [891566e-11, 0.18293837498, 16703.062133499],
        [858759e-11, 2.4009381194, 2914.0142358238],
        [832715e-11, 2.46418619474, 3340.5951730476],
        [83272e-10, 4.49495782139, 3340.629680352],
        [712902e-11, 3.66335473479, 1059.3819301892],
        [748723e-11, 3.82248614017, 155.4203994342],
        [723861e-11, 0.67497311481, 3738.761430108],
        [635548e-11, 2.92182225127, 8432.7643848156],
        [655162e-11, 0.48864064125, 3127.3133312618],
        [550474e-11, 3.81001042328, 0.9803210682],
        [55275e-10, 4.47479317037, 1748.016413067],
        [425966e-11, 0.55364317304, 6283.0758499914],
        [415131e-11, 0.49662285038, 213.299095438],
        [472167e-11, 3.62547124025, 1194.4470102246],
        [306551e-11, 0.38052848348, 6684.7479717486],
        [312141e-11, 0.99853944405, 6677.7017350506],
        [293198e-11, 4.22131299634, 20.7753954924],
        [302375e-11, 4.48618007156, 3532.0606928114],
        [274027e-11, 0.54222167059, 3340.545116397],
        [281079e-11, 5.88163521788, 1349.8674096588],
        [231183e-11, 1.28242156993, 3870.3033917944],
        [283602e-11, 5.7688543494, 3149.1641605882],
        [236117e-11, 5.75503217933, 3333.498879699],
        [274033e-11, 0.13372524985, 3340.6797370026],
        [299395e-11, 2.78323740866, 6254.6266625236]
      ],
      [
        [3340.61242700512, 0, 0],
        [0.01457554523, 3.60433733236, 3340.6124266998],
        [0.00168414711, 3.92318567804, 6681.2248533996],
        [20622975e-11, 4.26108844583, 10021.8372800994],
        [3452392e-11, 4.7321039319, 3.523118349],
        [2586332e-11, 4.60670058555, 13362.4497067992],
        [841535e-11, 4.45864030426, 2281.2304965106]
      ],
      [
        [58152577e-11, 2.04961712429, 3340.6124266998],
        [13459579e-11, 2.45738706163, 6681.2248533996]
      ]
    ],
    [
      [
        [0.03197134986, 3.76832042431, 3340.6124266998],
        [0.00298033234, 4.10616996305, 6681.2248533996],
        [0.00289104742, 0, 0],
        [31365539e-11, 4.4465105309, 10021.8372800994],
        [34841e-9, 4.7881254926, 13362.4497067992]
      ],
      [
        [0.00217310991, 6.04472194776, 3340.6124266998],
        [20976948e-11, 3.14159265359, 0],
        [12834709e-11, 1.60810667915, 6681.2248533996]
      ]
    ],
    [
      [
        [1.53033488271, 0, 0],
        [0.1418495316, 3.47971283528, 3340.6124266998],
        [0.00660776362, 3.81783443019, 6681.2248533996],
        [46179117e-11, 4.15595316782, 10021.8372800994],
        [8109733e-11, 5.55958416318, 2810.9214616052],
        [7485318e-11, 1.77239078402, 5621.8429232104],
        [5523191e-11, 1.3643630377, 2281.2304965106],
        [382516e-10, 4.49407183687, 13362.4497067992],
        [2306537e-11, 0.09081579001, 2544.3144198834],
        [1999396e-11, 5.36059617709, 3337.0893083508],
        [2484394e-11, 4.9254563992, 2942.4634232916],
        [1960195e-11, 4.74249437639, 3344.1355450488],
        [1167119e-11, 2.11260868341, 5092.1519581158],
        [1102816e-11, 5.00908403998, 398.1490034082],
        [899066e-11, 4.40791133207, 529.6909650946],
        [992252e-11, 5.83861961952, 6151.533888305],
        [807354e-11, 2.10217065501, 1059.3819301892],
        [797915e-11, 3.44839203899, 796.2980068164],
        [740975e-11, 1.49906336885, 2146.1654164752]
      ],
      [
        [0.01107433345, 2.03250524857, 3340.6124266998],
        [0.00103175887, 2.37071847807, 6681.2248533996],
        [128772e-9, 0, 0],
        [1081588e-10, 2.70888095665, 10021.8372800994]
      ],
      [
        [44242249e-11, 0.47930604954, 3340.6124266998],
        [8138042e-11, 0.86998389204, 6681.2248533996]
      ]
    ]
  ],
  Jupiter: [
    [
      [
        [0.59954691494, 0, 0],
        [0.09695898719, 5.06191793158, 529.6909650946],
        [0.00573610142, 1.44406205629, 7.1135470008],
        [0.00306389205, 5.41734730184, 1059.3819301892],
        [97178296e-11, 4.14264726552, 632.7837393132],
        [72903078e-11, 3.64042916389, 522.5774180938],
        [64263975e-11, 3.41145165351, 103.0927742186],
        [39806064e-11, 2.29376740788, 419.4846438752],
        [38857767e-11, 1.27231755835, 316.3918696566],
        [27964629e-11, 1.7845459182, 536.8045120954],
        [1358973e-10, 5.7748104079, 1589.0728952838],
        [8246349e-11, 3.5822792584, 206.1855484372],
        [8768704e-11, 3.63000308199, 949.1756089698],
        [7368042e-11, 5.0810119427, 735.8765135318],
        [626315e-10, 0.02497628807, 213.299095438],
        [6114062e-11, 4.51319998626, 1162.4747044078],
        [4905396e-11, 1.32084470588, 110.2063212194],
        [5305285e-11, 1.30671216791, 14.2270940016],
        [5305441e-11, 4.18625634012, 1052.2683831884],
        [4647248e-11, 4.69958103684, 3.9321532631],
        [3045023e-11, 4.31676431084, 426.598190876],
        [2609999e-11, 1.56667394063, 846.0828347512],
        [2028191e-11, 1.06376530715, 3.1813937377],
        [1764763e-11, 2.14148655117, 1066.49547719],
        [1722972e-11, 3.88036268267, 1265.5674786264],
        [1920945e-11, 0.97168196472, 639.897286314],
        [1633223e-11, 3.58201833555, 515.463871093],
        [1431999e-11, 4.29685556046, 625.6701923124],
        [973272e-11, 4.09764549134, 95.9792272178]
      ],
      [
        [529.69096508814, 0, 0],
        [0.00489503243, 4.2208293947, 529.6909650946],
        [0.00228917222, 6.02646855621, 7.1135470008],
        [30099479e-11, 4.54540782858, 1059.3819301892],
        [2072092e-10, 5.45943156902, 522.5774180938],
        [12103653e-11, 0.16994816098, 536.8045120954],
        [6067987e-11, 4.42422292017, 103.0927742186],
        [5433968e-11, 3.98480737746, 419.4846438752],
        [4237744e-11, 5.89008707199, 14.2270940016]
      ],
      [
        [47233601e-11, 4.32148536482, 7.1135470008],
        [30649436e-11, 2.929777887, 529.6909650946],
        [14837605e-11, 3.14159265359, 0]
      ]
    ],
    [
      [
        [0.02268615702, 3.55852606721, 529.6909650946],
        [0.00109971634, 3.90809347197, 1059.3819301892],
        [0.00110090358, 0, 0],
        [8101428e-11, 3.60509572885, 522.5774180938],
        [6043996e-11, 4.25883108339, 1589.0728952838],
        [6437782e-11, 0.30627119215, 536.8045120954]
      ],
      [
        [78203446e-11, 1.52377859742, 529.6909650946]
      ]
    ],
    [
      [
        [5.20887429326, 0, 0],
        [0.25209327119, 3.49108639871, 529.6909650946],
        [0.00610599976, 3.84115365948, 1059.3819301892],
        [0.00282029458, 2.57419881293, 632.7837393132],
        [0.00187647346, 2.07590383214, 522.5774180938],
        [86792905e-11, 0.71001145545, 419.4846438752],
        [72062974e-11, 0.21465724607, 536.8045120954],
        [65517248e-11, 5.9799588479, 316.3918696566],
        [29134542e-11, 1.67759379655, 103.0927742186],
        [30135335e-11, 2.16132003734, 949.1756089698],
        [23453271e-11, 3.54023522184, 735.8765135318],
        [22283743e-11, 4.19362594399, 1589.0728952838],
        [23947298e-11, 0.2745803748, 7.1135470008],
        [13032614e-11, 2.96042965363, 1162.4747044078],
        [970336e-10, 1.90669633585, 206.1855484372],
        [12749023e-11, 2.71550286592, 1052.2683831884],
        [7057931e-11, 2.18184839926, 1265.5674786264],
        [6137703e-11, 6.26418240033, 846.0828347512],
        [2616976e-11, 2.00994012876, 1581.959348283]
      ],
      [
        [0.0127180152, 2.64937512894, 529.6909650946],
        [61661816e-11, 3.00076460387, 1059.3819301892],
        [53443713e-11, 3.89717383175, 522.5774180938],
        [31185171e-11, 4.88276958012, 536.8045120954],
        [41390269e-11, 0, 0]
      ]
    ]
  ],
  Saturn: [
    [
      [
        [0.87401354025, 0, 0],
        [0.11107659762, 3.96205090159, 213.299095438],
        [0.01414150957, 4.58581516874, 7.1135470008],
        [0.00398379389, 0.52112032699, 206.1855484372],
        [0.00350769243, 3.30329907896, 426.598190876],
        [0.00206816305, 0.24658372002, 103.0927742186],
        [792713e-9, 3.84007056878, 220.4126424388],
        [23990355e-11, 4.66976924553, 110.2063212194],
        [16573588e-11, 0.43719228296, 419.4846438752],
        [14906995e-11, 5.76903183869, 316.3918696566],
        [1582029e-10, 0.93809155235, 632.7837393132],
        [14609559e-11, 1.56518472, 3.9321532631],
        [13160301e-11, 4.44891291899, 14.2270940016],
        [15053543e-11, 2.71669915667, 639.897286314],
        [13005299e-11, 5.98119023644, 11.0457002639],
        [10725067e-11, 3.12939523827, 202.2533951741],
        [5863206e-11, 0.23656938524, 529.6909650946],
        [5227757e-11, 4.20783365759, 3.1813937377],
        [6126317e-11, 1.76328667907, 277.0349937414],
        [5019687e-11, 3.17787728405, 433.7117378768],
        [459255e-10, 0.61977744975, 199.0720014364],
        [4005867e-11, 2.24479718502, 63.7358983034],
        [2953796e-11, 0.98280366998, 95.9792272178],
        [387367e-10, 3.22283226966, 138.5174968707],
        [2461186e-11, 2.03163875071, 735.8765135318],
        [3269484e-11, 0.77492638211, 949.1756089698],
        [1758145e-11, 3.2658010994, 522.5774180938],
        [1640172e-11, 5.5050445305, 846.0828347512],
        [1391327e-11, 4.02333150505, 323.5054166574],
        [1580648e-11, 4.37265307169, 309.2783226558],
        [1123498e-11, 2.83726798446, 415.5524906121],
        [1017275e-11, 3.71700135395, 227.5261894396],
        [848642e-11, 3.1915017083, 209.3669421749]
      ],
      [
        [213.2990952169, 0, 0],
        [0.01297370862, 1.82834923978, 213.299095438],
        [0.00564345393, 2.88499717272, 7.1135470008],
        [93734369e-11, 1.06311793502, 426.598190876],
        [0.00107674962, 2.27769131009, 206.1855484372],
        [40244455e-11, 2.04108104671, 220.4126424388],
        [19941774e-11, 1.2795439047, 103.0927742186],
        [10511678e-11, 2.7488034213, 14.2270940016],
        [6416106e-11, 0.38238295041, 639.897286314],
        [4848994e-11, 2.43037610229, 419.4846438752],
        [4056892e-11, 2.92133209468, 110.2063212194],
        [3768635e-11, 3.6496533078, 3.9321532631]
      ],
      [
        [0.0011644133, 1.17988132879, 7.1135470008],
        [91841837e-11, 0.0732519584, 213.299095438],
        [36661728e-11, 0, 0],
        [15274496e-11, 4.06493179167, 206.1855484372]
      ]
    ],
    [
      [
        [0.04330678039, 3.60284428399, 213.299095438],
        [0.00240348302, 2.85238489373, 426.598190876],
        [84745939e-11, 0, 0],
        [30863357e-11, 3.48441504555, 220.4126424388],
        [34116062e-11, 0.57297307557, 206.1855484372],
        [1473407e-10, 2.11846596715, 639.897286314],
        [9916667e-11, 5.79003188904, 419.4846438752],
        [6993564e-11, 4.7360468972, 7.1135470008],
        [4807588e-11, 5.43305312061, 316.3918696566]
      ],
      [
        [0.00198927992, 4.93901017903, 213.299095438],
        [36947916e-11, 3.14159265359, 0],
        [17966989e-11, 0.5197943111, 426.598190876]
      ]
    ],
    [
      [
        [9.55758135486, 0, 0],
        [0.52921382865, 2.39226219573, 213.299095438],
        [0.01873679867, 5.2354960466, 206.1855484372],
        [0.01464663929, 1.64763042902, 426.598190876],
        [0.00821891141, 5.93520042303, 316.3918696566],
        [0.00547506923, 5.0153261898, 103.0927742186],
        [0.0037168465, 2.27114821115, 220.4126424388],
        [0.00361778765, 3.13904301847, 7.1135470008],
        [0.00140617506, 5.70406606781, 632.7837393132],
        [0.00108974848, 3.29313390175, 110.2063212194],
        [69006962e-11, 5.94099540992, 419.4846438752],
        [61053367e-11, 0.94037691801, 639.897286314],
        [48913294e-11, 1.55733638681, 202.2533951741],
        [34143772e-11, 0.19519102597, 277.0349937414],
        [32401773e-11, 5.47084567016, 949.1756089698],
        [20936596e-11, 0.46349251129, 735.8765135318],
        [9796004e-11, 5.20477537945, 1265.5674786264],
        [11993338e-11, 5.98050967385, 846.0828347512],
        [208393e-9, 1.52102476129, 433.7117378768],
        [15298404e-11, 3.0594381494, 529.6909650946],
        [6465823e-11, 0.17732249942, 1052.2683831884],
        [11380257e-11, 1.7310542704, 522.5774180938],
        [3419618e-11, 4.94550542171, 1581.959348283]
      ],
      [
        [0.0618298134, 0.2584351148, 213.299095438],
        [0.00506577242, 0.71114625261, 206.1855484372],
        [0.00341394029, 5.79635741658, 426.598190876],
        [0.00188491195, 0.47215589652, 220.4126424388],
        [0.00186261486, 3.14159265359, 0],
        [0.00143891146, 1.40744822888, 7.1135470008]
      ],
      [
        [0.00436902572, 4.78671677509, 213.299095438]
      ]
    ]
  ],
  Uranus: [
    [
      [
        [5.48129294297, 0, 0],
        [0.09260408234, 0.89106421507, 74.7815985673],
        [0.01504247898, 3.6271926092, 1.4844727083],
        [0.00365981674, 1.89962179044, 73.297125859],
        [0.00272328168, 3.35823706307, 149.5631971346],
        [70328461e-11, 5.39254450063, 63.7358983034],
        [68892678e-11, 6.09292483287, 76.2660712756],
        [61998615e-11, 2.26952066061, 2.9689454166],
        [61950719e-11, 2.85098872691, 11.0457002639],
        [2646877e-10, 3.14152083966, 71.8126531507],
        [25710476e-11, 6.11379840493, 454.9093665273],
        [2107885e-10, 4.36059339067, 148.0787244263],
        [17818647e-11, 1.74436930289, 36.6485629295],
        [14613507e-11, 4.73732166022, 3.9321532631],
        [11162509e-11, 5.8268179635, 224.3447957019],
        [1099791e-10, 0.48865004018, 138.5174968707],
        [9527478e-11, 2.95516862826, 35.1640902212],
        [7545601e-11, 5.236265824, 109.9456887885],
        [4220241e-11, 3.23328220918, 70.8494453042],
        [40519e-9, 2.277550173, 151.0476698429],
        [3354596e-11, 1.0654900738, 4.4534181249],
        [2926718e-11, 4.62903718891, 9.5612275556],
        [349034e-10, 5.48306144511, 146.594251718],
        [3144069e-11, 4.75199570434, 77.7505439839],
        [2922333e-11, 5.35235361027, 85.8272988312],
        [2272788e-11, 4.36600400036, 70.3281804424],
        [2051219e-11, 1.51773566586, 0.1118745846],
        [2148602e-11, 0.60745949945, 38.1330356378],
        [1991643e-11, 4.92437588682, 277.0349937414],
        [1376226e-11, 2.04283539351, 65.2203710117],
        [1666902e-11, 3.62744066769, 380.12776796],
        [1284107e-11, 3.11347961505, 202.2533951741],
        [1150429e-11, 0.93343589092, 3.1813937377],
        [1533221e-11, 2.58594681212, 52.6901980395],
        [1281604e-11, 0.54271272721, 222.8603229936],
        [1372139e-11, 4.19641530878, 111.4301614968],
        [1221029e-11, 0.1990065003, 108.4612160802],
        [946181e-11, 1.19253165736, 127.4717966068],
        [1150989e-11, 4.17898916639, 33.6796175129]
      ],
      [
        [74.7815986091, 0, 0],
        [0.00154332863, 5.24158770553, 74.7815985673],
        [24456474e-11, 1.71260334156, 1.4844727083],
        [9258442e-11, 0.4282973235, 11.0457002639],
        [8265977e-11, 1.50218091379, 63.7358983034],
        [915016e-10, 1.41213765216, 149.5631971346]
      ]
    ],
    [
      [
        [0.01346277648, 2.61877810547, 74.7815985673],
        [623414e-9, 5.08111189648, 149.5631971346],
        [61601196e-11, 3.14159265359, 0],
        [9963722e-11, 1.61603805646, 76.2660712756],
        [992616e-10, 0.57630380333, 73.297125859]
      ],
      [
        [34101978e-11, 0.01321929936, 74.7815985673]
      ]
    ],
    [
      [
        [19.21264847206, 0, 0],
        [0.88784984413, 5.60377527014, 74.7815985673],
        [0.03440836062, 0.32836099706, 73.297125859],
        [0.0205565386, 1.7829515933, 149.5631971346],
        [0.0064932241, 4.52247285911, 76.2660712756],
        [0.00602247865, 3.86003823674, 63.7358983034],
        [0.00496404167, 1.40139935333, 454.9093665273],
        [0.00338525369, 1.58002770318, 138.5174968707],
        [0.00243509114, 1.57086606044, 71.8126531507],
        [0.00190522303, 1.99809394714, 1.4844727083],
        [0.00161858838, 2.79137786799, 148.0787244263],
        [0.00143706183, 1.38368544947, 11.0457002639],
        [93192405e-11, 0.17437220467, 36.6485629295],
        [71424548e-11, 4.24509236074, 224.3447957019],
        [89806014e-11, 3.66105364565, 109.9456887885],
        [39009723e-11, 1.66971401684, 70.8494453042],
        [46677296e-11, 1.39976401694, 35.1640902212],
        [39025624e-11, 3.36234773834, 277.0349937414],
        [36755274e-11, 3.88649278513, 146.594251718],
        [30348723e-11, 0.70100838798, 151.0476698429],
        [29156413e-11, 3.180563367, 77.7505439839],
        [22637073e-11, 0.72518687029, 529.6909650946],
        [11959076e-11, 1.7504339214, 984.6003316219],
        [25620756e-11, 5.25656086672, 380.12776796]
      ],
      [
        [0.01479896629, 3.67205697578, 74.7815985673]
      ]
    ]
  ],
  Neptune: [
    [
      [
        [5.31188633046, 0, 0],
        [0.0179847553, 2.9010127389, 38.1330356378],
        [0.01019727652, 0.48580922867, 1.4844727083],
        [0.00124531845, 4.83008090676, 36.6485629295],
        [42064466e-11, 5.41054993053, 2.9689454166],
        [37714584e-11, 6.09221808686, 35.1640902212],
        [33784738e-11, 1.24488874087, 76.2660712756],
        [16482741e-11, 7727998e-11, 491.5579294568],
        [9198584e-11, 4.93747051954, 39.6175083461],
        [899425e-10, 0.27462171806, 175.1660598002]
      ],
      [
        [38.13303563957, 0, 0],
        [16604172e-11, 4.86323329249, 1.4844727083],
        [15744045e-11, 2.27887427527, 38.1330356378]
      ]
    ],
    [
      [
        [0.03088622933, 1.44104372644, 38.1330356378],
        [27780087e-11, 5.91271884599, 76.2660712756],
        [27623609e-11, 0, 0],
        [15355489e-11, 2.52123799551, 36.6485629295],
        [15448133e-11, 3.50877079215, 39.6175083461]
      ]
    ],
    [
      [
        [30.07013205828, 0, 0],
        [0.27062259632, 1.32999459377, 38.1330356378],
        [0.01691764014, 3.25186135653, 36.6485629295],
        [0.00807830553, 5.18592878704, 1.4844727083],
        [0.0053776051, 4.52113935896, 35.1640902212],
        [0.00495725141, 1.5710564165, 491.5579294568],
        [0.00274571975, 1.84552258866, 175.1660598002],
        [1201232e-10, 1.92059384991, 1021.2488945514],
        [0.00121801746, 5.79754470298, 76.2660712756],
        [0.00100896068, 0.3770272493, 73.297125859],
        [0.00135134092, 3.37220609835, 39.6175083461],
        [7571796e-11, 1.07149207335, 388.4651552382]
      ]
    ]
  ]
};
function DeltaT_EspenakMeeus(ut) {
  var u, u2, u3, u4, u5, u6, u7;
  const y = 2e3 + (ut - 14) / DAYS_PER_TROPICAL_YEAR;
  if (y < -500) {
    u = (y - 1820) / 100;
    return -20 + 32 * u * u;
  }
  if (y < 500) {
    u = y / 100;
    u2 = u * u;
    u3 = u * u2;
    u4 = u2 * u2;
    u5 = u2 * u3;
    u6 = u3 * u3;
    return 10583.6 - 1014.41 * u + 33.78311 * u2 - 5.952053 * u3 - 0.1798452 * u4 + 0.022174192 * u5 + 0.0090316521 * u6;
  }
  if (y < 1600) {
    u = (y - 1e3) / 100;
    u2 = u * u;
    u3 = u * u2;
    u4 = u2 * u2;
    u5 = u2 * u3;
    u6 = u3 * u3;
    return 1574.2 - 556.01 * u + 71.23472 * u2 + 0.319781 * u3 - 0.8503463 * u4 - 5050998e-9 * u5 + 0.0083572073 * u6;
  }
  if (y < 1700) {
    u = y - 1600;
    u2 = u * u;
    u3 = u * u2;
    return 120 - 0.9808 * u - 0.01532 * u2 + u3 / 7129;
  }
  if (y < 1800) {
    u = y - 1700;
    u2 = u * u;
    u3 = u * u2;
    u4 = u2 * u2;
    return 8.83 + 0.1603 * u - 59285e-7 * u2 + 13336e-8 * u3 - u4 / 1174e3;
  }
  if (y < 1860) {
    u = y - 1800;
    u2 = u * u;
    u3 = u * u2;
    u4 = u2 * u2;
    u5 = u2 * u3;
    u6 = u3 * u3;
    u7 = u3 * u4;
    return 13.72 - 0.332447 * u + 68612e-7 * u2 + 41116e-7 * u3 - 37436e-8 * u4 + 121272e-10 * u5 - 1699e-10 * u6 + 875e-12 * u7;
  }
  if (y < 1900) {
    u = y - 1860;
    u2 = u * u;
    u3 = u * u2;
    u4 = u2 * u2;
    u5 = u2 * u3;
    return 7.62 + 0.5737 * u - 0.251754 * u2 + 0.01680668 * u3 - 4473624e-10 * u4 + u5 / 233174;
  }
  if (y < 1920) {
    u = y - 1900;
    u2 = u * u;
    u3 = u * u2;
    u4 = u2 * u2;
    return -2.79 + 1.494119 * u - 0.0598939 * u2 + 61966e-7 * u3 - 197e-6 * u4;
  }
  if (y < 1941) {
    u = y - 1920;
    u2 = u * u;
    u3 = u * u2;
    return 21.2 + 0.84493 * u - 0.0761 * u2 + 20936e-7 * u3;
  }
  if (y < 1961) {
    u = y - 1950;
    u2 = u * u;
    u3 = u * u2;
    return 29.07 + 0.407 * u - u2 / 233 + u3 / 2547;
  }
  if (y < 1986) {
    u = y - 1975;
    u2 = u * u;
    u3 = u * u2;
    return 45.45 + 1.067 * u - u2 / 260 - u3 / 718;
  }
  if (y < 2005) {
    u = y - 2e3;
    u2 = u * u;
    u3 = u * u2;
    u4 = u2 * u2;
    u5 = u2 * u3;
    return 63.86 + 0.3345 * u - 0.060374 * u2 + 17275e-7 * u3 + 651814e-9 * u4 + 2373599e-11 * u5;
  }
  if (y < 2050) {
    u = y - 2e3;
    return 62.92 + 0.32217 * u + 5589e-6 * u * u;
  }
  if (y < 2150) {
    u = (y - 1820) / 100;
    return -20 + 32 * u * u - 0.5628 * (2150 - y);
  }
  u = (y - 1820) / 100;
  return -20 + 32 * u * u;
}
var DeltaT = DeltaT_EspenakMeeus;
function TerrestrialTime(ut) {
  return ut + DeltaT(ut) / 86400;
}
var AstroTime = class _AstroTime {
  /**
   * @param {FlexibleDateTime} date
   *      A JavaScript Date object, a numeric UTC value expressed in J2000 days, or another AstroTime object.
   */
  constructor(date) {
    if (date instanceof _AstroTime) {
      this.date = date.date;
      this.ut = date.ut;
      this.tt = date.tt;
      return;
    }
    const MillisPerDay = 1e3 * 3600 * 24;
    if (date instanceof Date && Number.isFinite(date.getTime())) {
      this.date = date;
      this.ut = (date.getTime() - J2000.getTime()) / MillisPerDay;
      this.tt = TerrestrialTime(this.ut);
      return;
    }
    if (Number.isFinite(date)) {
      this.date = new Date(J2000.getTime() + date * MillisPerDay);
      this.ut = date;
      this.tt = TerrestrialTime(this.ut);
      return;
    }
    throw "Argument must be a Date object, an AstroTime object, or a numeric UTC Julian date.";
  }
  /**
   * @brief Creates an `AstroTime` value from a Terrestrial Time (TT) day value.
   *
   * This function can be used in rare cases where a time must be based
   * on Terrestrial Time (TT) rather than Universal Time (UT).
   * Most developers will want to invoke `new AstroTime(ut)` with a universal time
   * instead of this function, because usually time is based on civil time adjusted
   * by leap seconds to match the Earth's rotation, rather than the uniformly
   * flowing TT used to calculate solar system dynamics. In rare cases
   * where the caller already knows TT, this function is provided to create
   * an `AstroTime` value that can be passed to Astronomy Engine functions.
   *
   * @param {number} tt
   *      The number of days since the J2000 epoch as expressed in Terrestrial Time.
   *
   * @returns {AstroTime}
   *      An `AstroTime` object for the specified terrestrial time.
   */
  static FromTerrestrialTime(tt) {
    let time = new _AstroTime(tt);
    for (; ; ) {
      const err = tt - time.tt;
      if (Math.abs(err) < 1e-12)
        return time;
      time = time.AddDays(err);
    }
  }
  /**
   * Formats an `AstroTime` object as an [ISO 8601](https://en.wikipedia.org/wiki/ISO_8601)
   * date/time string in UTC, to millisecond resolution.
   * Example: `2018-08-17T17:22:04.050Z`
   * @returns {string}
   */
  toString() {
    return this.date.toISOString();
  }
  /**
   * Returns a new `AstroTime` object adjusted by the floating point number of days.
   * Does NOT modify the original `AstroTime` object.
   *
   * @param {number} days
   *      The floating point number of days by which to adjust the given date and time.
   *      Positive values adjust the date toward the future, and
   *      negative values adjust the date toward the past.
   *
   * @returns {AstroTime}
   */
  AddDays(days) {
    return new _AstroTime(this.ut + days);
  }
};
function MakeTime(date) {
  if (date instanceof AstroTime) {
    return date;
  }
  return new AstroTime(date);
}
function iau2000b(time) {
  function mod(x) {
    return x % ASEC360 * ASEC2RAD;
  }
  const t = time.tt / 36525;
  const elp = mod(128710479305e-5 + t * 1295965810481e-4);
  const f = mod(335779.526232 + t * 17395272628478e-4);
  const d = mod(107226070369e-5 + t * 1602961601209e-3);
  const om = mod(450160.398036 - t * 69628905431e-4);
  let sarg = Math.sin(om);
  let carg = Math.cos(om);
  let dp = (-172064161 - 174666 * t) * sarg + 33386 * carg;
  let de = (92052331 + 9086 * t) * carg + 15377 * sarg;
  let arg = 2 * (f - d + om);
  sarg = Math.sin(arg);
  carg = Math.cos(arg);
  dp += (-13170906 - 1675 * t) * sarg - 13696 * carg;
  de += (5730336 - 3015 * t) * carg - 4587 * sarg;
  arg = 2 * (f + om);
  sarg = Math.sin(arg);
  carg = Math.cos(arg);
  dp += (-2276413 - 234 * t) * sarg + 2796 * carg;
  de += (978459 - 485 * t) * carg + 1374 * sarg;
  arg = 2 * om;
  sarg = Math.sin(arg);
  carg = Math.cos(arg);
  dp += (2074554 + 207 * t) * sarg - 698 * carg;
  de += (-897492 + 470 * t) * carg - 291 * sarg;
  sarg = Math.sin(elp);
  carg = Math.cos(elp);
  dp += (1475877 - 3633 * t) * sarg + 11817 * carg;
  de += (73871 - 184 * t) * carg - 1924 * sarg;
  return {
    dpsi: -135e-6 + dp * 1e-7,
    deps: 388e-6 + de * 1e-7
  };
}
function mean_obliq(time) {
  var t = time.tt / 36525;
  var asec = ((((-434e-10 * t - 576e-9) * t + 20034e-7) * t - 1831e-7) * t - 46.836769) * t + 84381.406;
  return asec / 3600;
}
var cache_e_tilt;
function e_tilt(time) {
  if (!cache_e_tilt || Math.abs(cache_e_tilt.tt - time.tt) > 1e-6) {
    const nut = iau2000b(time);
    const mean_ob = mean_obliq(time);
    const true_ob = mean_ob + nut.deps / 3600;
    cache_e_tilt = {
      tt: time.tt,
      dpsi: nut.dpsi,
      deps: nut.deps,
      ee: nut.dpsi * Math.cos(mean_ob * DEG2RAD) / 15,
      mobl: mean_ob,
      tobl: true_ob
    };
  }
  return cache_e_tilt;
}
function obl_ecl2equ_vec(oblDegrees, pos) {
  const obl = oblDegrees * DEG2RAD;
  const cos_obl = Math.cos(obl);
  const sin_obl = Math.sin(obl);
  return [
    pos[0],
    pos[1] * cos_obl - pos[2] * sin_obl,
    pos[1] * sin_obl + pos[2] * cos_obl
  ];
}
function ecl2equ_vec(time, pos) {
  return obl_ecl2equ_vec(mean_obliq(time), pos);
}
var CalcMoonCount = 0;
function CalcMoon(time) {
  ++CalcMoonCount;
  const T = time.tt / 36525;
  function DeclareArray1(xmin, xmax) {
    const array = [];
    let i;
    for (i = 0; i <= xmax - xmin; ++i) {
      array.push(0);
    }
    return { min: xmin, array };
  }
  function DeclareArray2(xmin, xmax, ymin, ymax) {
    const array = [];
    for (let i = 0; i <= xmax - xmin; ++i) {
      array.push(DeclareArray1(ymin, ymax));
    }
    return { min: xmin, array };
  }
  function ArrayGet2(a, x, y) {
    const m = a.array[x - a.min];
    return m.array[y - m.min];
  }
  function ArraySet2(a, x, y, v) {
    const m = a.array[x - a.min];
    m.array[y - m.min] = v;
  }
  let S, MAX, ARG, FAC, I, J, T2, DGAM, DLAM, N, GAM1C, SINPI, L0, L, LS, F, D, DL0, DL, DLS, DF, DD, DS;
  let coArray = DeclareArray2(-6, 6, 1, 4);
  let siArray = DeclareArray2(-6, 6, 1, 4);
  function CO(x, y) {
    return ArrayGet2(coArray, x, y);
  }
  function SI(x, y) {
    return ArrayGet2(siArray, x, y);
  }
  function SetCO(x, y, v) {
    return ArraySet2(coArray, x, y, v);
  }
  function SetSI(x, y, v) {
    return ArraySet2(siArray, x, y, v);
  }
  function AddThe(c1, s1, c2, s2, func) {
    func(c1 * c2 - s1 * s2, s1 * c2 + c1 * s2);
  }
  function Sine(phi) {
    return Math.sin(PI2 * phi);
  }
  T2 = T * T;
  DLAM = 0;
  DS = 0;
  GAM1C = 0;
  SINPI = 3422.7;
  var S1 = Sine(0.19833 + 0.05611 * T);
  var S2 = Sine(0.27869 + 0.04508 * T);
  var S3 = Sine(0.16827 - 0.36903 * T);
  var S4 = Sine(0.34734 - 5.37261 * T);
  var S5 = Sine(0.10498 - 5.37899 * T);
  var S6 = Sine(0.42681 - 0.41855 * T);
  var S7 = Sine(0.14943 - 5.37511 * T);
  DL0 = 0.84 * S1 + 0.31 * S2 + 14.27 * S3 + 7.26 * S4 + 0.28 * S5 + 0.24 * S6;
  DL = 2.94 * S1 + 0.31 * S2 + 14.27 * S3 + 9.34 * S4 + 1.12 * S5 + 0.83 * S6;
  DLS = -6.4 * S1 - 1.89 * S6;
  DF = 0.21 * S1 + 0.31 * S2 + 14.27 * S3 - 88.7 * S4 - 15.3 * S5 + 0.24 * S6 - 1.86 * S7;
  DD = DL0 - DLS;
  DGAM = -3332e-9 * Sine(0.59734 - 5.37261 * T) - 539e-9 * Sine(0.35498 - 5.37899 * T) - 64e-9 * Sine(0.39943 - 5.37511 * T);
  L0 = PI2 * Frac(0.60643382 + 1336.85522467 * T - 313e-8 * T2) + DL0 / ARC;
  L = PI2 * Frac(0.37489701 + 1325.55240982 * T + 2565e-8 * T2) + DL / ARC;
  LS = PI2 * Frac(0.99312619 + 99.99735956 * T - 44e-8 * T2) + DLS / ARC;
  F = PI2 * Frac(0.25909118 + 1342.2278298 * T - 892e-8 * T2) + DF / ARC;
  D = PI2 * Frac(0.82736186 + 1236.85308708 * T - 397e-8 * T2) + DD / ARC;
  for (I = 1; I <= 4; ++I) {
    switch (I) {
      case 1:
        ARG = L;
        MAX = 4;
        FAC = 1.000002208;
        break;
      case 2:
        ARG = LS;
        MAX = 3;
        FAC = 0.997504612 - 2495388e-9 * T;
        break;
      case 3:
        ARG = F;
        MAX = 4;
        FAC = 1.000002708 + 139.978 * DGAM;
        break;
      case 4:
        ARG = D;
        MAX = 6;
        FAC = 1;
        break;
      default:
        throw `Internal error: I = ${I}`;
    }
    SetCO(0, I, 1);
    SetCO(1, I, Math.cos(ARG) * FAC);
    SetSI(0, I, 0);
    SetSI(1, I, Math.sin(ARG) * FAC);
    for (J = 2; J <= MAX; ++J) {
      AddThe(CO(J - 1, I), SI(J - 1, I), CO(1, I), SI(1, I), (c, s) => (SetCO(J, I, c), SetSI(J, I, s)));
    }
    for (J = 1; J <= MAX; ++J) {
      SetCO(-J, I, CO(J, I));
      SetSI(-J, I, -SI(J, I));
    }
  }
  function Term(p, q, r, s) {
    var result = { x: 1, y: 0 };
    var I2 = [0, p, q, r, s];
    for (var k = 1; k <= 4; ++k)
      if (I2[k] !== 0)
        AddThe(result.x, result.y, CO(I2[k], k), SI(I2[k], k), (c, s2) => (result.x = c, result.y = s2));
    return result;
  }
  function AddSol(coeffl, coeffs, coeffg, coeffp, p, q, r, s) {
    var result = Term(p, q, r, s);
    DLAM += coeffl * result.y;
    DS += coeffs * result.y;
    GAM1C += coeffg * result.x;
    SINPI += coeffp * result.x;
  }
  AddSol(13.902, 14.06, -1e-3, 0.2607, 0, 0, 0, 4);
  AddSol(0.403, -4.01, 0.394, 23e-4, 0, 0, 0, 3);
  AddSol(2369.912, 2373.36, 0.601, 28.2333, 0, 0, 0, 2);
  AddSol(-125.154, -112.79, -0.725, -0.9781, 0, 0, 0, 1);
  AddSol(1.979, 6.98, -0.445, 0.0433, 1, 0, 0, 4);
  AddSol(191.953, 192.72, 0.029, 3.0861, 1, 0, 0, 2);
  AddSol(-8.466, -13.51, 0.455, -0.1093, 1, 0, 0, 1);
  AddSol(22639.5, 22609.07, 0.079, 186.5398, 1, 0, 0, 0);
  AddSol(18.609, 3.59, -0.094, 0.0118, 1, 0, 0, -1);
  AddSol(-4586.465, -4578.13, -0.077, 34.3117, 1, 0, 0, -2);
  AddSol(3.215, 5.44, 0.192, -0.0386, 1, 0, 0, -3);
  AddSol(-38.428, -38.64, 1e-3, 0.6008, 1, 0, 0, -4);
  AddSol(-0.393, -1.43, -0.092, 86e-4, 1, 0, 0, -6);
  AddSol(-0.289, -1.59, 0.123, -53e-4, 0, 1, 0, 4);
  AddSol(-24.42, -25.1, 0.04, -0.3, 0, 1, 0, 2);
  AddSol(18.023, 17.93, 7e-3, 0.1494, 0, 1, 0, 1);
  AddSol(-668.146, -126.98, -1.302, -0.3997, 0, 1, 0, 0);
  AddSol(0.56, 0.32, -1e-3, -37e-4, 0, 1, 0, -1);
  AddSol(-165.145, -165.06, 0.054, 1.9178, 0, 1, 0, -2);
  AddSol(-1.877, -6.46, -0.416, 0.0339, 0, 1, 0, -4);
  AddSol(0.213, 1.02, -0.074, 54e-4, 2, 0, 0, 4);
  AddSol(14.387, 14.78, -0.017, 0.2833, 2, 0, 0, 2);
  AddSol(-0.586, -1.2, 0.054, -0.01, 2, 0, 0, 1);
  AddSol(769.016, 767.96, 0.107, 10.1657, 2, 0, 0, 0);
  AddSol(1.75, 2.01, -0.018, 0.0155, 2, 0, 0, -1);
  AddSol(-211.656, -152.53, 5.679, -0.3039, 2, 0, 0, -2);
  AddSol(1.225, 0.91, -0.03, -88e-4, 2, 0, 0, -3);
  AddSol(-30.773, -34.07, -0.308, 0.3722, 2, 0, 0, -4);
  AddSol(-0.57, -1.4, -0.074, 0.0109, 2, 0, 0, -6);
  AddSol(-2.921, -11.75, 0.787, -0.0484, 1, 1, 0, 2);
  AddSol(1.267, 1.52, -0.022, 0.0164, 1, 1, 0, 1);
  AddSol(-109.673, -115.18, 0.461, -0.949, 1, 1, 0, 0);
  AddSol(-205.962, -182.36, 2.056, 1.4437, 1, 1, 0, -2);
  AddSol(0.233, 0.36, 0.012, -25e-4, 1, 1, 0, -3);
  AddSol(-4.391, -9.66, -0.471, 0.0673, 1, 1, 0, -4);
  AddSol(0.283, 1.53, -0.111, 6e-3, 1, -1, 0, 4);
  AddSol(14.577, 31.7, -1.54, 0.2302, 1, -1, 0, 2);
  AddSol(147.687, 138.76, 0.679, 1.1528, 1, -1, 0, 0);
  AddSol(-1.089, 0.55, 0.021, 0, 1, -1, 0, -1);
  AddSol(28.475, 23.59, -0.443, -0.2257, 1, -1, 0, -2);
  AddSol(-0.276, -0.38, -6e-3, -36e-4, 1, -1, 0, -3);
  AddSol(0.636, 2.27, 0.146, -0.0102, 1, -1, 0, -4);
  AddSol(-0.189, -1.68, 0.131, -28e-4, 0, 2, 0, 2);
  AddSol(-7.486, -0.66, -0.037, -86e-4, 0, 2, 0, 0);
  AddSol(-8.096, -16.35, -0.74, 0.0918, 0, 2, 0, -2);
  AddSol(-5.741, -0.04, 0, -9e-4, 0, 0, 2, 2);
  AddSol(0.255, 0, 0, 0, 0, 0, 2, 1);
  AddSol(-411.608, -0.2, 0, -0.0124, 0, 0, 2, 0);
  AddSol(0.584, 0.84, 0, 71e-4, 0, 0, 2, -1);
  AddSol(-55.173, -52.14, 0, -0.1052, 0, 0, 2, -2);
  AddSol(0.254, 0.25, 0, -17e-4, 0, 0, 2, -3);
  AddSol(0.025, -1.67, 0, 31e-4, 0, 0, 2, -4);
  AddSol(1.06, 2.96, -0.166, 0.0243, 3, 0, 0, 2);
  AddSol(36.124, 50.64, -1.3, 0.6215, 3, 0, 0, 0);
  AddSol(-13.193, -16.4, 0.258, -0.1187, 3, 0, 0, -2);
  AddSol(-1.187, -0.74, 0.042, 74e-4, 3, 0, 0, -4);
  AddSol(-0.293, -0.31, -2e-3, 46e-4, 3, 0, 0, -6);
  AddSol(-0.29, -1.45, 0.116, -51e-4, 2, 1, 0, 2);
  AddSol(-7.649, -10.56, 0.259, -0.1038, 2, 1, 0, 0);
  AddSol(-8.627, -7.59, 0.078, -0.0192, 2, 1, 0, -2);
  AddSol(-2.74, -2.54, 0.022, 0.0324, 2, 1, 0, -4);
  AddSol(1.181, 3.32, -0.212, 0.0213, 2, -1, 0, 2);
  AddSol(9.703, 11.67, -0.151, 0.1268, 2, -1, 0, 0);
  AddSol(-0.352, -0.37, 1e-3, -28e-4, 2, -1, 0, -1);
  AddSol(-2.494, -1.17, -3e-3, -17e-4, 2, -1, 0, -2);
  AddSol(0.36, 0.2, -0.012, -43e-4, 2, -1, 0, -4);
  AddSol(-1.167, -1.25, 8e-3, -0.0106, 1, 2, 0, 0);
  AddSol(-7.412, -6.12, 0.117, 0.0484, 1, 2, 0, -2);
  AddSol(-0.311, -0.65, -0.032, 44e-4, 1, 2, 0, -4);
  AddSol(0.757, 1.82, -0.105, 0.0112, 1, -2, 0, 2);
  AddSol(2.58, 2.32, 0.027, 0.0196, 1, -2, 0, 0);
  AddSol(2.533, 2.4, -0.014, -0.0212, 1, -2, 0, -2);
  AddSol(-0.344, -0.57, -0.025, 36e-4, 0, 3, 0, -2);
  AddSol(-0.992, -0.02, 0, 0, 1, 0, 2, 2);
  AddSol(-45.099, -0.02, 0, -1e-3, 1, 0, 2, 0);
  AddSol(-0.179, -9.52, 0, -0.0833, 1, 0, 2, -2);
  AddSol(-0.301, -0.33, 0, 14e-4, 1, 0, 2, -4);
  AddSol(-6.382, -3.37, 0, -0.0481, 1, 0, -2, 2);
  AddSol(39.528, 85.13, 0, -0.7136, 1, 0, -2, 0);
  AddSol(9.366, 0.71, 0, -0.0112, 1, 0, -2, -2);
  AddSol(0.202, 0.02, 0, 0, 1, 0, -2, -4);
  AddSol(0.415, 0.1, 0, 13e-4, 0, 1, 2, 0);
  AddSol(-2.152, -2.26, 0, -66e-4, 0, 1, 2, -2);
  AddSol(-1.44, -1.3, 0, 14e-4, 0, 1, -2, 2);
  AddSol(0.384, -0.04, 0, 0, 0, 1, -2, -2);
  AddSol(1.938, 3.6, -0.145, 0.0401, 4, 0, 0, 0);
  AddSol(-0.952, -1.58, 0.052, -0.013, 4, 0, 0, -2);
  AddSol(-0.551, -0.94, 0.032, -97e-4, 3, 1, 0, 0);
  AddSol(-0.482, -0.57, 5e-3, -45e-4, 3, 1, 0, -2);
  AddSol(0.681, 0.96, -0.026, 0.0115, 3, -1, 0, 0);
  AddSol(-0.297, -0.27, 2e-3, -9e-4, 2, 2, 0, -2);
  AddSol(0.254, 0.21, -3e-3, 0, 2, -2, 0, -2);
  AddSol(-0.25, -0.22, 4e-3, 14e-4, 1, 3, 0, -2);
  AddSol(-3.996, 0, 0, 4e-4, 2, 0, 2, 0);
  AddSol(0.557, -0.75, 0, -9e-3, 2, 0, 2, -2);
  AddSol(-0.459, -0.38, 0, -53e-4, 2, 0, -2, 2);
  AddSol(-1.298, 0.74, 0, 4e-4, 2, 0, -2, 0);
  AddSol(0.538, 1.14, 0, -0.0141, 2, 0, -2, -2);
  AddSol(0.263, 0.02, 0, 0, 1, 1, 2, 0);
  AddSol(0.426, 0.07, 0, -6e-4, 1, 1, -2, -2);
  AddSol(-0.304, 0.03, 0, 3e-4, 1, -1, 2, 0);
  AddSol(-0.372, -0.19, 0, -27e-4, 1, -1, -2, 2);
  AddSol(0.418, 0, 0, 0, 0, 0, 4, 0);
  AddSol(-0.33, -0.04, 0, 0, 3, 0, 2, 0);
  function ADDN(coeffn, p, q, r, s) {
    return coeffn * Term(p, q, r, s).y;
  }
  N = 0;
  N += ADDN(-526.069, 0, 0, 1, -2);
  N += ADDN(-3.352, 0, 0, 1, -4);
  N += ADDN(44.297, 1, 0, 1, -2);
  N += ADDN(-6, 1, 0, 1, -4);
  N += ADDN(20.599, -1, 0, 1, 0);
  N += ADDN(-30.598, -1, 0, 1, -2);
  N += ADDN(-24.649, -2, 0, 1, 0);
  N += ADDN(-2, -2, 0, 1, -2);
  N += ADDN(-22.571, 0, 1, 1, -2);
  N += ADDN(10.985, 0, -1, 1, -2);
  DLAM += 0.82 * Sine(0.7736 - 62.5512 * T) + 0.31 * Sine(0.0466 - 125.1025 * T) + 0.35 * Sine(0.5785 - 25.1042 * T) + 0.66 * Sine(0.4591 + 1335.8075 * T) + 0.64 * Sine(0.313 - 91.568 * T) + 1.14 * Sine(0.148 + 1331.2898 * T) + 0.21 * Sine(0.5918 + 1056.5859 * T) + 0.44 * Sine(0.5784 + 1322.8595 * T) + 0.24 * Sine(0.2275 - 5.7374 * T) + 0.28 * Sine(0.2965 + 2.6929 * T) + 0.33 * Sine(0.3132 + 6.3368 * T);
  S = F + DS / ARC;
  let lat_seconds = (1.000002708 + 139.978 * DGAM) * (18518.511 + 1.189 + GAM1C) * Math.sin(S) - 6.24 * Math.sin(3 * S) + N;
  return {
    geo_eclip_lon: PI2 * Frac((L0 + DLAM / ARC) / PI2),
    geo_eclip_lat: Math.PI / (180 * 3600) * lat_seconds,
    distance_au: ARC * EARTH_EQUATORIAL_RADIUS_AU / (0.999953253 * SINPI)
  };
}
function rotate(rot, vec) {
  return [
    rot.rot[0][0] * vec[0] + rot.rot[1][0] * vec[1] + rot.rot[2][0] * vec[2],
    rot.rot[0][1] * vec[0] + rot.rot[1][1] * vec[1] + rot.rot[2][1] * vec[2],
    rot.rot[0][2] * vec[0] + rot.rot[1][2] * vec[1] + rot.rot[2][2] * vec[2]
  ];
}
function precession(pos, time, dir) {
  const r = precession_rot(time, dir);
  return rotate(r, pos);
}
function precession_rot(time, dir) {
  const t = time.tt / 36525;
  let eps0 = 84381.406;
  let psia = ((((-951e-10 * t + 132851e-9) * t - 114045e-8) * t - 1.0790069) * t + 5038.481507) * t;
  let omegaa = ((((3337e-10 * t - 467e-9) * t - 772503e-8) * t + 0.0512623) * t - 0.025754) * t + eps0;
  let chia = ((((-56e-9 * t + 170663e-9) * t - 121197e-8) * t - 2.3814292) * t + 10.556403) * t;
  eps0 *= ASEC2RAD;
  psia *= ASEC2RAD;
  omegaa *= ASEC2RAD;
  chia *= ASEC2RAD;
  const sa = Math.sin(eps0);
  const ca = Math.cos(eps0);
  const sb = Math.sin(-psia);
  const cb = Math.cos(-psia);
  const sc = Math.sin(-omegaa);
  const cc = Math.cos(-omegaa);
  const sd = Math.sin(chia);
  const cd = Math.cos(chia);
  const xx = cd * cb - sb * sd * cc;
  const yx = cd * sb * ca + sd * cc * cb * ca - sa * sd * sc;
  const zx = cd * sb * sa + sd * cc * cb * sa + ca * sd * sc;
  const xy = -sd * cb - sb * cd * cc;
  const yy = -sd * sb * ca + cd * cc * cb * ca - sa * cd * sc;
  const zy = -sd * sb * sa + cd * cc * cb * sa + ca * cd * sc;
  const xz = sb * sc;
  const yz = -sc * cb * ca - sa * cc;
  const zz = -sc * cb * sa + cc * ca;
  if (dir === PrecessDirection.Into2000) {
    return new RotationMatrix([
      [xx, yx, zx],
      [xy, yy, zy],
      [xz, yz, zz]
    ]);
  }
  if (dir === PrecessDirection.From2000) {
    return new RotationMatrix([
      [xx, xy, xz],
      [yx, yy, yz],
      [zx, zy, zz]
    ]);
  }
  throw "Invalid precess direction";
}
function era(time) {
  const thet1 = 0.779057273264 + 0.00273781191135448 * time.ut;
  const thet3 = time.ut % 1;
  let theta = 360 * ((thet1 + thet3) % 1);
  if (theta < 0) {
    theta += 360;
  }
  return theta;
}
var sidereal_time_cache;
function sidereal_time(time) {
  if (!sidereal_time_cache || sidereal_time_cache.tt !== time.tt) {
    const t = time.tt / 36525;
    let eqeq = 15 * e_tilt(time).ee;
    const theta = era(time);
    const st = eqeq + 0.014506 + ((((-368e-10 * t - 29956e-9) * t - 44e-8) * t + 1.3915817) * t + 4612.156534) * t;
    let gst = (st / 3600 + theta) % 360 / 15;
    if (gst < 0) {
      gst += 24;
    }
    sidereal_time_cache = {
      tt: time.tt,
      st: gst
    };
  }
  return sidereal_time_cache.st;
}
function SiderealTime(date) {
  const time = MakeTime(date);
  return sidereal_time(time);
}
function nutation(pos, time, dir) {
  const r = nutation_rot(time, dir);
  return rotate(r, pos);
}
function nutation_rot(time, dir) {
  const tilt = e_tilt(time);
  const oblm = tilt.mobl * DEG2RAD;
  const oblt = tilt.tobl * DEG2RAD;
  const psi = tilt.dpsi * ASEC2RAD;
  const cobm = Math.cos(oblm);
  const sobm = Math.sin(oblm);
  const cobt = Math.cos(oblt);
  const sobt = Math.sin(oblt);
  const cpsi = Math.cos(psi);
  const spsi = Math.sin(psi);
  const xx = cpsi;
  const yx = -spsi * cobm;
  const zx = -spsi * sobm;
  const xy = spsi * cobt;
  const yy = cpsi * cobm * cobt + sobm * sobt;
  const zy = cpsi * sobm * cobt - cobm * sobt;
  const xz = spsi * sobt;
  const yz = cpsi * cobm * sobt - sobm * cobt;
  const zz = cpsi * sobm * sobt + cobm * cobt;
  if (dir === PrecessDirection.From2000) {
    return new RotationMatrix([
      [xx, xy, xz],
      [yx, yy, yz],
      [zx, zy, zz]
    ]);
  }
  if (dir === PrecessDirection.Into2000) {
    return new RotationMatrix([
      [xx, yx, zx],
      [xy, yy, zy],
      [xz, yz, zz]
    ]);
  }
  throw "Invalid precess direction";
}
function gyration(pos, time, dir) {
  return dir === PrecessDirection.Into2000 ? precession(nutation(pos, time, dir), time, dir) : nutation(precession(pos, time, dir), time, dir);
}
var Vector = class {
  constructor(x, y, z, t) {
    this.x = x;
    this.y = y;
    this.z = z;
    this.t = t;
  }
  /**
   * Returns the length of the vector in astronomical units (AU).
   * @returns {number}
   */
  Length() {
    return Math.hypot(this.x, this.y, this.z);
  }
};
var StateVector = class {
  constructor(x, y, z, vx, vy, vz, t) {
    this.x = x;
    this.y = y;
    this.z = z;
    this.vx = vx;
    this.vy = vy;
    this.vz = vz;
    this.t = t;
  }
};
var Spherical = class {
  constructor(lat, lon, dist) {
    this.lat = VerifyNumber(lat);
    this.lon = VerifyNumber(lon);
    this.dist = VerifyNumber(dist);
  }
};
var RotationMatrix = class {
  constructor(rot) {
    this.rot = rot;
  }
};
var EclipticCoordinates = class {
  constructor(vec, elat, elon) {
    this.vec = vec;
    this.elat = VerifyNumber(elat);
    this.elon = VerifyNumber(elon);
  }
};
function VectorFromArray(av, time) {
  return new Vector(av[0], av[1], av[2], time);
}
function SunPosition(date) {
  const time = MakeTime(date).AddDays(-1 / C_AUDAY);
  const earth2000 = CalcVsop(vsop.Earth, time);
  const sun2000 = [-earth2000.x, -earth2000.y, -earth2000.z];
  const [gx, gy, gz] = gyration(sun2000, time, PrecessDirection.From2000);
  const true_obliq = DEG2RAD * e_tilt(time).tobl;
  const cos_ob = Math.cos(true_obliq);
  const sin_ob = Math.sin(true_obliq);
  const vec = new Vector(gx, gy, gz, time);
  const sun_ecliptic = RotateEquatorialToEcliptic(vec, cos_ob, sin_ob);
  return sun_ecliptic;
}
function RotateEquatorialToEcliptic(equ, cos_ob, sin_ob) {
  const ex = equ.x;
  const ey = equ.y * cos_ob + equ.z * sin_ob;
  const ez = -equ.y * sin_ob + equ.z * cos_ob;
  const xyproj = Math.hypot(ex, ey);
  let elon = 0;
  if (xyproj > 0) {
    elon = RAD2DEG * Math.atan2(ey, ex);
    if (elon < 0)
      elon += 360;
  }
  let elat = RAD2DEG * Math.atan2(ez, xyproj);
  let ecl = new Vector(ex, ey, ez, equ.t);
  return new EclipticCoordinates(ecl, elat, elon);
}
function Ecliptic(eqj) {
  const et = e_tilt(eqj.t);
  const eqj_pos = [eqj.x, eqj.y, eqj.z];
  const mean_pos = precession(eqj_pos, eqj.t, PrecessDirection.From2000);
  const [x, y, z] = nutation(mean_pos, eqj.t, PrecessDirection.From2000);
  const eqd = new Vector(x, y, z, eqj.t);
  const tobl = et.tobl * DEG2RAD;
  return RotateEquatorialToEcliptic(eqd, Math.cos(tobl), Math.sin(tobl));
}
function GeoMoon(date) {
  const time = MakeTime(date);
  const moon2 = CalcMoon(time);
  const dist_cos_lat = moon2.distance_au * Math.cos(moon2.geo_eclip_lat);
  const gepos = [
    dist_cos_lat * Math.cos(moon2.geo_eclip_lon),
    dist_cos_lat * Math.sin(moon2.geo_eclip_lon),
    moon2.distance_au * Math.sin(moon2.geo_eclip_lat)
  ];
  const mpos1 = ecl2equ_vec(time, gepos);
  const mpos2 = precession(mpos1, time, PrecessDirection.Into2000);
  return new Vector(mpos2[0], mpos2[1], mpos2[2], time);
}
function EclipticGeoMoon(date) {
  const time = MakeTime(date);
  const moon2 = CalcMoon(time);
  const dist_cos_lat = moon2.distance_au * Math.cos(moon2.geo_eclip_lat);
  const ecm = [
    dist_cos_lat * Math.cos(moon2.geo_eclip_lon),
    dist_cos_lat * Math.sin(moon2.geo_eclip_lon),
    moon2.distance_au * Math.sin(moon2.geo_eclip_lat)
  ];
  const et = e_tilt(time);
  const eqm = obl_ecl2equ_vec(et.mobl, ecm);
  const eqd = nutation(eqm, time, PrecessDirection.From2000);
  const eqd_vec = VectorFromArray(eqd, time);
  const toblRad = et.tobl * DEG2RAD;
  const cos_tobl = Math.cos(toblRad);
  const sin_tobl = Math.sin(toblRad);
  const eclip = RotateEquatorialToEcliptic(eqd_vec, cos_tobl, sin_tobl);
  return new Spherical(eclip.elat, eclip.elon, moon2.distance_au);
}
function GeoMoonState(date) {
  const time = MakeTime(date);
  const dt = 1e-5;
  const t1 = time.AddDays(-dt);
  const t2 = time.AddDays(+dt);
  const r1 = GeoMoon(t1);
  const r2 = GeoMoon(t2);
  return new StateVector((r1.x + r2.x) / 2, (r1.y + r2.y) / 2, (r1.z + r2.z) / 2, (r2.x - r1.x) / (2 * dt), (r2.y - r1.y) / (2 * dt), (r2.z - r1.z) / (2 * dt), time);
}
function GeoEmbState(date) {
  const time = MakeTime(date);
  const s = GeoMoonState(time);
  const d = 1 + EARTH_MOON_MASS_RATIO;
  return new StateVector(s.x / d, s.y / d, s.z / d, s.vx / d, s.vy / d, s.vz / d, time);
}
function VsopFormula(formula, t, clamp_angle) {
  let tpower = 1;
  let coord = 0;
  for (let series of formula) {
    let sum = 0;
    for (let [ampl, phas, freq] of series)
      sum += ampl * Math.cos(phas + t * freq);
    let incr = tpower * sum;
    if (clamp_angle)
      incr %= PI2;
    coord += incr;
    tpower *= t;
  }
  return coord;
}
function VsopDeriv(formula, t) {
  let tpower = 1;
  let dpower = 0;
  let deriv = 0;
  let s = 0;
  for (let series of formula) {
    let sin_sum = 0;
    let cos_sum = 0;
    for (let [ampl, phas, freq] of series) {
      let angle = phas + t * freq;
      sin_sum += ampl * freq * Math.sin(angle);
      if (s > 0)
        cos_sum += ampl * Math.cos(angle);
    }
    deriv += s * dpower * cos_sum - tpower * sin_sum;
    dpower = tpower;
    tpower *= t;
    ++s;
  }
  return deriv;
}
var DAYS_PER_MILLENNIUM = 365250;
var LON_INDEX = 0;
var LAT_INDEX = 1;
var RAD_INDEX = 2;
function VsopRotate(eclip) {
  return new TerseVector(eclip[0] + 44036e-11 * eclip[1] - 190919e-12 * eclip[2], -479966e-12 * eclip[0] + 0.917482137087 * eclip[1] - 0.397776982902 * eclip[2], 0.397776982902 * eclip[1] + 0.917482137087 * eclip[2]);
}
function VsopSphereToRect(lon, lat, radius) {
  const r_coslat = radius * Math.cos(lat);
  const coslon = Math.cos(lon);
  const sinlon = Math.sin(lon);
  return [
    r_coslat * coslon,
    r_coslat * sinlon,
    radius * Math.sin(lat)
  ];
}
function CalcVsop(model, time) {
  const t = time.tt / DAYS_PER_MILLENNIUM;
  const lon = VsopFormula(model[LON_INDEX], t, true);
  const lat = VsopFormula(model[LAT_INDEX], t, false);
  const rad = VsopFormula(model[RAD_INDEX], t, false);
  const eclip = VsopSphereToRect(lon, lat, rad);
  return VsopRotate(eclip).ToAstroVector(time);
}
function CalcVsopPosVel(model, tt) {
  const t = tt / DAYS_PER_MILLENNIUM;
  const lon = VsopFormula(model[LON_INDEX], t, true);
  const lat = VsopFormula(model[LAT_INDEX], t, false);
  const rad = VsopFormula(model[RAD_INDEX], t, false);
  const dlon_dt = VsopDeriv(model[LON_INDEX], t);
  const dlat_dt = VsopDeriv(model[LAT_INDEX], t);
  const drad_dt = VsopDeriv(model[RAD_INDEX], t);
  const coslon = Math.cos(lon);
  const sinlon = Math.sin(lon);
  const coslat = Math.cos(lat);
  const sinlat = Math.sin(lat);
  const vx = +(drad_dt * coslat * coslon) - rad * sinlat * coslon * dlat_dt - rad * coslat * sinlon * dlon_dt;
  const vy = +(drad_dt * coslat * sinlon) - rad * sinlat * sinlon * dlat_dt + rad * coslat * coslon * dlon_dt;
  const vz = +(drad_dt * sinlat) + rad * coslat * dlat_dt;
  const eclip_pos = VsopSphereToRect(lon, lat, rad);
  const eclip_vel = [
    vx / DAYS_PER_MILLENNIUM,
    vy / DAYS_PER_MILLENNIUM,
    vz / DAYS_PER_MILLENNIUM
  ];
  const equ_pos = VsopRotate(eclip_pos);
  const equ_vel = VsopRotate(eclip_vel);
  return new body_state_t(tt, equ_pos, equ_vel);
}
function AdjustBarycenter(ssb, time, body, pmass) {
  const shift = pmass / (pmass + SUN_GM);
  const planet = CalcVsop(vsop[body], time);
  ssb.x += shift * planet.x;
  ssb.y += shift * planet.y;
  ssb.z += shift * planet.z;
}
function CalcSolarSystemBarycenter(time) {
  const ssb = new Vector(0, 0, 0, time);
  AdjustBarycenter(ssb, time, Body.Jupiter, JUPITER_GM);
  AdjustBarycenter(ssb, time, Body.Saturn, SATURN_GM);
  AdjustBarycenter(ssb, time, Body.Uranus, URANUS_GM);
  AdjustBarycenter(ssb, time, Body.Neptune, NEPTUNE_GM);
  return ssb;
}
var PLUTO_NUM_STATES = 51;
var PLUTO_TIME_STEP = 29200;
var PLUTO_DT = 146;
var PLUTO_NSTEPS = 201;
var PlutoStateTable = [
  [-73e4, [-26.118207232108, -14.376168177825, 3.384402515299], [0.0016339372163656, -0.0027861699588508, -0.0013585880229445]],
  [-700800, [41.974905202127, -0.448502952929, -12.770351505989], [73458569351457e-17, 0.0022785014891658, 48619778602049e-17]],
  [-671600, [14.706930780744, 44.269110540027, 9.353698474772], [-0.00210001479998, 22295915939915e-17, 70143443551414e-17]],
  [-642400, [-29.441003929957, -6.43016153057, 6.858481011305], [84495803960544e-17, -0.0030783914758711, -0.0012106305981192]],
  [-613200, [39.444396946234, -6.557989760571, -13.913760296463], [0.0011480029005873, 0.0022400006880665, 35168075922288e-17]],
  [-584e3, [20.2303809507, 43.266966657189, 7.382966091923], [-0.0019754081700585, 53457141292226e-17, 75929169129793e-17]],
  [-554800, [-30.65832536462, 2.093818874552, 9.880531138071], [61010603013347e-18, -0.0031326500935382, -99346125151067e-17]],
  [-525600, [35.737703251673, -12.587706024764, -14.677847247563], [0.0015802939375649, 0.0021347678412429, 19074436384343e-17]],
  [-496400, [25.466295188546, 41.367478338417, 5.216476873382], [-0.0018054401046468, 8328308359951e-16, 80260156912107e-17]],
  [-467200, [-29.847174904071, 10.636426313081, 12.297904180106], [-63257063052907e-17, -0.0029969577578221, -74476074151596e-17]],
  [-438e3, [30.774692107687, -18.236637015304, -14.945535879896], [0.0020113162005465, 0.0019353827024189, -20937793168297e-19]],
  [-408800, [30.243153324028, 38.656267888503, 2.938501750218], [-0.0016052508674468, 0.0011183495337525, 83333973416824e-17]],
  [-379600, [-27.288984772533, 18.643162147874, 14.023633623329], [-0.0011856388898191, -0.0027170609282181, -49015526126399e-17]],
  [-350400, [24.519605196774, -23.245756064727, -14.626862367368], [0.0024322321483154, 0.0016062008146048, -23369181613312e-17]],
  [-321200, [34.505274805875, 35.125338586954, 0.557361475637], [-0.0013824391637782, 0.0013833397561817, 84823598806262e-17]],
  [-292e3, [-23.275363915119, 25.818514298769, 15.055381588598], [-0.0016062295460975, -0.0023395961498533, -24377362639479e-17]],
  [-262800, [17.050384798092, -27.180376290126, -13.608963321694], [0.0028175521080578, 0.0011358749093955, -49548725258825e-17]],
  [-233600, [38.093671910285, 30.880588383337, -1.843688067413], [-0.0011317697153459, 0.0016128814698472, 84177586176055e-17]],
  [-204400, [-18.197852930878, 31.932869934309, 15.438294826279], [-0.0019117272501813, -0.0019146495909842, -19657304369835e-18]],
  [-175200, [8.528924039997, -29.618422200048, -11.805400994258], [0.0031034370787005, 5139363329243e-16, -77293066202546e-17]],
  [-146e3, [40.94685725864, 25.904973592021, -4.256336240499], [-83652705194051e-17, 0.0018129497136404, 8156422827306e-16]],
  [-116800, [-12.326958895325, 36.881883446292, 15.217158258711], [-0.0021166103705038, -0.001481442003599, 17401209844705e-17]],
  [-87600, [-0.633258375909, -30.018759794709, -9.17193287495], [0.0032016994581737, -25279858672148e-17, -0.0010411088271861]],
  [-58400, [42.936048423883, 20.344685584452, -6.588027007912], [-50525450073192e-17, 0.0019910074335507, 77440196540269e-17]],
  [-29200, [-5.975910552974, 40.61180995846, 14.470131723673], [-0.0022184202156107, -0.0010562361130164, 33652250216211e-17]],
  [0, [-9.875369580774, -27.978926224737, -5.753711824704], [0.0030287533248818, -0.0011276087003636, -0.0012651326732361]],
  [29200, [43.958831986165, 14.214147973292, -8.808306227163], [-14717608981871e-17, 0.0021404187242141, 71486567806614e-17]],
  [58400, [0.67813676352, 43.094461639362, 13.243238780721], [-0.0022358226110718, -63233636090933e-17, 47664798895648e-17]],
  [87600, [-18.282602096834, -23.30503958666, -1.766620508028], [0.0025567245263557, -0.0019902940754171, -0.0013943491701082]],
  [116800, [43.873338744526, 7.700705617215, -10.814273666425], [23174803055677e-17, 0.0022402163127924, 62988756452032e-17]],
  [146e3, [7.392949027906, 44.382678951534, 11.629500214854], [-0.002193281545383, -21751799585364e-17, 59556516201114e-17]],
  [175200, [-24.981690229261, -16.204012851426, 2.466457544298], [0.001819398914958, -0.0026765419531201, -0.0013848283502247]],
  [204400, [42.530187039511, 0.845935508021, -12.554907527683], [65059779150669e-17, 0.0022725657282262, 51133743202822e-17]],
  [233600, [13.999526486822, 44.462363044894, 9.669418486465], [-0.0021079296569252, 17533423831993e-17, 69128485798076e-17]],
  [262800, [-29.184024803031, -7.371243995762, 6.493275957928], [93581363109681e-17, -0.0030610357109184, -0.0012364201089345]],
  [292e3, [39.831980671753, -6.078405766765, -13.909815358656], [0.0011117769689167, 0.0022362097830152, 36230548231153e-17]],
  [321200, [20.294955108476, 43.417190420251, 7.450091985932], [-0.0019742157451535, 53102050468554e-17, 75938408813008e-17]],
  [350400, [-30.66999230216, 2.318743558955, 9.973480913858], [45605107450676e-18, -0.0031308219926928, -99066533301924e-17]],
  [379600, [35.626122155983, -12.897647509224, -14.777586508444], [0.0016015684949743, 0.0021171931182284, 18002516202204e-17]],
  [408800, [26.133186148561, 41.232139187599, 5.00640132622], [-0.0017857704419579, 86046232702817e-17, 80614690298954e-17]],
  [438e3, [-29.57674022923, 11.863535943587, 12.631323039872], [-72292830060955e-17, -0.0029587820140709, -708242964503e-15]],
  [467200, [29.910805787391, -19.159019294, -15.013363865194], [0.0020871080437997, 0.0018848372554514, -38528655083926e-18]],
  [496400, [31.375957451819, 38.050372720763, 2.433138343754], [-0.0015546055556611, 0.0011699815465629, 83565439266001e-17]],
  [525600, [-26.360071336928, 20.662505904952, 14.414696258958], [-0.0013142373118349, -0.0026236647854842, -42542017598193e-17]],
  [554800, [22.599441488648, -24.508879898306, -14.484045731468], [0.0025454108304806, 0.0014917058755191, -30243665086079e-17]],
  [584e3, [35.877864013014, 33.894226366071, -0.224524636277], [-0.0012941245730845, 0.0014560427668319, 84762160640137e-17]],
  [613200, [-21.538149762417, 28.204068269761, 15.321973799534], [-0.001731211740901, -0.0021939631314577, -1631691327518e-16]],
  [642400, [13.971521374415, -28.339941764789, -13.083792871886], [0.0029334630526035, 91860931752944e-17, -59939422488627e-17]],
  [671600, [39.526942044143, 28.93989736011, -2.872799527539], [-0.0010068481658095, 0.001702113288809, 83578230511981e-17]],
  [700800, [-15.576200701394, 34.399412961275, 15.466033737854], [-0.0020098814612884, -0.0017191109825989, 70414782780416e-18]],
  [73e4, [4.24325283709, -30.118201690825, -10.707441231349], [0.0031725847067411, 1609846120227e-16, -90672150593868e-17]]
];
var TerseVector = class _TerseVector {
  constructor(x, y, z) {
    this.x = x;
    this.y = y;
    this.z = z;
  }
  clone() {
    return new _TerseVector(this.x, this.y, this.z);
  }
  ToAstroVector(t) {
    return new Vector(this.x, this.y, this.z, t);
  }
  static zero() {
    return new _TerseVector(0, 0, 0);
  }
  quadrature() {
    return this.x * this.x + this.y * this.y + this.z * this.z;
  }
  add(other) {
    return new _TerseVector(this.x + other.x, this.y + other.y, this.z + other.z);
  }
  sub(other) {
    return new _TerseVector(this.x - other.x, this.y - other.y, this.z - other.z);
  }
  incr(other) {
    this.x += other.x;
    this.y += other.y;
    this.z += other.z;
  }
  decr(other) {
    this.x -= other.x;
    this.y -= other.y;
    this.z -= other.z;
  }
  mul(scalar) {
    return new _TerseVector(scalar * this.x, scalar * this.y, scalar * this.z);
  }
  div(scalar) {
    return new _TerseVector(this.x / scalar, this.y / scalar, this.z / scalar);
  }
  mean(other) {
    return new _TerseVector((this.x + other.x) / 2, (this.y + other.y) / 2, (this.z + other.z) / 2);
  }
  neg() {
    return new _TerseVector(-this.x, -this.y, -this.z);
  }
};
var body_state_t = class _body_state_t {
  constructor(tt, r, v) {
    this.tt = tt;
    this.r = r;
    this.v = v;
  }
  clone() {
    return new _body_state_t(this.tt, this.r, this.v);
  }
  sub(other) {
    return new _body_state_t(this.tt, this.r.sub(other.r), this.v.sub(other.v));
  }
};
function BodyStateFromTable(entry) {
  let [tt, [rx, ry, rz], [vx, vy, vz]] = entry;
  return new body_state_t(tt, new TerseVector(rx, ry, rz), new TerseVector(vx, vy, vz));
}
function AdjustBarycenterPosVel(ssb, tt, body, planet_gm) {
  const shift = planet_gm / (planet_gm + SUN_GM);
  const planet = CalcVsopPosVel(vsop[body], tt);
  ssb.r.incr(planet.r.mul(shift));
  ssb.v.incr(planet.v.mul(shift));
  return planet;
}
function AccelerationIncrement(small_pos, gm, major_pos) {
  const delta = major_pos.sub(small_pos);
  const r2 = delta.quadrature();
  return delta.mul(gm / (r2 * Math.sqrt(r2)));
}
var major_bodies_t = class {
  constructor(tt) {
    let ssb = new body_state_t(tt, new TerseVector(0, 0, 0), new TerseVector(0, 0, 0));
    this.Jupiter = AdjustBarycenterPosVel(ssb, tt, Body.Jupiter, JUPITER_GM);
    this.Saturn = AdjustBarycenterPosVel(ssb, tt, Body.Saturn, SATURN_GM);
    this.Uranus = AdjustBarycenterPosVel(ssb, tt, Body.Uranus, URANUS_GM);
    this.Neptune = AdjustBarycenterPosVel(ssb, tt, Body.Neptune, NEPTUNE_GM);
    this.Jupiter.r.decr(ssb.r);
    this.Jupiter.v.decr(ssb.v);
    this.Saturn.r.decr(ssb.r);
    this.Saturn.v.decr(ssb.v);
    this.Uranus.r.decr(ssb.r);
    this.Uranus.v.decr(ssb.v);
    this.Neptune.r.decr(ssb.r);
    this.Neptune.v.decr(ssb.v);
    this.Sun = new body_state_t(tt, ssb.r.mul(-1), ssb.v.mul(-1));
  }
  Acceleration(pos) {
    let acc = AccelerationIncrement(pos, SUN_GM, this.Sun.r);
    acc.incr(AccelerationIncrement(pos, JUPITER_GM, this.Jupiter.r));
    acc.incr(AccelerationIncrement(pos, SATURN_GM, this.Saturn.r));
    acc.incr(AccelerationIncrement(pos, URANUS_GM, this.Uranus.r));
    acc.incr(AccelerationIncrement(pos, NEPTUNE_GM, this.Neptune.r));
    return acc;
  }
};
var body_grav_calc_t = class _body_grav_calc_t {
  constructor(tt, r, v, a) {
    this.tt = tt;
    this.r = r;
    this.v = v;
    this.a = a;
  }
  clone() {
    return new _body_grav_calc_t(this.tt, this.r.clone(), this.v.clone(), this.a.clone());
  }
};
var grav_sim_t = class {
  constructor(bary, grav) {
    this.bary = bary;
    this.grav = grav;
  }
};
function UpdatePosition(dt, r, v, a) {
  return new TerseVector(r.x + dt * (v.x + dt * a.x / 2), r.y + dt * (v.y + dt * a.y / 2), r.z + dt * (v.z + dt * a.z / 2));
}
function UpdateVelocity(dt, v, a) {
  return new TerseVector(v.x + dt * a.x, v.y + dt * a.y, v.z + dt * a.z);
}
function GravSim(tt2, calc1) {
  const dt = tt2 - calc1.tt;
  const bary2 = new major_bodies_t(tt2);
  const approx_pos = UpdatePosition(dt, calc1.r, calc1.v, calc1.a);
  const mean_acc = bary2.Acceleration(approx_pos).mean(calc1.a);
  const pos = UpdatePosition(dt, calc1.r, calc1.v, mean_acc);
  const vel = calc1.v.add(mean_acc.mul(dt));
  const acc = bary2.Acceleration(pos);
  const grav = new body_grav_calc_t(tt2, pos, vel, acc);
  return new grav_sim_t(bary2, grav);
}
var pluto_cache = [];
function ClampIndex(frac, nsteps) {
  const index = Math.floor(frac);
  if (index < 0)
    return 0;
  if (index >= nsteps)
    return nsteps - 1;
  return index;
}
function GravFromState(entry) {
  const state = BodyStateFromTable(entry);
  const bary = new major_bodies_t(state.tt);
  const r = state.r.add(bary.Sun.r);
  const v = state.v.add(bary.Sun.v);
  const a = bary.Acceleration(r);
  const grav = new body_grav_calc_t(state.tt, r, v, a);
  return new grav_sim_t(bary, grav);
}
function GetSegment(cache, tt) {
  const t0 = PlutoStateTable[0][0];
  if (tt < t0 || tt > PlutoStateTable[PLUTO_NUM_STATES - 1][0]) {
    return null;
  }
  const seg_index = ClampIndex((tt - t0) / PLUTO_TIME_STEP, PLUTO_NUM_STATES - 1);
  if (!cache[seg_index]) {
    const seg = cache[seg_index] = [];
    seg[0] = GravFromState(PlutoStateTable[seg_index]).grav;
    seg[PLUTO_NSTEPS - 1] = GravFromState(PlutoStateTable[seg_index + 1]).grav;
    let i;
    let step_tt = seg[0].tt;
    for (i = 1; i < PLUTO_NSTEPS - 1; ++i)
      seg[i] = GravSim(step_tt += PLUTO_DT, seg[i - 1]).grav;
    step_tt = seg[PLUTO_NSTEPS - 1].tt;
    var reverse = [];
    reverse[PLUTO_NSTEPS - 1] = seg[PLUTO_NSTEPS - 1];
    for (i = PLUTO_NSTEPS - 2; i > 0; --i)
      reverse[i] = GravSim(step_tt -= PLUTO_DT, reverse[i + 1]).grav;
    for (i = PLUTO_NSTEPS - 2; i > 0; --i) {
      const ramp = i / (PLUTO_NSTEPS - 1);
      seg[i].r = seg[i].r.mul(1 - ramp).add(reverse[i].r.mul(ramp));
      seg[i].v = seg[i].v.mul(1 - ramp).add(reverse[i].v.mul(ramp));
      seg[i].a = seg[i].a.mul(1 - ramp).add(reverse[i].a.mul(ramp));
    }
  }
  return cache[seg_index];
}
function CalcPlutoOneWay(entry, target_tt, dt) {
  let sim = GravFromState(entry);
  const n = Math.ceil((target_tt - sim.grav.tt) / dt);
  for (let i = 0; i < n; ++i)
    sim = GravSim(i + 1 === n ? target_tt : sim.grav.tt + dt, sim.grav);
  return sim;
}
function CalcPluto(time, helio) {
  let r, v, bary;
  const seg = GetSegment(pluto_cache, time.tt);
  if (!seg) {
    let sim;
    if (time.tt < PlutoStateTable[0][0])
      sim = CalcPlutoOneWay(PlutoStateTable[0], time.tt, -PLUTO_DT);
    else
      sim = CalcPlutoOneWay(PlutoStateTable[PLUTO_NUM_STATES - 1], time.tt, +PLUTO_DT);
    r = sim.grav.r;
    v = sim.grav.v;
    bary = sim.bary;
  } else {
    const left = ClampIndex((time.tt - seg[0].tt) / PLUTO_DT, PLUTO_NSTEPS - 1);
    const s1 = seg[left];
    const s2 = seg[left + 1];
    const acc = s1.a.mean(s2.a);
    const ra = UpdatePosition(time.tt - s1.tt, s1.r, s1.v, acc);
    const va = UpdateVelocity(time.tt - s1.tt, s1.v, acc);
    const rb = UpdatePosition(time.tt - s2.tt, s2.r, s2.v, acc);
    const vb = UpdateVelocity(time.tt - s2.tt, s2.v, acc);
    const ramp = (time.tt - s1.tt) / PLUTO_DT;
    r = ra.mul(1 - ramp).add(rb.mul(ramp));
    v = va.mul(1 - ramp).add(vb.mul(ramp));
  }
  if (helio) {
    if (!bary)
      bary = new major_bodies_t(time.tt);
    r = r.sub(bary.Sun.r);
    v = v.sub(bary.Sun.v);
  }
  return new StateVector(r.x, r.y, r.z, v.x, v.y, v.z, time);
}
var Rotation_JUP_EQJ = new RotationMatrix([
  [0.999432765338654, -0.0336771074697641, 0],
  [0.0303959428906285, 0.902057912352809, 0.430543388542295],
  [-0.0144994559663353, -0.430299169409101, 0.902569881273754]
]);
function HelioVector(body, date) {
  var time = MakeTime(date);
  if (body in vsop)
    return CalcVsop(vsop[body], time);
  if (body === Body.Pluto) {
    const p = CalcPluto(time, true);
    return new Vector(p.x, p.y, p.z, time);
  }
  if (body === Body.Sun)
    return new Vector(0, 0, 0, time);
  if (body === Body.Moon) {
    var e = CalcVsop(vsop.Earth, time);
    var m = GeoMoon(time);
    return new Vector(e.x + m.x, e.y + m.y, e.z + m.z, time);
  }
  if (body === Body.EMB) {
    const e2 = CalcVsop(vsop.Earth, time);
    const m2 = GeoMoon(time);
    const denom = 1 + EARTH_MOON_MASS_RATIO;
    return new Vector(e2.x + m2.x / denom, e2.y + m2.y / denom, e2.z + m2.z / denom, time);
  }
  if (body === Body.SSB)
    return CalcSolarSystemBarycenter(time);
  const star = UserDefinedStar(body);
  if (star) {
    const sphere = new Spherical(star.dec, 15 * star.ra, star.dist);
    return VectorFromSphere(sphere, time);
  }
  throw `HelioVector: Unknown body "${body}"`;
}
function CorrectLightTravel(func, time) {
  let ltime = time;
  let dt = 0;
  for (let iter = 0; iter < 10; ++iter) {
    const pos = func(ltime);
    const lt = pos.Length() / C_AUDAY;
    if (lt > 1)
      throw `Object is too distant for light-travel solver.`;
    const ltime2 = time.AddDays(-lt);
    dt = Math.abs(ltime2.tt - ltime.tt);
    if (dt < 1e-9)
      return pos;
    ltime = ltime2;
  }
  throw `Light-travel time solver did not converge: dt = ${dt}`;
}
var BodyPosition = class {
  constructor(observerBody, targetBody, aberration, observerPos) {
    this.observerBody = observerBody;
    this.targetBody = targetBody;
    this.aberration = aberration;
    this.observerPos = observerPos;
  }
  Position(time) {
    if (this.aberration) {
      this.observerPos = HelioVector(this.observerBody, time);
    } else {
    }
    const targetPos = HelioVector(this.targetBody, time);
    return new Vector(targetPos.x - this.observerPos.x, targetPos.y - this.observerPos.y, targetPos.z - this.observerPos.z, time);
  }
};
function BackdatePosition(date, observerBody, targetBody, aberration) {
  VerifyBoolean(aberration);
  const time = MakeTime(date);
  if (UserDefinedStar(targetBody)) {
    const tvec = HelioVector(targetBody, time);
    if (aberration) {
      const ostate = HelioState(observerBody, time);
      const rvec = new Vector(tvec.x - ostate.x, tvec.y - ostate.y, tvec.z - ostate.z, time);
      const s = C_AUDAY / rvec.Length();
      return new Vector(rvec.x + ostate.vx / s, rvec.y + ostate.vy / s, rvec.z + ostate.vz / s, time);
    }
    const ovec = HelioVector(observerBody, time);
    return new Vector(tvec.x - ovec.x, tvec.y - ovec.y, tvec.z - ovec.z, time);
  }
  let observerPos;
  if (aberration) {
    observerPos = new Vector(0, 0, 0, time);
  } else {
    observerPos = HelioVector(observerBody, time);
  }
  const bpos = new BodyPosition(observerBody, targetBody, aberration, observerPos);
  return CorrectLightTravel((t) => bpos.Position(t), time);
}
function GeoVector(body, date, aberration) {
  VerifyBoolean(aberration);
  const time = MakeTime(date);
  switch (body) {
    case Body.Earth:
      return new Vector(0, 0, 0, time);
    case Body.Moon:
      return GeoMoon(time);
    default:
      const vec = BackdatePosition(time, Body.Earth, body, aberration);
      vec.t = time;
      return vec;
  }
}
function ExportState(terse, time) {
  return new StateVector(terse.r.x, terse.r.y, terse.r.z, terse.v.x, terse.v.y, terse.v.z, time);
}
function HelioState(body, date) {
  const time = MakeTime(date);
  switch (body) {
    case Body.Sun:
      return new StateVector(0, 0, 0, 0, 0, 0, time);
    case Body.SSB:
      const bary = new major_bodies_t(time.tt);
      return new StateVector(-bary.Sun.r.x, -bary.Sun.r.y, -bary.Sun.r.z, -bary.Sun.v.x, -bary.Sun.v.y, -bary.Sun.v.z, time);
    case Body.Mercury:
    case Body.Venus:
    case Body.Earth:
    case Body.Mars:
    case Body.Jupiter:
    case Body.Saturn:
    case Body.Uranus:
    case Body.Neptune:
      const planet = CalcVsopPosVel(vsop[body], time.tt);
      return ExportState(planet, time);
    case Body.Pluto:
      return CalcPluto(time, true);
    case Body.Moon:
    case Body.EMB:
      const earth = CalcVsopPosVel(vsop.Earth, time.tt);
      const state = body == Body.Moon ? GeoMoonState(time) : GeoEmbState(time);
      return new StateVector(state.x + earth.r.x, state.y + earth.r.y, state.z + earth.r.z, state.vx + earth.v.x, state.vy + earth.v.y, state.vz + earth.v.z, time);
    default:
      if (UserDefinedStar(body)) {
        const vec = HelioVector(body, time);
        return new StateVector(vec.x, vec.y, vec.z, 0, 0, 0, time);
      }
      throw `HelioState: Unsupported body "${body}"`;
  }
}
var ApsisKind;
(function(ApsisKind2) {
  ApsisKind2[ApsisKind2["Pericenter"] = 0] = "Pericenter";
  ApsisKind2[ApsisKind2["Apocenter"] = 1] = "Apocenter";
})(ApsisKind || (ApsisKind = {}));
function VectorFromSphere(sphere, time) {
  time = MakeTime(time);
  const radlat = sphere.lat * DEG2RAD;
  const radlon = sphere.lon * DEG2RAD;
  const rcoslat = sphere.dist * Math.cos(radlat);
  return new Vector(rcoslat * Math.cos(radlon), rcoslat * Math.sin(radlon), sphere.dist * Math.sin(radlat), time);
}
var EclipseKind;
(function(EclipseKind2) {
  EclipseKind2["Penumbral"] = "penumbral";
  EclipseKind2["Partial"] = "partial";
  EclipseKind2["Annular"] = "annular";
  EclipseKind2["Total"] = "total";
})(EclipseKind || (EclipseKind = {}));
var NodeEventKind;
(function(NodeEventKind2) {
  NodeEventKind2[NodeEventKind2["Invalid"] = 0] = "Invalid";
  NodeEventKind2[NodeEventKind2["Ascending"] = 1] = "Ascending";
  NodeEventKind2[NodeEventKind2["Descending"] = -1] = "Descending";
})(NodeEventKind || (NodeEventKind = {}));

// src/core/orbital-elements.js
var CHIRON_DATA = {
  1950: 265,
  // Sag
  1952: 275,
  1955: 295,
  // Cap
  1960: 332,
  // Pisces
  1965: 355,
  // Pisces/Aries
  1968: 10,
  // Aries
  1970: 25,
  // Aries
  1975: 48,
  // Taurus
  1980: 60,
  // Gemini (Aphelion slow)
  1985: 85,
  // Gemini/Cancer
  1988: 102,
  // Cancer
  1990: 112,
  // Cancer 22
  1991: 122,
  // Leo 2
  1992: 128,
  // Leo 8
  1993: 139,
  // Leo 19
  1994: 154,
  // Virgo 4
  1995: 174,
  // Virgo 24
  1996: 192,
  // Libra 12 (Perihelion Fast)
  1997: 212,
  // Scorpio 2
  1998: 232,
  // Scorpio 22
  1999: 250,
  // Sag 10
  2e3: 265,
  // Sag 25
  2005: 295,
  // Cap
  2010: 330,
  // Pisces
  2015: 355,
  // Pisces
  2020: 10,
  // Aries
  2025: 30,
  // Aries
  2030: 55,
  // Taurus
  2040: 95
  // Cancer
};
function getChironLongitude(date) {
  const year = date.getUTCFullYear();
  const startOfYear = new Date(Date.UTC(year, 0, 1));
  const dayOfYear = (date - startOfYear) / (1e3 * 60 * 60 * 24);
  const fraction = dayOfYear / 365.25;
  const p1 = getChironPoint(year);
  const p2 = getChironPoint(year + 1);
  let lon = interpolate(p1, p2, fraction);
  return normalize(lon);
}
function getMeanLilithLongitude(date) {
  const epoch = /* @__PURE__ */ new Date("1992-01-01T00:00:00Z");
  const dayMs = 1e3 * 60 * 60 * 24;
  const daysSinceEpoch = (date - epoch) / dayMs;
  const yearsSince = daysSinceEpoch / 365.25;
  const L0 = 288;
  const rate = 40.6903;
  let lon = L0 + rate * yearsSince;
  return normalize(lon);
}
function getChironPoint(year) {
  if (CHIRON_DATA[year]) return CHIRON_DATA[year];
  const years = Object.keys(CHIRON_DATA).map(Number).sort((a, b) => a - b);
  if (year < years[0]) return CHIRON_DATA[years[0]];
  if (year > years[years.length - 1]) return CHIRON_DATA[years[years.length - 1]];
  let y1, y2;
  for (let i = 0; i < years.length - 1; i++) {
    if (year > years[i] && year < years[i + 1]) {
      y1 = years[i];
      y2 = years[i + 1];
      break;
    }
  }
  if (y1 && y2) {
    const span = y2 - y1;
    const frac = (year - y1) / span;
    const val1 = CHIRON_DATA[y1];
    const val2 = CHIRON_DATA[y2];
    return interpolate(val1, val2, frac);
  }
  return 0;
}
function interpolate(v1, v2, fraction) {
  let diff = v2 - v1;
  if (diff < -180) diff += 360;
  if (diff > 180) diff -= 360;
  return v1 + diff * fraction;
}
function normalize(deg2) {
  deg2 = deg2 % 360;
  if (deg2 < 0) deg2 += 360;
  return deg2;
}

// src/core/astronomy.js
function dateToAstroTime(date) {
  return MakeTime(date);
}
function getGeocentricLongitude(body, date) {
  const time = dateToAstroTime(date);
  let lon;
  if (body === "sun") {
    const sunPos = SunPosition(time);
    lon = sunPos.elon;
  } else if (body === "moon") {
    const moonEcliptic = EclipticGeoMoon(time);
    lon = moonEcliptic.lon;
  } else {
    const bodyName = body.charAt(0).toUpperCase() + body.slice(1);
    if (["Chiron", "MeanLilith", "TrueLilith"].includes(bodyName)) {
      if (["Chiron", "MeanLilith", "TrueLilith"].includes(bodyName)) {
        if (bodyName === "Chiron") {
          return getChironLongitude(date);
        }
        if (bodyName === "MeanLilith") {
          return getMeanLilithLongitude(date);
        }
        if (bodyName === "TrueLilith") {
          return getMeanLilithLongitude(date);
        }
        return 0;
      }
    }
    const geo = GeoVector(Body[bodyName], time, true);
    const ecliptic = Ecliptic(geo);
    lon = ecliptic.elon;
  }
  return normalizeDegrees(lon);
}
function normalizeDegrees(degrees) {
  let normalized = degrees % 360;
  if (normalized < 0) normalized += 360;
  return normalized;
}
function getSignFromLongitude(longitude) {
  const signIndex = Math.floor(longitude / 30);
  return ZODIAC_SIGNS[signIndex];
}
function getDegreeInSign(longitude) {
  return longitude % 30;
}
function getDecan(degreeInSign) {
  if (degreeInSign < 10) return 1;
  if (degreeInSign < 20) return 2;
  return 3;
}
function calculateLST(date, longitude) {
  const time = dateToAstroTime(date);
  const gmst = SiderealTime(time);
  const lst = gmst + longitude / 15;
  return (lst % 24 + 24) % 24;
}
function calculateAscendant(date, latitude, longitude) {
  const lst = calculateLST(date, longitude);
  const ramc = lst * 15;
  const obliquity = 23.4397;
  const latRad = latitude * Math.PI / 180;
  const oblRad = obliquity * Math.PI / 180;
  const ramcRad = ramc * Math.PI / 180;
  const y = Math.cos(ramcRad);
  const x = -(Math.sin(ramcRad) * Math.cos(oblRad) + Math.tan(latRad) * Math.sin(oblRad));
  let asc = Math.atan2(y, x) * 180 / Math.PI;
  asc = normalizeDegrees(asc);
  return asc;
}
function calculateMidheaven(date, longitude) {
  const lst = calculateLST(date, longitude);
  const ramc = lst * 15;
  const obliquity = 23.4397;
  const oblRad = obliquity * Math.PI / 180;
  const ramcRad = ramc * Math.PI / 180;
  let mc = Math.atan(Math.tan(ramcRad) / Math.cos(oblRad)) * 180 / Math.PI;
  if (ramc >= 90 && ramc < 270) {
    mc += 180;
  } else if (ramc >= 270) {
    mc += 360;
  }
  return normalizeDegrees(mc);
}
function calculateWholeSignHouses(ascendant) {
  const ascSign = getSignFromLongitude(ascendant);
  const ascSignIndex = ZODIAC_SIGNS.indexOf(ascSign);
  const houses = {};
  for (let i = 0; i < 12; i++) {
    const houseNumber = i + 1;
    const signIndex = (ascSignIndex + i) % 12;
    const sign = ZODIAC_SIGNS[signIndex];
    houses[houseNumber] = {
      sign,
      startDegree: signIndex * 30,
      endDegree: (signIndex + 1) * 30
    };
  }
  return houses;
}
function getHouseFromLongitude(longitude, houses) {
  const sign = getSignFromLongitude(longitude);
  for (const [houseNum, houseData] of Object.entries(houses)) {
    if (houseData.sign === sign) {
      return parseInt(houseNum);
    }
  }
  return 1;
}
function getMotionState(body, date) {
  if (body === "sun" || body === "moon") {
    return "prograde";
  }
  const dayBefore = new Date(date.getTime() - 24 * 60 * 60 * 1e3);
  const dayAfter = new Date(date.getTime() + 24 * 60 * 60 * 1e3);
  const longBefore = getGeocentricLongitude(body, dayBefore);
  const longNow = getGeocentricLongitude(body, date);
  const longAfter = getGeocentricLongitude(body, dayAfter);
  const motionYesterday = calculateMotion(longBefore, longNow);
  const motionTomorrow = calculateMotion(longNow, longAfter);
  if (motionYesterday < 0 && motionTomorrow < 0) {
    return "retrograde";
  } else if (motionYesterday > 0 && motionTomorrow < 0) {
    return "pregrade";
  } else if (motionYesterday < 0 && motionTomorrow > 0) {
    return "postgrade";
  } else {
    const avgSpeed = getAverageDailyMotion(body);
    if (Math.abs(motionTomorrow) < avgSpeed * 0.3) {
      return motionTomorrow < 0 ? "pregrade" : "postgrade";
    }
    return "prograde";
  }
}
function calculateMotion(from, to) {
  let motion = to - from;
  if (motion > 180) motion -= 360;
  if (motion < -180) motion += 360;
  return motion;
}
function getAverageDailyMotion(body) {
  const speeds = {
    mercury: 1.2,
    venus: 1,
    mars: 0.5,
    jupiter: 0.08,
    saturn: 0.03,
    uranus: 0.01,
    neptune: 5e-3,
    pluto: 4e-3
  };
  return speeds[body] || 1;
}
function calculateAllPlanets(date, latitude, longitude) {
  const planets = ["sun", "moon", "mercury", "venus", "mars", "jupiter", "saturn", "uranus", "neptune", "pluto", "chiron", "meanLilith", "trueLilith"];
  const ascendant = calculateAscendant(date, latitude, longitude);
  const midheaven = calculateMidheaven(date, longitude);
  const houses = calculateWholeSignHouses(ascendant);
  const positions = {};
  for (const planet of planets) {
    const longitude2 = getGeocentricLongitude(planet, date);
    const sign = getSignFromLongitude(longitude2);
    const degreeInSign = getDegreeInSign(longitude2);
    const house = getHouseFromLongitude(longitude2, houses);
    const decan = getDecan(degreeInSign);
    const motionState = getMotionState(planet, date);
    positions[planet] = {
      longitude: longitude2,
      sign,
      degreeInSign,
      degrees: Math.floor(degreeInSign),
      minutes: Math.round(degreeInSign % 1 * 60),
      house,
      decan,
      motionState
    };
  }
  for (const planet of planets) {
    const data = positions[planet];
    data.tone = data.sign;
    data.field = data.house;
    let signsRuled = [];
    for (const [s, ruler] of Object.entries(SIGN_RULERS)) {
      if (ruler === planet) signsRuled.push(s);
    }
    if (signsRuled.length > 0) {
      const baseHouses = signsRuled.map((s) => {
        for (const [hNum, hData] of Object.entries(houses)) {
          if (hData.sign === s) return hNum;
        }
        return "?";
      });
      data.base = baseHouses.join("/");
    } else {
      data.base = "N/A";
    }
    const signIndex = ZODIAC_SIGNS.indexOf(data.sign);
    const signNumber = signIndex + 1;
    const isOdd = signNumber % 2 !== 0;
    const remainder = data.degreeInSign % 12;
    let sparkStartSign = isOdd ? "aries" : "libra";
    let sparkDegree = remainder;
    data.spark = {
      sign: sparkStartSign,
      degree: sparkDegree,
      text: `${capitalize(sparkStartSign)} ${sparkDegree.toFixed(2)}\xB0`
    };
    if (data.degreeInSign >= 28.5 || data.degreeInSign <= 1.5) {
      data.isFCA = true;
      let prevSign = ZODIAC_SIGNS[(signIndex + 11) % 12];
      let nextSign = ZODIAC_SIGNS[(signIndex + 1) % 12];
      if (data.degreeInSign >= 28.5) {
        data.fcaBlend = `${data.sign}/${nextSign}`;
      } else {
        data.fcaBlend = `${prevSign}/${data.sign}`;
      }
    } else {
      data.isFCA = false;
    }
  }
  if (positions["meanLilith"] && positions["trueLilith"]) {
    if (positions["meanLilith"].sign !== positions["trueLilith"].sign) {
      positions["meanLilith"].isLilithCorridor = true;
      positions["trueLilith"].isLilithCorridor = true;
    }
  }
  return {
    planets: positions,
    angles: {
      ascendant: {
        longitude: ascendant,
        sign: getSignFromLongitude(ascendant),
        degreeInSign: getDegreeInSign(ascendant)
      },
      midheaven: {
        longitude: midheaven,
        sign: getSignFromLongitude(midheaven),
        degreeInSign: getDegreeInSign(midheaven)
      },
      descendant: {
        longitude: normalizeDegrees(ascendant + 180),
        sign: getSignFromLongitude(normalizeDegrees(ascendant + 180)),
        degreeInSign: getDegreeInSign(normalizeDegrees(ascendant + 180))
      },
      ic: {
        longitude: normalizeDegrees(midheaven + 180),
        sign: getSignFromLongitude(normalizeDegrees(midheaven + 180)),
        degreeInSign: getDegreeInSign(normalizeDegrees(midheaven + 180))
      }
    },
    houses
  };
}
function capitalize(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}

// src/data/course3-aspect-library.js
var COURSE_3_ASPECTS = {
  conjunction: {
    title: "The Power of Fusion",
    keywords: ["Power", "Focus", "Intensity", "Fusion", "New Moon Energy"],
    description: "Two planets occupying the same space, creating a unified force. Like a New Moon where Sun and Moon work together. This is POWER - harnessed energy at one point.",
    positive: "Unified strength, intense focus, successful blending of energies. Can create manifestation when aligned.",
    negative: "Overwhelming intensity, loss of individual distinction, oscillation between energies, one planet overpowering the other.",
    manifestation: "Use BOTH energies together intentionally. Don't let one dominate. Balance is key to accessing the full power.",
    orb: "Full planetary orb of influence applies"
  },
  opposition: {
    title: "The Awareness of Duality",
    keywords: ["Awareness", "Balance", "Compromise", "Polarity", "Choice"],
    description: "A 180\xB0 tug-of-war creating awareness. You can focus on one energy while pulling from the other. This is marriage, Opposites Attract, the grass-is-greener dynamic.",
    positive: "Objective perspective, ability to choose focus, complementary strengths. Creates awareness you wouldn't have otherwise.",
    negative: "Projection ('it's them not me'), swinging to extremes, losing yourself in one side, indecision.",
    manifestation: "Find the compromise. Focus on one while BORROWING from the other. Don't abandon either side completely.",
    orb: "Full planetary orb of influence applies",
    examples: {
      "sun-neptune": "Sun (ego/personality) vs Neptune (spirituality/illusion). Can be compassionate & spiritual OR depressed & lost. Must balance ego expression with spiritual sensitivity."
    }
  },
  square: {
    title: "The Friction of Progress",
    keywords: ["Friction", "Action", "Conflict", "Growth", "Achievement"],
    description: "90\xB0 angle creating friction and energetic disagreement. TWO planets wanting the same space at the same time. Neither will budge - requires BENDING the energies to appease both.",
    positive: "Drive to achieve, breaking stagnation, immense productive energy. Essential for progress - squares create the friction that moves you forward.",
    negative: "Stubbornness, crisis, forced change, difficulty finding resolution.",
    manifestation: "Appease BOTH energies equally. Find higher/lower vibrations of each. Without squares, you may never accomplish anything major.",
    orb: "Full planetary orb of influence applies",
    critical: "Squares are NOT purely negative! People who achieve greatness often have many squares. They're the engine of progress."
  },
  trine: {
    title: "The Flow of Direct Harmony",
    keywords: ["Flow", "Ease", "Talent", "Direct Effect", "Natural Blessing"],
    description: "120\xB0 direct energy flow. Planet One naturally FEEDS Planet Two. Energy flows so smoothly it often goes UNNOTICED and is taken for granted.",
    positive: "Natural gifts, effortless expression, luck, talents you didn't know you had.",
    negative: "Laziness, taking blessings for granted, lack of growth (no friction = no motivation), wasted potential.",
    manifestation: "Be CONSCIOUS of what you're sending. Don't become lazy. Understand the gift and use it intentionally.",
    orb: "Full planetary orb of influence applies"
  },
  sextile: {
    title: "The Cooperative Opportunity",
    keywords: ["Opportunity", "Cooperation", "Support", "Potential", "Upon Request"],
    description: "60\xB0 cooperative aspect. Energies support each other ONLY when requested/activated. This is potential energy without kinetic - a hidden talent or opportunity.",
    positive: "Available support when needed, creative solutions, awakened talents. Can be highly transformational once understood.",
    negative: "Stagnancy if ignored, missed opportunities, 'potential' that never becomes 'kinetic'. Easy to forget this connection exists.",
    manifestation: "LOOK for your sextiles. Activate them consciously. Ask: 'How can I blend these two energies to create something new?'",
    orb: "1-2 degree tight orb (MINOR aspect)",
    critical: "Severely underrated! Once you unlock your sextiles, there's so much potential to tap into."
  },
  semiSextile: {
    title: "The Neighborly Agitation",
    keywords: ["Agitation", "Discord", "Adjustment", "Cause & Effect", "Minor Friction"],
    description: "30\xB0 aspect - next door neighbors. These energies don't integrate easily, creating minor disharmony. Like neighbors who are polite but never really talk.",
    positive: "Refinement through adjustment, learning to tolerate difference, cause-and-effect awareness.",
    negative: "Persistent irritation, minor friction, 'wince' when activated, inherent lack of integration.",
    manifestation: "Accept the agitation. These planets ARE linked but won't blend smoothly. Work around it rather than trying to force harmony.",
    orb: "1-2 degree VERY tight orb (MINOR aspect)"
  },
  quincunx: {
    title: "The Great Adjustment",
    keywords: ["Toggle", "Redirect", "Adjustment", "Detachment"],
    description: "150\xB0 aspect requiring constant adjustment. Energies that don't 'see' each other - must TOGGLE between states.",
    positive: "Flexibility, ability to compartmentalize, detached support.",
    negative: "Difficulty integrating energies, feeling pulled in incompatible directions.",
    manifestation: "Accept the TOGGLE. These energies operate separately - support at arm's length.",
    orb: "1-2 degree tight orb (MINOR aspect)"
  },
  quintile: {
    title: "The Creative Manifestor",
    keywords: ["Talent", "Manifestation", "Creative", "Outward Expression", "Compulsive"],
    description: "72\xB0 aspect revealing WHERE YOU ARE CREATIVELY INNOVATIVE AND PURPOSEFULLY MANIFEST THINGS. 'This is intentional. This is where you can create things that you want.' External expression - used outwardly in career and with people.",
    positive: "Drive, passion, purpose. Intentional creative manifestation. Natural talents that MOTIVATE you because you can actually use them.",
    negative: "Can show compulsivity in behaviors when activated. Obsessive over this talent. Can be expressed positively or negatively.",
    manifestation: "This is INTENTIONAL CREATION. Usually overlooked but gives you drive, passion, and purpose. External expression.",
    orb: "1-2 degree very tight orb (stays close to avoid confusion with Quincunx at 150\xB0)",
    critical: "OUTWARD/EXTERNAL - something you DO outwardly, use in career, use when dealing with people. Motivates you because it's a talent you can actually use."
  },
  biQuintile: {
    title: "The Internal Problem-Solver",
    keywords: ["Hidden Talent", "Creative Solutions", "Inward", "Artistic Access", "Research"],
    description: "144\xB0 aspect showing 'where you have access to creative and artistic talents.' Less obvious than Quintile, harder to grab onto. Works INWARDLY - 'I can DO certain things' (not 'I can MAKE certain things'). Really good for bringing creative solutions to problematic issues.",
    positive: "Brings creative solutions to problematic issues. Hidden research/analytical talents. Internal processing abilities. Obsessive research capabilities.",
    negative: "Harder to recognize and access than Quintile. May not realize you have this talent.",
    manifestation: "This is INTERNAL TALENT. Something you use FOR YOURSELF to help you do things. Perfect for research, problem-solving, internal creativity.",
    orb: "1-2 degree very tight orb",
    critical: "INWARD/INTERNAL - talent you use for yourself, not shown outwardly. BiQuintile is the LARGER angle (144\xB0) vs Quintile (72\xB0).",
    examples: {
      "mercury-jupiter": "Ability to obsessively research online resources, scan massive amounts of information, maintain 70-80 browser tabs, multi-monitor research setup. Internal talent for information synthesis and deep diving."
    }
  },
  semiSquare: {
    title: "The Minor Frustration",
    keywords: ["Frustration", "Minor Conflict", "Agitation", "Stubbornness"],
    description: "45\xB0 aspect creating minor conflict - less intense than a full Square but creates frustration. 'The power word is FRUSTRATION' - energies are very frustrating to work with because often it feels like it shouldn't play that way, but it does.",
    positive: "Minor friction that can push you to resolve issues. Less destructive than Square.",
    negative: "Persistent frustration. Creates stubbornness in the mixture of energies. Feels like 'you shouldn't feel that if you know how to do something.'",
    manifestation: "Know this exists so you expect the frustration and kickback. Don't be surprised when this energy creates resistance from others.",
    orb: "1-2 degree tight orb (RARELY USED aspect)",
    critical: "Instructor says 'I don't use this one as much. I look at it, I don't pay too much mind to it.' OPTIONAL aspect - not essential."
  }
};

// src/engine/aspects.js
function checkAspect(planet1Data, planet2Data, planet1Name, planet2Name) {
  const long1 = planet1Data.longitude;
  const long2 = planet2Data.longitude;
  let diff = Math.abs(long1 - long2);
  if (diff > 180) diff = 360 - diff;
  const orb1 = PLANETARY_ORBS[planet1Name] || 5;
  const orb2 = PLANETARY_ORBS[planet2Name] || 5;
  const combinedOrb = (orb1 + orb2) / 2;
  for (const [aspectName, aspectData] of Object.entries(MAJOR_ASPECTS)) {
    const targetAngle = aspectData.degrees;
    const orbDistance = Math.abs(diff - targetAngle);
    const effectiveOrb = aspectData.maxOrb !== null && aspectData.maxOrb !== void 0 ? Math.min(combinedOrb, aspectData.maxOrb) : combinedOrb;
    if (orbDistance <= effectiveOrb) {
      const reaches1 = orbDistance <= orb1;
      const reaches2 = orbDistance <= orb2;
      let forcedStatus = "mutual";
      if (reaches1 && !reaches2) forcedStatus = "forced_by_1";
      if (!reaches1 && reaches2) forcedStatus = "forced_by_2";
      if (!reaches1 && !reaches2) forcedStatus = "weak";
      return {
        exists: true,
        type: aspectName,
        exactDegree: targetAngle,
        actualSeparation: diff,
        orbUsed: orbDistance,
        orb1,
        orb2,
        effectiveOrbUsed: effectiveOrb,
        forcedStatus
      };
    }
  }
  return { exists: false };
}
function determineAspectPhase(planet1Data, planet2Data, planet1Name, planet2Name) {
  const long1 = planet1Data.longitude;
  const long2 = planet2Data.longitude;
  let diff = long2 - long1;
  if (diff < 0) diff += 360;
  const aspectInfo = checkAspect(planet1Data, planet2Data, planet1Name, planet2Name);
  if (!aspectInfo.exists) return null;
  const orbDistance = aspectInfo.orbUsed;
  if (orbDistance < 1) {
    return "exact";
  }
  const speed1 = getApproximateSpeed(planet1Name);
  const speed2 = getApproximateSpeed(planet2Name);
  const actualDiff = long2 - long1;
  const normalizedDiff = actualDiff < 0 ? actualDiff + 360 : actualDiff;
  if (speed1 > speed2) {
    return normalizedDiff < aspectInfo.exactDegree ? "approaching" : "passing";
  } else {
    return normalizedDiff > aspectInfo.exactDegree ? "approaching" : "passing";
  }
}
function getApproximateSpeed(planetName) {
  const speeds = {
    moon: 13.2,
    // Fastest
    sun: 1,
    mercury: 1.2,
    venus: 1,
    mars: 0.5,
    jupiter: 0.08,
    saturn: 0.03,
    uranus: 0.01,
    neptune: 5e-3,
    pluto: 4e-3
    // Slowest
  };
  return speeds[planetName] || 1;
}
function analyzeAspect(planet1Name, planet2Name, planet1Data, planet2Data) {
  const aspectInfo = checkAspect(planet1Data, planet2Data, planet1Name, planet2Name);
  if (!aspectInfo.exists) {
    return null;
  }
  const phase = determineAspectPhase(planet1Data, planet2Data, planet1Name, planet2Name);
  const diff = planet2Data.longitude - planet1Data.longitude;
  const normalizedDiff = diff < 0 ? diff + 360 : diff;
  const isFirstHalf = normalizedDiff <= 180;
  let planetOne, planetTwo;
  if (isFirstHalf) {
    planetOne = { name: planet1Name, ...planet1Data };
    planetTwo = { name: planet2Name, ...planet2Data };
  } else {
    planetOne = { name: planet2Name, ...planet2Data };
    planetTwo = { name: planet1Name, ...planet1Data };
  }
  const interpretations = getAspectInterpretations(aspectInfo.type, phase, planetOne.name, planetTwo.name);
  const support = getSupportStructure(aspectInfo.type, phase);
  return {
    type: aspectInfo.type,
    symbol: MAJOR_ASPECTS[aspectInfo.type].symbol,
    keyword: MAJOR_ASPECTS[aspectInfo.type].keyword,
    phase,
    orb: aspectInfo.orbUsed.toFixed(2),
    planetOne,
    planetTwo,
    perception: interpretations.perception,
    reality: interpretations.reality,
    resolution: interpretations.resolution,
    support,
    richData: COURSE_3_ASPECTS[aspectInfo.type] || null,
    forcedStatus: aspectInfo.forcedStatus
  };
}
function getAspectInterpretations(aspectType, phase, planet1Name, planet2Name) {
  const p1 = capitalize2(planet1Name);
  const p2 = capitalize2(planet2Name);
  const interpretations = {
    conjunction: {
      approaching: {
        perception: `${p1} feels pressured, out-of-sync with ${p2}`,
        reality: `${p2} must blend without discord. ${p1} must give way, not be the only energy`,
        resolution: `Allow ${p2} to integrate smoothly - preparing for reset at exact conjunction`
      },
      exact: {
        perception: `Both ${p1} and ${p2} feel forced to share space (inhibiting)`,
        reality: `Energies mesh EVENLY - resolve as ONE unified force`,
        resolution: `Balance both equally - this is a HANDOFF POINT where leadership can shift`
      },
      passing: {
        perception: `${p1} feels out-of-sync or misdirected`,
        reality: `${p2} is now the leader (even if slightly ahead). ${p1} must direct energy INTO ${p2}'s needs`,
        resolution: `Support ${p2}'s direction - your ${p1} energy serves their journey now`
      }
    },
    semiSextile: {
      approaching: {
        perception: `${p1} feels overbearing pressure from ${p2}. Doesn't feel understood or supported`,
        reality: `${p2} is approaching to close a cycle. Must understand where energy lends`,
        resolution: `${p1} must utilize ${p2}'s influence to fuel own purposes`
      },
      exact: {
        perception: `Hard stop between ${p1} and ${p2} - oil and water that won't mix`,
        reality: `${p2} reached an area ${p1} doesn't understand. This is ${p1}'s blind spot`,
        resolution: `${p2}'s needs represent the NEXT STEP for ${p1}'s growth`
      },
      passing: {
        perception: `${p1} feels STAGNATED - an unseen challenge appears`,
        reality: `"Here vs There" conflict. ${p2} holds what ${p1} needs to understand`,
        resolution: `Embrace the discomfort - ${p2} shows your blind spot becoming visible`
      }
    },
    sextile: {
      approaching: {
        perception: `${p1} can't operate business-as-usual. Forced integration without understanding why`,
        reality: `${p2} offers assumptive foundation. ${p2} needs to know how much ${p1} is required`,
        resolution: `Ultimately serves ${p2}'s needs - let the opportunity flow`
      },
      exact: {
        perception: `${p1} sees ${p2} but doesn't know how much ${p2} matters`,
        reality: `${p2} has NEW INFORMATION/OPPORTUNITY for ${p1}`,
        resolution: `${p2} is absolute factor in directing ${p1} productively - seize the opportunity`
      },
      passing: {
        perception: `${p1} feels like they're missing context, feels left out`,
        reality: `${p2} holds new information that helps ${p1}`,
        resolution: `Stay open to what ${p2} reveals - the opportunity is still active`
      }
    },
    // QUINTILE (72째) - Course 3: Creative Manifestor - EXTERNAL talents
    quintile: {
      approaching: {
        perception: `${p1} feels a compulsive drive to CREATE something with ${p2}`,
        reality: `This is INTENTIONAL CREATION energy - ${p1} has a talent for manifesting ${p2} in the external world`,
        resolution: `Lean into this creative drive - it's where you can MAKE things happen`
      },
      exact: {
        perception: `${p1} and ${p2} form a CREATIVE MANIFESTOR aspect - this is purposeful talent`,
        reality: `You have a natural talent for outward expression connecting ${p1} and ${p2}. Use it in career and with people.`,
        resolution: `\u{1F3A8} This is INTENTIONAL. Gives you drive, passion, purpose. Use EXTERNALLY in career and relationships!`
      },
      passing: {
        perception: `The creative drive between ${p1} and ${p2} feels like second nature`,
        reality: `This talent motivates you because you can actually USE it. It's EXTERNAL expression.`,
        resolution: `Don't overlook this gift - it's where you manifest things you want into reality`
      }
    },
    // BIQUINTILE (144째) - Course 3: Internal Problem-Solver - INTERNAL talents
    biQuintile: {
      approaching: {
        perception: `${p1} feels an internal urge to research and problem-solve with ${p2}`,
        reality: `This is HIDDEN TALENT - ${p1} has creative solutions for ${p2} matters that work internally`,
        resolution: `Trust your internal processing - this is for YOUR benefit, not to show off`
      },
      exact: {
        perception: `${p1} and ${p2} form an INTERNAL PROBLEM-SOLVER aspect - this talent is subtle`,
        reality: `You have access to creative and artistic talents that work INWARDLY. 'I can DO certain things' (not 'MAKE' them).`,
        resolution: `\u{1F52C} This is INTERNAL TALENT. Perfect for research, problem-solving, creative solutions to difficult issues.`
      },
      passing: {
        perception: `The internal processing between ${p1} and ${p2} may go unrecognized`,
        reality: `This is something you use FOR YOURSELF to help you do things. Obsessive research capability.`,
        resolution: `BiQuintile is harder to grab onto - recognize this hidden talent for internal creativity`
      }
    },
    square: {
      approaching: {
        perception: `${p1} CONFLICTS with ${p2}, wants to dominate. Frustration requiring attention`,
        reality: `Cross-point angle creates conflict. Focus on ${p1}'s expression while ALIGNING with ${p2}'s needs`,
        resolution: `${p1} is the focus now - express ${p1} while honoring ${p2}`
      },
      exact: {
        perception: `SAME conflict/domination desire between ${p1} and ${p2}`,
        reality: `EQUAL CONSIDERATION required. BOTH planets support each other's intentions`,
        resolution: `\u26A0\uFE0F TURNOVER POINT - favor shifts from ${p1} to ${p2}. Balance both equally!`
      },
      passing: {
        perception: `SAME conflict/domination desire persists`,
        reality: `Focus on ${p2}'s expression now. ${p1} ALIGNS to SUPPORT ${p2}`,
        resolution: `Shift focus to ${p2}'s journey - ${p1} now serves to advance ${p2}`
      }
    },
    trine: {
      approaching: {
        perception: `${p1} influenced by ${p2} (unwanted). Creates friction/static, distorts ${p1}'s vitality`,
        reality: `${p2} must be STABLE to direct into ${p1}. Must know ${p1}'s purposes (supportive not detracting)`,
        resolution: `${p1} must be OPEN to ${p2}'s reception - the help is real, accept it`
      },
      exact: {
        perception: `${p1} directly contributes to ${p2}. Comes naturally, goes UNNOTICED`,
        reality: `${p2} is RECEIVER for ${p1}. ${p1} CAN distort/disrupt flow if not intentional`,
        resolution: `Be conscious of what ${p1} is sending. Understand how ${p2} receives`
      },
      passing: {
        perception: `Energy flows so naturally it may be taken for granted`,
        reality: `${p2} continues to receive from ${p1}. The harmony is real but requires awareness`,
        resolution: `Don't become lazy with this gift - conscious use amplifies the blessing`
      }
    },
    quincunx: {
      approaching: {
        perception: `${p1} receives input but can't process it. Doesn't gel, tries to reject`,
        reality: `${p2} SENDING energy toward ${p1}. Should be directed to do so`,
        resolution: `${p2} lends to ${p1}'s scenarios. ${p1} must use it to fuel own purposes`
      },
      exact: {
        perception: `IMPASSE - neither ${p1} nor ${p2} knows how to connect. Separation, compartmentalization`,
        reality: `${p2} is natural receiver (like Trine) BUT not meant to MERGE`,
        resolution: `${p1} "AIMS" influence toward ${p2} - extended but DETACHED support`
      },
      passing: {
        perception: `Continued disconnection, hard to integrate the energies`,
        reality: `Support flows in one direction - ${p1} feeds ${p2} at arm's length`,
        resolution: `Accept the detachment as intentional - not all connections require fusion`
      }
    },
    opposition: {
      approaching: {
        perception: `${p2} is the ENEMY - must remove ${p2}'s influence. ${p2} causes all problems`,
        reality: `${p2} finalizing arc journey. ${p1} offers INCLUSION from across the axis`,
        resolution: `Both operate where they are. ${p2} must EMBRACE ${p1}'s contributions`
      },
      exact: {
        perception: `Both ${p1} and ${p2} feel the other is the enemy`,
        reality: `Final moment - togetherness to opposite sides. Balance struck by offering STRENGTHS`,
        resolution: `\u{1F504} 2nd HANDOFF POINT - leadership switches. ${p1} illuminates ${p2}'s hidden side`
      },
      passing: {
        perception: `${p1} feels uneasy, unwanted force from ${p2}. Natural instinct to repel`,
        reality: `${p2} lends energies in OPPOSITIONAL SUPPORT. Naturally opposes BUT feeds into ${p1}`,
        resolution: `${p2} brings additional context. Stay where you are but receive the gift`
      }
    }
  };
  const aspectInterp = interpretations[aspectType];
  if (!aspectInterp) {
    return {
      perception: `${p1} aspects ${p2}`,
      reality: `Energy exchange between ${p1} and ${p2}`,
      resolution: `Balance both planetary energies`
    };
  }
  return aspectInterp[phase] || aspectInterp.exact;
}
function getSupportStructure(aspectType, phase) {
  const supportMap = {
    conjunction: {
      approaching: "Planet One SUPPORTED (by approaching planet)",
      exact: "BOTH EQUALLY SUPPORTED",
      passing: "Planet Two leads, Planet One SUPPORTED"
    },
    semiSextile: {
      approaching: "Planet One SUPPORTED",
      exact: "Planet One SUPPORTED",
      passing: "Planet One SUPPORTED"
    },
    sextile: {
      approaching: "Planet One SUPPORTED (for Planet Two's purposes)",
      exact: "Planet One SUPPORTED",
      passing: "Planet One SUPPORTED"
    },
    square: {
      approaching: "Planet One SUPPORTED (not yet turnover)",
      exact: "BOTH EQUALLY SUPPORTED (\u26A0\uFE0F TURNOVER POINT)",
      passing: "Planet Two SUPPORTED (favor has shifted)"
    },
    trine: {
      approaching: "Planet Two SUPPORTED",
      exact: "Planet Two SUPPORTED",
      passing: "Planet Two SUPPORTED"
    },
    quincunx: {
      approaching: "Planet Two SUPPORTED",
      exact: "Planet Two SUPPORTED",
      passing: "Planet Two SUPPORTED"
    },
    opposition: {
      approaching: "Planet Two SUPPORTED",
      exact: "BOTH EQUALLY SUPPORTED (\u{1F504} HANDOFF POINT)",
      passing: "Planet Two SUPPORTED (now as Planet One)"
    }
  };
  const CREATIVE_SUPPORT = {
    quintile: "Creative Manifestation (External Talent)",
    biQuintile: "Internal Processing (Hidden Talent)"
  };
  if (CREATIVE_SUPPORT[aspectType]) {
    return CREATIVE_SUPPORT[aspectType];
  }
  return supportMap[aspectType]?.[phase] || "Support structure varies";
}
function capitalize2(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}
function findAllAspects(chartData) {
  const planets = Object.keys(chartData.planets);
  const aspects = [];
  for (let i = 0; i < planets.length; i++) {
    for (let j = i + 1; j < planets.length; j++) {
      const planet1Name = planets[i];
      const planet2Name = planets[j];
      const analysis = analyzeAspect(
        planet1Name,
        planet2Name,
        chartData.planets[planet1Name],
        chartData.planets[planet2Name]
      );
      if (analysis) {
        aspects.push(analysis);
      }
    }
  }
  const aspectOrder = ["conjunction", "opposition", "square", "trine", "sextile", "quincunx", "semiSextile"];
  aspects.sort((a, b) => aspectOrder.indexOf(a.type) - aspectOrder.indexOf(b.type));
  return aspects;
}
function checkCluster(chartData) {
  const planets = chartData.planets;
  const byGroup = {};
  for (const [name, data] of Object.entries(planets)) {
    const key = `${data.sign}-${data.house}`;
    if (!byGroup[key]) byGroup[key] = [];
    byGroup[key].push({ name, ...data });
  }
  const clusters = [];
  for (const [key, planetList] of Object.entries(byGroup)) {
    if (planetList.length >= 3) {
      const [sign, house] = key.split("-");
      planetList.sort((a, b) => a.longitude - b.longitude);
      let allConnected = true;
      for (let i = 0; i < planetList.length - 1; i++) {
        const aspect = checkAspect(planetList[i], planetList[i + 1], planetList[i].name, planetList[i + 1].name);
        if (!aspect.exists || aspect.type !== "conjunction") {
          allConnected = false;
          break;
        }
      }
      clusters.push({
        sign,
        house: parseInt(house),
        type: allConnected ? "stellium" : "satellitium",
        planets: planetList.map((p) => p.name),
        description: allConnected ? `STELLIUM in ${capitalize2(sign)} (House ${house}): ${planetList.map((p) => capitalize2(p.name)).join(", ")}. These energies STRENGTHEN and AMPLIFY each other; they act as one unified team.` : `SATELLITIUM in ${capitalize2(sign)} (House ${house}): ${planetList.map((p) => capitalize2(p.name)).join(", ")}. While in the same sign and house, these planets do NOT influence each other directly. They act independently within the same field of life.`
      });
    }
  }
  return clusters;
}

// src/data/alchemistic-knowledge.js
var PLANET_GROUPS = {
  ultraPersonal: {
    name: "Ultra-Personal Planets",
    planets: ["sun", "moon"],
    description: "The most personal to you and closest to heart. Along with the Ascendant, these are the most important. They relate to your sense of happiness, purpose, emotional security, safety, and needs.",
    importance: "These are the planets you make the most decisions in life based off of."
  },
  personal: {
    name: "Personal Planets",
    planets: ["mercury", "venus"],
    description: "These operate between intrapersonal and interpersonal. They sit between the Earth and Sun within the ecliptic.",
    positions: {
      inferior: "Intrapersonal (inward) - Mercury rules Gemini (inner mind), Venus rules Taurus (self-value)",
      superior: "Interpersonal (outward) - Mercury rules Virgo (outward mental faculty), Venus rules Libra (value in relation to others)"
    }
  },
  extraPersonal: {
    name: "Extra-Personal Planet",
    planets: ["mars"],
    description: "Mars is NOT a personal planet. It never sits between Earth and Sun. It is a CONNECTOR that connects you (Earth/reality) to the outside world. Mars rules the physical body - that outer layer that enables you to do things in the world.",
    note: "Whenever you see Mars or Aries energy, look at it as a connector to the rest of the world."
  },
  transpersonal: {
    name: "Transpersonal Planets",
    planets: ["jupiter", "saturn"],
    description: "These relate to society, the world, and the general public. They represent the next stage in energetic frequency after taking action."
  },
  metapersonal: {
    name: "Metapersonal Planets",
    planets: ["uranus", "neptune", "pluto"],
    description: "These set the stage BEYOND. Not about the world, but what is beyond the world. Uranus is beyond time, Neptune is beyond reality, Pluto is beyond value/depths.",
    important: 'These are NOT "generational planets". Every planet is personal. They all connect to you.'
  }
};
var HOUSES = {
  1: {
    number: 1,
    naturalSign: "aries",
    naturalRuler: "mars",
    name: "House of Self",
    keywords: ["self", "action", "autonomy", "physical body", "first reactions"],
    description: "The field of self and action. Any planet here is an ARIES planet (True Placement). This is HOW you show up in the world.",
    physicalBody: "Rules the physical body - jawline, skin tone, hair thickness, first reactions.",
    identity: 'Physical Identity - "what your body does" instinctively, your automatic reactions.',
    note: "The Ascendant sits here but has different meaning - ASC is WHY you showed up, the 1st house is HOW you show up."
  },
  2: {
    number: 2,
    naturalSign: "taurus",
    naturalRuler: "venus",
    name: "House of Value",
    keywords: ["value", "self-worth", "resources", "possessions", "security"],
    description: "The field of value and resources. Any planet here is a TAURUS planet (True Placement)."
  },
  3: {
    number: 3,
    naturalSign: "gemini",
    naturalRuler: "mercury",
    name: "House of Mental Identity",
    keywords: ["mental identity", "mindset", "communication", "siblings", "local environment", "learning"],
    description: "The field of MENTAL IDENTITY - your brain itself! How you think, learn, and communicate. Any planet here is a GEMINI planet (True Placement).",
    identity: "Mental Identity - how smart you are, how you think, how you speak, how you get what is in the brain OUT.",
    rulesTheBrain: "Gemini/3rd house rules the brain itself. This is your ID, your mental acuity, how you learn.",
    distinction: "THIS IS DIFFERENT FROM 5TH HOUSE: 3rd house = how you THINK (mental identity). 5th house = how you ACT when being yourself (personality)."
  },
  4: {
    number: 4,
    naturalSign: "cancer",
    naturalRuler: "moon",
    name: "House of Foundation",
    keywords: ["home", "family", "emotional security", "ancestry", "roots"],
    description: "The field of home and emotional foundation. Any planet here is a CANCER planet (True Placement)."
  },
  5: {
    number: 5,
    naturalSign: "leo",
    naturalRuler: "sun",
    name: "House of Expression",
    keywords: ["creativity", "happiness", "pleasure", "romance", "ego", "drama"],
    description: "The field of creative expression, joy, and personality. Any planet here is a LEO planet (True Placement).",
    identity: "Personality/Creative Expression - how you ACT when you are being yourself (distinct from 3rd house mental identity).",
    childPlacement: `1ST CHILD - Your first child is represented here. First children tend to be dramatic ("it's your first one").`,
    romance: 'Romance like "puppy love" - the playful, flirtatious side of love. What makes you HAPPY.',
    distinction: "THIS IS DIFFERENT FROM 1ST HOUSE: 1st house = what your body does. 5th house = who you ARE when being you."
  },
  6: {
    number: 6,
    naturalSign: "virgo",
    naturalRuler: "mercury",
    name: "House of Service",
    keywords: ["service", "health", "routine", "work", "improvement"],
    description: "The field of daily work and health. Any planet here is a VIRGO planet (True Placement)."
  },
  7: {
    number: 7,
    naturalSign: "libra",
    naturalRuler: "venus",
    name: "House of Partnership",
    keywords: ["partnership", "relationships", "one-on-one", "balance", "contracts"],
    description: "The field of one-on-one relationships. Any planet here is a LIBRA planet (True Placement). The Descendant sits here.",
    childPlacement: `2ND CHILD - Your second child is represented here. You're "more in tune" because you've already dealt with one.`,
    note: "This house is about bringing people from PUBLIC into your PERSONAL world."
  },
  8: {
    number: 8,
    naturalSign: "scorpio",
    naturalRuler: "pluto",
    name: "House of Transformation",
    keywords: ["transformation", "shared resources", "depth", "intimacy", "rebirth"],
    description: "The field of deep transformation and shared resources. Any planet here is a SCORPIO planet (True Placement)."
  },
  9: {
    number: 9,
    naturalSign: "sagittarius",
    naturalRuler: "jupiter",
    name: "House of Expansion",
    keywords: ["expansion", "philosophy", "travel", "higher learning", "vision"],
    description: "The field of expansion and seeking. Any planet here is a SAGITTARIUS planet (True Placement).",
    childPlacement: "3RD CHILD - Your third child is represented here. Pattern continues: every 2 houses (11th = 4th child, etc)."
  },
  10: {
    number: 10,
    naturalSign: "capricorn",
    naturalRuler: "saturn",
    name: "House of Achievement",
    keywords: ["career", "public image", "achievement", "mastery", "reputation"],
    description: "The field of public achievement and mastery. Any planet here is a CAPRICORN planet (True Placement)."
  },
  11: {
    number: 11,
    naturalSign: "aquarius",
    naturalRuler: "uranus",
    name: "House of Community",
    keywords: ["groups", "friends", "future", "humanitarian", "innovation"],
    description: "The field of groups and future vision. Any planet here is an AQUARIUS planet (True Placement)."
  },
  12: {
    number: 12,
    naturalSign: "pisces",
    naturalRuler: "neptune",
    name: "House of Transcendence",
    keywords: ["transcendence", "spirituality", "hidden", "dissolution", "surrender"],
    description: "The field of the unconscious and transcendence. Any planet here is a PISCES planet (True Placement)."
  }
};
var VITALITY_ANCHORS = {
  ascendant: {
    name: "Ascendant",
    abbreviation: "ASC",
    keyword: "Emergence",
    location: "Always in the 1st House",
    description: "This is WHERE and WHY you come out into the world through your actions. It is the horizon point at birth.",
    important: "The Ascendant is WHY you showed up. The 1st House is HOW you show up. These are different things.",
    note: "This is a mathematical point with NO orb of influence. Any planet touching it is in a FORCED aspect - the planet envelops the point.",
    alchemisticTerm: "Hot Wire - when planets access this point they are felt much stronger than simply sitting in the 1st house."
  },
  descendant: {
    name: "Descendant",
    abbreviation: "DSC",
    keyword: "Submergence",
    location: "Always in the 7th House (180\xB0 from ASC)",
    description: "What you want to bring from the PUBLIC realm back into your PRIVATE/PERSONAL realm. The sunset point.",
    important: 'This is NOT "my partner". The 7th house is about partners. The Descendant is about what you bring from public to personal.',
    note: "This is a mathematical point with NO orb of influence. Only connect to people you want to bring into your personal life.",
    alchemisticTerm: "Hot Wire - the sunsetted energy is no longer public, it becomes private."
  },
  midheaven: {
    name: "Midheaven",
    abbreviation: "MC",
    keyword: "Peak Aspiration",
    location: "CAN FLOAT - anywhere above the ASC-DSC axis (not locked to 10th house)",
    description: "Your highest public visibility and peak aspiration. The highest point the sun reaches.",
    important: "MC moves depending on latitude and house system. It can show up in the 1st house, 7th house, or anywhere above the horizon.",
    note: "This is a mathematical point with NO orb of influence. Do NOT call it the Zenith - Zenith is directly overhead, which is different.",
    alchemisticTerm: "Hot Wire - represents your peak public presence."
  },
  ic: {
    name: "Subheaven",
    abbreviation: "IC",
    keyword: "Core Anchor",
    location: "CAN FLOAT - anywhere below the ASC-DSC axis (180\xB0 from MC)",
    description: "Your deepest emotional truths and what keeps you tethered to this world. Your core anchor to reality.",
    important: "IC is NOT Cancer energy, NOT the 4th house, NOT where you came from. It can BE in those places but is not those things.",
    note: "This is a mathematical point with NO orb of influence. Do NOT call it the Nadir - Nadir is directly below through the Earth, which is different.",
    alchemisticTerm: "Subheaven is the This Astrology term. It pulls you and roots you to reality."
  }
};

// src/engine/interpretation.js
var PLANET_MEANINGS = {
  sun: {
    focus: "The Right to Exist, Vitality, Father Energy",
    keywords: ["right to exist", "father energy", "inner child", "risk", "vitality"],
    question: "What parts of my true self did I have to suppress to be accepted by my father or authority figures?",
    group: PLANET_GROUPS.ultraPersonal.name,
    groupDescription: PLANET_GROUPS.ultraPersonal.description,
    energy: "The fuel that keeps you moving and your creative expression",
    beginnerExplanation: 'The Sun is your "Right to Exist." In the split with Saturn, it represents the vital, risk-taking "Father" energy and the inner child. It asks: Can you take the risk of being seen as you truly are?',
    simpleQuestion: "Where do I need to take the risk of authentic existence?"
  },
  moon: {
    focus: "Safety, Emotional Needs, The Mother, The Activator",
    keywords: ["safety", "emotional needs", "the past", "activator", "gut reaction"],
    question: "What did I need as a child that I am still trying to provide for myself today?",
    group: PLANET_GROUPS.ultraPersonal.name,
    groupDescription: PLANET_GROUPS.ultraPersonal.description,
    energy: "Instinctual reactions and emotional security",
    beginnerExplanation: 'The Moon is "The Mother"\u2014the primary attachment. It is the activator of your emotions. It reveals the adaptations you made to feel safe. When the Moon triggers a degree, it is an invitation to look at your gut reactions.',
    simpleQuestion: "What do I need to feel deeply, authentically safe?"
  },
  mercury: {
    focus: "The Mind, Logic, Identity (The ID)",
    keywords: ["mental acuity", "logic", "identity", "communication", "processing"],
    question: "How do my thoughts protect me from feeling my deeper emotions?",
    group: PLANET_GROUPS.personal.name,
    groupDescription: PLANET_GROUPS.personal.description,
    energy: "Mental acuity and processing",
    beginnerExplanation: 'Mercury is your "Identity" and your mind. It rules the inward thought (Gemini) and the outward practical routine (Virgo). It is how you navigate the world intellectually, sometimes at the expense of feeling.',
    simpleQuestion: "How does my mind process my reality?"
  },
  venus: {
    focus: "Value, Self-Worth, Relational Attachment",
    keywords: ["value", "self-worth", "relational value", "engagement", "resources"],
    question: "What do I find valuable because it was valued by those I needed to love me?",
    group: PLANET_GROUPS.personal.name,
    groupDescription: PLANET_GROUPS.personal.description,
    energy: "The concept of Value (Self and Relational)",
    beginnerExplanation: "Venus is about VALUE. It is the bridge to others. In Taurus, it is your internal sense of self-worth. In Libra, it is how you determine value through others. It shows what you find worthy of your engagement.",
    simpleQuestion: "How do I determine what is truly valuable?"
  },
  mars: {
    focus: "Action, The Body, Force, Connection",
    keywords: ["physical body", "action", "force", "speed", "connection"],
    question: "How does my body carry the stress I cannot express through words?",
    group: PLANET_GROUPS.extraPersonal.name,
    groupDescription: PLANET_GROUPS.extraPersonal.description,
    energy: "Physical force and connection to the world",
    beginnerExplanation: 'Mars is the "Physical Body." It is action, not necessarily anger. It is how you connect to the external world through force. If suppressed, this energy often manifests as stress or disease within the body.',
    simpleQuestion: "How do I use my physical force to connect or protect?"
  },
  jupiter: {
    focus: "The Great Amplifier, Expansion, Belief",
    keywords: ["amplifier", "expansion", "philosophy", "higher learning", "beliefs"],
    question: "What am I amplifying to avoid looking at my internal pain?",
    group: PLANET_GROUPS.transpersonal.name,
    groupDescription: PLANET_GROUPS.transpersonal.description,
    energy: "Amplification of whatever it touches",
    beginnerExplanation: 'Jupiter is the "Great Amplifier." It expands what it touches\u2014wealth, hope, but also excess and avoidance. It is the search for a larger meaning that can sometimes be a flight from the self.',
    simpleQuestion: "Where am I seeking expansion in my life?"
  },
  saturn: {
    focus: "Structure, Restriction, The Container, The Father",
    keywords: ["structure", "restriction", "authority", "time", "container"],
    question: "What external structures have I built to replace the missing internal ones?",
    group: PLANET_GROUPS.transpersonal.name,
    groupDescription: PLANET_GROUPS.transpersonal.description,
    energy: "The Container that gives form to life",
    beginnerExplanation: 'Saturn is the "Father" energy of structure and restriction. It provides the container for life. If your Saturn is retrograde, you are the "Authority over Authority," distrusting titles and respecting only earned competence (Rule R045).',
    simpleQuestion: "Where must I accept the discipline of structure?"
  },
  uranus: {
    focus: "Awakening, Rebellion, Abrupt Change",
    keywords: ["awakening", "future", "abrupt change", "rebellion", "breaking structure", "quick luck"],
    question: "Where is my authentic self screaming to break free from the jail of social conformity?",
    group: PLANET_GROUPS.metapersonal.name,
    groupDescription: PLANET_GROUPS.metapersonal.description,
    energy: "Abrupt change and breaking of structures",
    beginnerExplanation: 'Uranus is the "Great Awakener." It has an axial tilt over 90 degrees\u2014it is essentially "upside down" (Rule R005). It breaks Saturnian structures to allow the authentic future to emerge through abrupt, electrifying change.',
    simpleQuestion: "Where do I need to break free from tradition?"
  },
  neptune: {
    focus: "Spiral, Spirituality, Dissolution, Fog",
    keywords: ["illusion", "spirituality", "subconscious", "dreams", "fog", "health illusion"],
    question: "Where am I escaping reality to find a sense of connection I lacked as a child?",
    group: PLANET_GROUPS.metapersonal.name,
    groupDescription: PLANET_GROUPS.metapersonal.description,
    energy: "The Fog that obscures reality",
    beginnerExplanation: 'Neptune is the spiritual realm, the "fog." If retrograde, it is an "Inward Utopianism." It represents the dissolution of boundaries. Be careful of illusions regarding health or spiritual bypass (Rule R054/R080).',
    simpleQuestion: "Where is my perception most foggy or idealized?"
  },
  pluto: {
    focus: "Power, Transformation, The Underworld, Evolution",
    keywords: ["power", "transformation", "underworld", "evolution", "phoenix", "potential death"],
    question: "What must die within me for my true power to be born?",
    group: PLANET_GROUPS.metapersonal.name,
    groupDescription: PLANET_GROUPS.metapersonal.description,
    energy: "Evolution through destruction of the old",
    beginnerExplanation: 'Pluto is "Power." If retrograde, you go through intense teardowns and rebuilds in private (Rule R046). It is the evolution of life through the total destruction of what is no longer authentic.',
    simpleQuestion: "Where do I experience the most intense transformation?"
  },
  chiron: {
    focus: "The Authentic Wound, The Inner Authority",
    keywords: ["weakness turned strength", "inner authority", "rainbow bridge", "unstable orbit", "mentorship", "hidden opportunity"],
    question: "What is the pain I am carrying, and how has it become my greatest adaptation?",
    group: "Other Points",
    groupDescription: "Chiron and Liliths are special sensitivity points",
    energy: 'The "Rainbow Bridge" between inner structure (Saturn) and outer rebellion (Uranus).',
    beginnerExplanation: 'Chiron is where your structure was broken down. It is not a wound to be "healed" but an invitation to mentorship. It is the unstable centaur\u2014the bridge between your Saturnian container and your Uranian freedom. Your greatest authority lives in your greatest pain.',
    simpleQuestion: 'Can I accept my "wounded" area as the foundation of my true authority?'
  },
  vesta: {
    focus: "Spark of Life, Vitality, Internal Flame",
    keywords: ["vitality", "passion", "internal flame", "devotion", "spark of life"],
    question: "What is the internal spark that keeps me alive?",
    group: "Other Points",
    groupDescription: "Asteroids and specialized points",
    energy: "The eternal flame of the soul",
    beginnerExplanation: 'Vesta is the "Spark of Life." It represents your internal flame and your capacity for focus and devotion. It is what keeps you vitalized from the inside out.',
    simpleQuestion: "What is my sacred internal spark of life?"
  },
  meanLilith: {
    focus: "The Repressed Shadow, Internalized Shame",
    keywords: ["shadow", "primal", "the bully", "internalized shame", "repression", "guilt"],
    question: "What parts of my primal self was I forced to hide to remain safe in my family?",
    group: "Other Points",
    groupDescription: "Chiron and Liliths are special sensitivity points",
    energy: 'The "Mean Bully"\u2014internalized shame (Rule R012/R013).',
    beginnerExplanation: 'Mean Lilith is the internalized "Bully." It represents themes of rebellion and independence that were suppressed. It is tied to guilt and shame. The work is to move into a "Shame-Free Zone" (Rule R082).',
    simpleQuestion: "What part of my raw truth do I feel ashamed to speak?"
  },
  trueLilith: {
    focus: "Outward Projection, Geometric Rebellion",
    keywords: ["visceral", "oscillation", "outward projection", "rebellion", "jagged path"],
    question: "Where do I project my need for absolute freedom onto the world?",
    group: "Other Points",
    groupDescription: "Chiron and Liliths are special sensitivity points",
    energy: 'The "Osculating" precise point\u2014where the leash is tested (Rule R011).',
    beginnerExplanation: 'True (Osculating) Lilith is the precise, jagged path of your rebellion. It is outward projection. The strategy here is the "Leash Rule": let her out of the cage, but do not let her off the leash (Rule R011).',
    simpleQuestion: "Where do I defy social norms to the point of potentially alienating myself?"
  },
  // NEW ALCHEMISTIC EXTENSIONS
  delegate: {
    focus: "The Representative, The Local Executor",
    energy: "The energy that embodies the intention of a house elsewhere in the chart.",
    rule: "A delegate is a representative of a house sign ruling energy (Rule R002/R028)."
  }
};
var LILITH_HOUSE_INSIGHTS = {
  1: 'You may feel a deep disconnect or shame around your physical body and identity. You reject expectations of how you are "supposed" to look, yet feel an urge to prove your existence (Rule R035/R043).',
  2: 'Rebellion against traditional value and money systems. You likely feel "the authority is already there" but struggle with the "idea-money hiccup"\u2014how to monetize your revolutionary truth (Rule R038/R089).',
  3: `Communication feels heavy. You reject small talk and need "dead air" to process what is NOT being said. You likely learned at home that your words weren't safe (Rule R100/R111).`,
  4: 'Your emotional roots and family home felt like a cage. You expect from others what you never received at home (Rule R101). Your foundation is built on non-traditional "spirituality" rather than biology.',
  5: 'Rebellion around creativity and romance. Regarding children, you might seek non-traditional paths (IVF) or feel a visceral "No" to the standard domestic script. You need to let your creativity be wild (Rule R053).',
  6: `You don't like routine; it feels like oppression. You do things quicker than others but shut down if forced to do it "their way." Your health is tied to your sense of freedom (Rule R047).`,
  7: 'The "Double Whammy" of shame in partnership. You feel a visceral fight-or-flight with authority figures and may have shame around your words or being "too much" for a partner (Rule R024/R111).',
  8: 'Intimacy is a minefield of "shoulds." You feel an expectation of diving deeper that you intuitively reject. You have authority here but feel challenged by the shadow of the other (Rule R052).',
  9: 'Rejection of formal education and religion. You already understood the philosophy intuitively and find college to be of "poor vibe" or lacking soul (Rule R031/R088).',
  10: `Rebellion against traditional status. "I already have the authority, but I don't like the vibe of authority." You refuse to dumb yourself down for a paycheck (Rule R016/R114).`,
  11: 'Dislike of networking and "friendship games." You feel better than the people in the group because you see the conformity "nut job" stage. You need your own circle (Rule R033/R096).',
  12: 'The furthest point from Earth\u2014intense isolation and spiritual disconnect. You are a bridge to the subconscious, but your "weirdness" feels like a liability until you accept it as your power.'
};
var SIGN_MEANINGS = {
  aries: {
    tone: "Initial survival, defensive pioneering",
    style: "Direct, urgent, and courageous",
    shadow: "Impatience born of a fear of being overlooked",
    adaptation: "You likely learned early that to be noticed, you had to lead or act with extreme urgency. Your boldness is a survival strategy to ensure your needs are met in a world that felt competitive."
  },
  taurus: {
    tone: "Grounding for safety, sensual stability",
    style: "Steady, deliberate, and practical",
    shadow: "Stubbornness as a defense against change",
    adaptation: 'Your need for physical comfort and stability was likely a response to early unpredictability. You learned that having "tangible" resources made you safe.'
  },
  gemini: {
    tone: "Mental agility, inquisitive processing",
    style: "Quick, versatile, and communicative",
    shadow: "Fragmentation born of over-processing",
    adaptation: 'Your quick mind was likely an adaptation to an unpredictable environment where you had to "read the room" or process data rapidly to stay safe or stay relevant.'
  },
  cancer: {
    tone: "Nurturing defense, sensitivity to the field",
    style: "Protective, emotional, and intuitive",
    shadow: "Clinging as a response to perceived abandonment",
    adaptation: "You developed a heightened sensitivity to the emotional states of those around you. You learned to nurture to ensure you remained connected to your primary attachments."
  },
  leo: {
    tone: "Radiant identity, the need to be seen",
    style: "Expressive, confident, and warm",
    shadow: "Performative validation-seeking",
    adaptation: `You likely learned that you were safest when you were at the center of attention. Your "shine" is a way to ensure you aren't overlooked or forgotten.`
  },
  virgo: {
    tone: "Precision as control, helpful refinement",
    style: "Analytical, helpful, and detail-oriented",
    shadow: "Critical perfectionism born of anxiety",
    adaptation: 'You likely learned that being "perfect" or "useful" was the only way to avoid chaos or criticism. Your attention to detail is your effort to keep a potentially messy world in check.'
  },
  libra: {
    tone: "Diplomacy as peace-keeping, relational harmony",
    style: "Balanced, fair, and aesthetically driven",
    shadow: 'Self-erasure in the name of "getting along"',
    adaptation: 'You mastery of seeing all sides as a way to diffuse tension. Your "people-pleasing" tendencies are adaptations to a home life where peace was fragile.'
  },
  scorpio: {
    tone: "Intensity as protection, deep perception",
    style: "Magnetic, probing, and transformative",
    shadow: "Suspicion as a response to perceived betrayal",
    adaptation: 'You developed a "psychic radar" to detect hidden threats. Your intensity is a survival mechanism to ensure that nobody can surprise or hurt you again.'
  },
  sagittarius: {
    tone: "Expansion as flight, philosophical search",
    style: "Freedom-loving, optimistic, and direct",
    shadow: "Avoiding the internal heavy through external vastness",
    adaptation: 'Your need for freedom and "the truth" was likely an adaptation to a childhood that felt heavy, restrictive, or burdened with local stress.'
  },
  capricorn: {
    tone: "The structured adult, endurance as value",
    style: "Strategic, disciplined, and enduring",
    shadow: "Rigidity as a defense against perceived failure",
    adaptation: 'You were likely the "little adult" who took on responsibility before you were ready. Your discipline is your way of proving that you can carry the world without breaking.'
  },
  aquarius: {
    tone: "Detached innovation, social rebellion",
    style: "Original, objective, and forward-thinking",
    shadow: "Emotional isolation masquerading as independence",
    adaptation: "You adapted by stepping outside of the system. You learned that emotional detachment and intellectual uniqueness kept you safe from the pressures of conformity."
  },
  pisces: {
    tone: "Dissolutive empathy, imaginative refuge",
    style: "Compassionate, mystical, and fluid",
    shadow: "Escapism born of an inability to filter pain",
    adaptation: "You likely fled to your imagination or a spiritual world when the material world felt too harsh or insensitive. Your empathy is your capacity to feel the collective pain of the world."
  }
};
var CHIRON_HOUSE_INSIGHTS = {
  1: 'The wound is in the physical body and self-perception. You likely feel "wrong" or "broken" in your basic identity and strive to prove you are "enough."',
  2: 'Wound around money and value. You likely reject the expectations of traditional value systems and feel a visceral dislike for "meaningless" money.',
  3: "The wound is in the mind. You might dislike facts, figures, or the structure of early education, feeling that your non-linear thought process is a defect.",
  4: "Wound in the foundational safety and home. Your emotional roots felt like a site of fracture, forcing you to find your own authority away from biology.",
  5: 'The wound of creative "theatrics." You might feel awkward about play or traditionally "fun" things, leading to self-expression that is unique but pressurized.',
  6: 'Routine feels like oppression. Your health and daily work are sites of friction where you reject being "just another cog" in the machine.',
  7: 'The wound of the mirror. You relate to others through your "brokenness," often trying to prove your worth by being all things to all people.',
  8: 'Intimacy and shared power are the sites of surgery. You feel the "underworld" intensely and may retreat from traditional intimacy to protect your authority.',
  9: 'Rejection of higher education "vibe." You already understood the philosophy intuitively and find formal institutions lacking in authentic soul.',
  10: "The wound of public authority. You likely dislike traditional leadership and feel that success in the public eye is a jagged path toward internal peace.",
  11: 'Friction in groups and networking. You see the conformity of the group as a "nut job" stage and prefer to operate as the lone authentic visionary.',
  12: `The hidden wound. You feel "weird" or disconnected in a way you can't name, serving as a bridge to the subconscious that others cannot see.`
};
var RETROGRADE_MEANINGS = {
  mercury: {
    theme: "Internalized mental processing (Adaptation to being unheard)",
    description: `You tend to overcompensate to prove you have a "normal" mind. This energy is turned inward, leading to deep non-linear thinking. You likely learned that speaking up wasn't safe or effective, so you developed a profound internal world instead (Rule R039).`,
    gift: "The ability to find original, non-linear answers that others miss entirely.",
    challenge: "Chronic self-doubt about your intelligence and your right to be understood."
  },
  venus: {
    theme: "Internalized value (Adaptation to conditional love)",
    description: 'You push harder to prove your self-worth because you likely felt that love was something to be earned. Your standards of beauty and value are unique because they were forged in internal isolation. You may oscillate between "over-giving" and "shutting down."',
    gift: "The Capacity for radical, non-traditional self-love that doesn't rely on external praise.",
    challenge: "A tendency to over-value others at the total expense of your own boundaries."
  },
  mars: {
    theme: "Internalized force (Adaptation to suppressed anger)",
    description: 'Because your physical drive was likely discouraged or shamed, you turned that force inward. You compete with yourself aggressively to prove you are "enough," yet often feel stuck in inaction when the body feels unsafe.',
    gift: "Precision and surgical discipline when you finally choose to act from your center.",
    challenge: "Internalized stress and physical tension that can manifest as bodily symptoms."
  },
  jupiter: {
    theme: "Internalized belief (Adaptation to lack of hope)",
    description: `You seek internal expansion because external "luck" or support may have felt missing early on. You often over-prepare or over-believe in private systems because you don't trust the external world to hold you.`,
    gift: "An unshakeable internal optimism that can withstand external hardship.",
    challenge: 'Ignoring real-world boundaries in pursuit of an internal "spiritual bypass."'
  },
  saturn: {
    theme: "Internalized authority (The Authority over Authority)",
    description: "You likely had caregivers who failed to provide a reliable container, so you became your own judge. You do not respect titles born of tradition; you only respect earned competence (Rule R045).",
    gift: "A profound internal moral compass and the ability to build your own reality.",
    challenge: "Chronic feelings of unworthiness because your internal standards are impossibly high."
  },
  uranus: {
    theme: "Internalized awakening (The Private Rebel)",
    description: "The impulse to rebel is core to your identity, but you may have had to keep it secret. You disrupt your own progress to ensure you aren't being controlled by external scripts.",
    gift: "Total authenticity\u2014even in private. You cannot be manipulated by social pressure.",
    challenge: 'Self-sabotage as a way to "prove" that nobody owns your success.'
  },
  neptune: {
    theme: "Internalized utopianism (Emotional Dissolution)",
    description: 'You have an internal vision of connection that the world often fails to meet. You may over-idealize internal concepts or "check out" emotionally to avoid the pain of a disconnected reality.',
    gift: "Deep internal compassion and a direct connection to the subconscious.",
    challenge: "A tendency to use spirituality as a distraction from your physical reality."
  },
  pluto: {
    theme: "Internalized evolution (Powerless to Powerful)",
    description: "You may feel a chronic lack of control, often stemming from early environments where you were small and powerless. This causes a massive internal drive to regenerate and prove you are in charge of your own survival (Rule R046).",
    gift: "The ability to rise from the ashes entirely on your own strength.",
    challenge: "Fear of intimacy, as letting someone in feels like a loss of power."
  },
  meanLilith: {
    theme: "Inward Shadow Conversation (Rule R080)",
    description: 'When Lilith is in retrograde, the shadow of shame is turned inward. You are essentially "oppressing yourself" to stay safe. You may feel guilty for your own authentic needs even when nobody is judging you (Rule R021).',
    gift: "Total self-authority once you stop being your own internal bully.",
    challenge: 'Intense self-criticism and a visceral sense of being "wrong" for existing.'
  }
};
function interpretPlacement(planetName, planetData, houses, chartData) {
  const planet = PLANET_MEANINGS[planetName];
  const sign = SIGN_MEANINGS[planetData.sign];
  const house = HOUSE_THEMES[planetData.house];
  const ruler = SIGN_RULERS[planetData.sign];
  const rulerData = chartData.planets[ruler];
  const rulerHouse = rulerData?.house;
  const tier = PLANET_TO_TIER[planetName];
  const element = SIGN_ELEMENTS[planetData.sign];
  const modality = SIGN_MODALITIES[planetData.sign];
  const decanSign = DECANS[planetData.sign][planetData.decan - 1];
  const decanRuler = SIGN_RULERS[decanSign];
  const interpretation = {
    summary: `${capitalize3(planetName)} in ${capitalize3(planetData.sign)} in House ${planetData.house}`,
    // P - Planet (Focus)
    planet: {
      name: capitalize3(planetName),
      symbol: PLANET_SYMBOLS[planetName],
      tier,
      focus: planet.focus,
      question: planet.question,
      keywords: planet.keywords
    },
    // H - House (Field) - Enhanced with alchemistic data
    house: {
      number: planetData.house,
      name: house.name,
      _debug_house_type: typeof planetData.house,
      _debug_lookup: !!HOUSES[planetData.house],
      alchemisticName: HOUSES[planetData.house]?.name || house.name,
      field: `This energy operates in the field of ${house.name.toLowerCase()}`,
      keywords: HOUSES[planetData.house]?.keywords || house.keywords,
      lifeArea: `Manifests through: ${house.keywords.join(", ")}`,
      // EARTH ARC IDENTITY (True Placement)
      naturalSign: HOUSES[planetData.house]?.naturalSign || null,
      trueIdentity: HOUSES[planetData.house]?.naturalSign ? capitalize3(HOUSES[planetData.house].naturalSign) : null,
      truePlacement: HOUSES[planetData.house] ? `In the ${ordinal(planetData.house)} house, this planet takes on ${HOUSES[planetData.house].naturalSign.toUpperCase()} energy (True Placement).` : null,
      // Pass specific Alchemystic properties
      identity: HOUSES[planetData.house]?.identity || null,
      physicalBody: HOUSES[planetData.house]?.physicalBody || null,
      romance: HOUSES[planetData.house]?.romance || null
    },
    // S - Sign (Tone)
    sign: {
      name: capitalize3(planetData.sign),
      symbol: SIGN_SYMBOLS[planetData.sign],
      tone: sign.tone,
      style: sign.style,
      shadow: sign.shadow,
      element,
      modality
    },
    // R - Ruler (Delegate)
    ruler: {
      planet: capitalize3(ruler),
      rulerSymbol: PLANET_SYMBOLS[ruler],
      house: rulerHouse,
      delegation: rulerHouse ? `${capitalize3(planetData.sign)}'s ruler ${capitalize3(ruler)} sits in House ${rulerHouse}, delegating this energy to ${HOUSE_THEMES[rulerHouse]?.name.toLowerCase()} matters` : "Ruler position provides additional context"
    },
    // Additional context
    decan: {
      number: planetData.decan,
      flavor: `${capitalize3(decanSign)} decan (${capitalize3(decanRuler)} flavor)`,
      description: `Adds a ${SIGN_MEANINGS[decanSign].tone.toLowerCase()} nuance`
    },
    motionState: {
      state: planetData.motionState,
      ...MOTION_STATES[planetData.motionState]
    },
    // Retrograde interpretation if applicable
    retrograde: planetData.motionState === "retrograde" && RETROGRADE_MEANINGS[planetName] ? RETROGRADE_MEANINGS[planetName] : null,
    // Full narrative
    narrative: generateNarrative(planetName, planetData, house, sign, ruler, rulerHouse),
    // Actionable Guidance
    guidance: generateGuidance(planetName, planetData, house, sign)
  };
  return interpretation;
}
function generateNarrative(planetName, planetData, house, sign, ruler, rulerHouse) {
  const planet = PLANET_MEANINGS[planetName];
  const signData = SIGN_MEANINGS[planetData.sign];
  let narrative = `Your **${capitalize3(planetName)}** is here to help you find **${planet.focus.toLowerCase()}**. `;
  narrative += `Because it's in **${capitalize3(planetData.sign)}**, you do this in a **${signData.style.toLowerCase()}** way. `;
  narrative += `This focuses your energy on **${house.name}**, specifically affecting your **${house.keywords.slice(0, 2).join(" and ")}**.`;
  if (rulerHouse) {
    narrative += `

Key Insight: Since this energy is ruled by **${capitalize3(ruler)}** in House ${rulerHouse}, you'll find that your **${house.name}** success is actually tied to your **${HOUSE_THEMES[rulerHouse]?.name}**.`;
  }
  if (planetData.motionState === "retrograde") {
    const retro = RETROGRADE_MEANINGS[planetName];
    if (retro) {
      narrative += `

**Retrograde Note:** You experience this internally. ${retro.description}`;
    }
  }
  return narrative;
}
function generateGuidance(planetName, planetData, house, sign) {
  const planet = PLANET_MEANINGS[planetName];
  const signData = SIGN_MEANINGS[planetData.sign];
  return `To make the most of your **${capitalize3(planetName)}** (your ${planet.keywords[0]} energy): 

\u{1F680} **Action:** You should adopt a **${signData.tone.split(",")[0]}** approach.
\u{1F3AF} **Focus:** Direct this energy effectively into **${house.name}** matters like **${house.keywords[0]}**.
\u2728 **Manifestation Tip:** When you act acting **${signData.style}**, you unlock the full power of this placement!`;
}
function traceRulership(houseNumber, chartData, depth = 0, maxDepth = 3) {
  if (depth >= maxDepth) return null;
  const houseSign = chartData.houses[houseNumber]?.sign;
  if (!houseSign) return null;
  const ruler = SIGN_RULERS[houseSign];
  const rulerData = chartData.planets[ruler];
  const rulerHouse = rulerData?.house;
  const chain = {
    house: houseNumber,
    sign: houseSign,
    ruler,
    rulerHouse,
    interpretation: `House ${houseNumber} (${capitalize3(houseSign)}) \u2192 ${capitalize3(ruler)} in House ${rulerHouse}`,
    meaning: `${HOUSE_THEMES[houseNumber]?.name} matters are influenced by ${HOUSE_THEMES[rulerHouse]?.name?.toLowerCase()} through ${capitalize3(ruler)}`
  };
  if (rulerHouse && rulerHouse !== houseNumber) {
    chain.nextLayer = traceRulership(rulerHouse, chartData, depth + 1, maxDepth);
  }
  chain.reverseRulership = findHousesRuledBy(ruler, chartData);
  return chain;
}
function findHousesRuledBy(planetName, chartData) {
  const houses = [];
  for (const [houseNum, houseData] of Object.entries(chartData.houses)) {
    const sign = houseData.sign;
    if (SIGN_RULERS[sign] === planetName) {
      houses.push({
        house: parseInt(houseNum),
        sign,
        meaning: `${capitalize3(planetName)} brings House ${houseNum} (${HOUSE_THEMES[houseNum]?.name}) energy wherever it sits`
      });
    }
  }
  return houses;
}
function interpretAngles(angles, houses) {
  return {
    ascendant: {
      name: "Ascendant (ASC)",
      keyword: VITALITY_ANCHORS.ascendant.keyword,
      sign: capitalize3(angles.ascendant.sign),
      degree: `${Math.floor(angles.ascendant.degreeInSign)}\xB0${Math.round(angles.ascendant.degreeInSign % 1 * 60)}'`,
      location: VITALITY_ANCHORS.ascendant.location,
      meaning: VITALITY_ANCHORS.ascendant.description,
      themes: ["WHY you showed up", "Emergence into the world", "Gateway to action"],
      important: VITALITY_ANCHORS.ascendant.important,
      interpretation: `Your Ascendant is in **${capitalize3(angles.ascendant.sign)}**. This is your "Hot Wire" to reality.`,
      guidance: `Because you have **${capitalize3(angles.ascendant.sign)} Rising**, the world sees you as **${SIGN_MEANINGS[angles.ascendant.sign].style}**. You should embrace your natural **${SIGN_MEANINGS[angles.ascendant.sign].tone}** energy when starting anything new. Don't hide this\u2014it's your front door!`,
      alchemisticNote: VITALITY_ANCHORS.ascendant.alchemisticTerm
    },
    descendant: {
      name: "Descendant (DSC)",
      keyword: VITALITY_ANCHORS.descendant.keyword,
      sign: capitalize3(angles.descendant.sign),
      degree: `${Math.floor(angles.descendant.degreeInSign)}\xB0${Math.round(angles.descendant.degreeInSign % 1 * 60)}'`,
      location: VITALITY_ANCHORS.descendant.location,
      meaning: VITALITY_ANCHORS.descendant.description,
      themes: ["What you bring from public to personal", "Sunset point", "Submergence"],
      important: VITALITY_ANCHORS.descendant.important,
      interpretation: `Your Descendant is in **${capitalize3(angles.descendant.sign)}**. This is your point of "Submergence" or the sunset.`,
      guidance: `You attract **${capitalize3(angles.descendant.sign)}** energy from others. When you meet people you want to bring into your inner circle, look for those who embody **${SIGN_MEANINGS[angles.descendant.sign].tone}** traits. You are learning to balance your own energy with this polarity.`,
      alchemisticNote: VITALITY_ANCHORS.descendant.alchemisticTerm
    },
    midheaven: {
      name: "Midheaven (MC)",
      keyword: VITALITY_ANCHORS.midheaven.keyword,
      sign: capitalize3(angles.midheaven.sign),
      house: getAngleHouse(angles.midheaven.longitude, houses),
      degree: `${Math.floor(angles.midheaven.degreeInSign)}\xB0${Math.round(angles.midheaven.degreeInSign % 1 * 60)}'`,
      location: VITALITY_ANCHORS.midheaven.location,
      meaning: VITALITY_ANCHORS.midheaven.description,
      themes: ["Peak aspiration", "Highest public visibility", "Public purpose"],
      important: VITALITY_ANCHORS.midheaven.important,
      interpretation: `Your MC is in **${capitalize3(angles.midheaven.sign)}**. This is your Peak Aspiration and highest visibility.`,
      guidance: `To succeed in your public life, you should embody **${capitalize3(angles.midheaven.sign)}** qualities. Be **${SIGN_MEANINGS[angles.midheaven.sign].tone}** in your career. The world wants to see you showing up with this specific energy!`,
      warning: "Do NOT call this the Zenith - the Zenith is directly overhead, which is different.",
      alchemisticNote: VITALITY_ANCHORS.midheaven.alchemisticTerm
    },
    ic: {
      name: "Subheaven (IC)",
      keyword: VITALITY_ANCHORS.ic.keyword,
      sign: capitalize3(angles.ic.sign),
      house: getAngleHouse(angles.ic.longitude, houses),
      degree: `${Math.floor(angles.ic.degreeInSign)}\xB0${Math.round(angles.ic.degreeInSign % 1 * 60)}'`,
      location: VITALITY_ANCHORS.ic.location,
      meaning: VITALITY_ANCHORS.ic.description,
      themes: ["Core anchor", "Deepest emotional truths", "What tethers you to reality"],
      important: VITALITY_ANCHORS.ic.important,
      interpretation: `Your Subheaven (IC) is in **${capitalize3(angles.ic.sign)}**. This is your anchor to reality.`,
      guidance: `When you feel lost or ungrounded, retreat to your **${capitalize3(angles.ic.sign)}** roots. You find stability through **${SIGN_MEANINGS[angles.ic.sign].tone}** experiences. This is your safe place.`,
      warning: "Do NOT call this the Nadir - the Nadir is directly below through the Earth, which is different.",
      alchemisticNote: VITALITY_ANCHORS.ic.alchemisticTerm
    }
  };
}
function getAngleHouse(longitude, houses) {
  for (const [num, data] of Object.entries(houses)) {
    if (longitude >= data.startDegree && longitude < data.endDegree) {
      return parseInt(num);
    }
  }
  return null;
}
function capitalize3(str) {
  if (!str) return "";
  return str.charAt(0).toUpperCase() + str.slice(1);
}
function getOrdinalSuffix(n) {
  const s = ["th", "st", "nd", "rd"];
  const v = n % 100;
  return s[(v - 20) % 10] || s[v] || s[0];
}
function ordinal(n) {
  return n + getOrdinalSuffix(n);
}
function interpretFullChart(chartData) {
  const interpretations = {
    angles: interpretAngles(chartData.angles, chartData.houses),
    planets: {},
    rulershipChains: {}
  };
  for (const [planetName, planetData] of Object.entries(chartData.planets)) {
    interpretations.planets[planetName] = interpretPlacement(
      planetName,
      planetData,
      chartData.houses,
      chartData
    );
  }
  const keyHouses = [1, 2, 4, 7, 10];
  for (const house of keyHouses) {
    interpretations.rulershipChains[house] = traceRulership(house, chartData);
  }
  return interpretations;
}

// src/index.js
function generateNatalChart(birthData) {
  const { date, latitude, longitude, locationName } = birthData;
  const chartData = calculateAllPlanets(date, latitude, longitude);
  const aspects = findAllAspects(chartData);
  const clusters = checkCluster(chartData);
  const interpretations = interpretFullChart(chartData);
  return {
    meta: {
      generatedAt: (/* @__PURE__ */ new Date()).toISOString(),
      system: "ADS/FREE Theory",
      houseSystem: "Whole Sign (mandatory)",
      birthData: {
        date: date.toISOString(),
        latitude,
        longitude,
        locationName: locationName || "Unknown"
      }
    },
    chart: {
      ...chartData,
      planetSymbols: PLANET_SYMBOLS,
      signSymbols: SIGN_SYMBOLS
    },
    aspects: {
      list: aspects,
      summary: generateAspectSummary(aspects)
    },
    clusters,
    interpretations,
    guidance: generateGuidance2(chartData, aspects, interpretations)
  };
}
function generateAspectSummary(aspects) {
  const summary = {
    conjunctions: [],
    oppositions: [],
    squares: [],
    trines: [],
    sextiles: [],
    quincunxes: [],
    semiSextiles: []
  };
  for (const aspect of aspects) {
    const key = aspect.type + "s";
    if (summary[key]) {
      summary[key].push({
        planets: `${aspect.planetOne.name} ${aspect.symbol} ${aspect.planetTwo.name}`,
        keyword: aspect.keyword,
        phase: aspect.phase,
        orb: aspect.orb + "\xB0"
      });
    }
  }
  return summary;
}
function generateGuidance2(chartData, aspects, interpretations) {
  const guidance = {
    strengths: [],
    challenges: [],
    lifeThemes: [],
    actionItems: []
  };
  for (const aspect of aspects) {
    const majorAspect = MAJOR_ASPECTS[aspect.type];
    if (majorAspect.nature === "harmony" || majorAspect.nature === "opportunity") {
      guidance.strengths.push({
        aspect: `${capitalize4(aspect.planetOne.name)} ${aspect.symbol} ${capitalize4(aspect.planetTwo.name)}`,
        description: `Natural flow between ${aspect.planetOne.name} and ${aspect.planetTwo.name}`,
        advice: aspect.resolution
      });
    } else if (majorAspect.nature === "challenge" || majorAspect.nature === "adjustment") {
      guidance.challenges.push({
        aspect: `${capitalize4(aspect.planetOne.name)} ${aspect.symbol} ${capitalize4(aspect.planetTwo.name)}`,
        perception: aspect.perception,
        reality: aspect.reality,
        resolution: aspect.resolution
      });
    }
  }
  for (const [planet, data] of Object.entries(chartData.planets)) {
    if (data.motionState === "retrograde") {
      const interp = interpretations.planets[planet];
      if (interp?.retrograde) {
        guidance.lifeThemes.push({
          theme: `${capitalize4(planet)} Retrograde: ${interp.retrograde.theme}`,
          description: interp.retrograde.description,
          gift: interp.retrograde.gift,
          challenge: interp.retrograde.challenge
        });
      }
    }
  }
  for (const challenge of guidance.challenges.slice(0, 3)) {
    guidance.actionItems.push({
      focus: challenge.aspect,
      action: challenge.resolution
    });
  }
  return guidance;
}
function capitalize4(str) {
  return str.charAt(0).toUpperCase() + str.slice(1);
}
if (typeof window !== "undefined") {
  window.AstrologyReadings = {
    generateNatalChart
  };
}

// src/data/class4-lenses-system.js
var LENSES_PHILOSOPHY = {
  problem: "Charts are overwhelming - too many planets, too many aspects, too much math. How do you know where to start?",
  solution: "LENSES - choosing the topic/question. Everything in the chart is viewed THROUGH that lens.",
  hardestRead: {
    type: "Natal Chart Report (Full Reading)",
    problem: "Impossible to cover everything in 45 minutes. Can spend 45 minutes on FIRST HOUSE alone and still not finish.",
    why: "Complex individuals require progressions, relocations, transits, aspects - years of discovery.",
    advice: "Charge significantly more for these. Still won't satisfy everyone - questions always remain."
  },
  easiestRead: {
    type: "Question-Based Reading",
    method: "Ask a specific question, then answer through chart analysis.",
    examples: [
      "Why am I always having problems in love?",
      "What career best suits me?",
      "How do I make money?",
      "Why do I feel so down all the time?",
      "What's my relationship with my father like?"
    ],
    benefit: "Once you know how to read, these become EASY. Pick a lens, dive deep on that topic only."
  },
  critical: "PICK A STOPPING POINT or you will fall into the rabbit hole forever. Astrology is a vortex - you must decide when you have enough information."
};
var LOVE_LENS = {
  commonMistake: "Most astrologers say '7th house = love' and stop there. This is incomplete and leaves people roadblocked.",
  truthAboutLove: "EVERY HOUSE relates to love on different levels. Love is abstract - it's an emotion, a feeling. You must break it down astrologically.",
  housesInLove: {
    first: "Your identity/solo endeavors within love. What you need to maintain individuality in relationships.",
    second: "Your values in love. What you value in a partner. Sensuality, material needs.",
    third: "How you speak/communicate in terms of love. Love language.",
    fourth: "How you feel safe. Home life with partner. Emotional foundation.",
    fifth: "ROMANCE - puppy love, first stage, risk-taking, pride, fun, creative expression. Baby love. The intro to love.",
    sixth: "How you serve your partner. Health within relationships. Daily routines together.",
    seventh: "Your romantic partner. One-to-one interactions. First marriage. WHERE YOU START for love questions.",
    eighth: "INTIMACY - deep bonds, secrets, trust. Comes AFTER engagement. Not for random partners - for people you trust.",
    ninth: "Expansion/journeys with partner. 'What ifs', fantastical scenarios, playful exploration. How you travel together.",
    tenth: "How you are in public with partner. Reputation as a couple.",
    eleventh: "Hopes/dreams with partner. Friendships. Independence needs. How you interact outside the partnership.",
    twelfth: "Behind the scenes. Music/spirituality in context of love. Hidden aspects of relationship."
  },
  method: "Take ALL house themes and 'chisel them down' / 'carve out' the love-specific meaning. Same themes, different lens.",
  startingPoint: "ALWAYS start with 7th house for love, but don't STOP there. It's just the beginning."
};
var CAREER_LENS = {
  startingPoint: "10th house (Midheaven) - public image, career, legacy",
  housesInCareer: {
    first: "How you present yourself professionally",
    second: "How you make money, values in work",
    third: "Communication skills, daily work environment",
    fourth: "Work from home, foundation for career",
    fifth: "Creative career expression, passion projects",
    sixth: "Daily work, service, health at work",
    seventh: "Business partnerships, clients",
    eighth: "Shared resources, investments, transformation through career",
    ninth: "Teaching, higher education, international work",
    tenth: "PUBLIC CAREER - start here",
    eleventh: "Team dynamics, future career goals, networking",
    twelfth: "Behind-the-scenes work, hidden talents"
  },
  method: "Same as love - filter ALL houses through career lens."
};
var CHILDREN_LENS = {
  childrenPlacement: {
    firstChild: "5th house (natural house of children)",
    secondChild: "7th house (count 2 houses from 5th following zodiac)",
    thirdChild: "9th house (count 2 more houses)"
  },
  method: "Start at 5th house for first child. Each subsequent child is +2 houses in zodiacal order.",
  ruling: "Look at RULER of that house and where it's placed. Analyze aspects to that ruler.",
  example: "5th house cusp in Gemini = Mercury rules first child. Look where Mercury is, what it aspects, what house it's in.",
  interpretation: "Chart doesn't tell you IF you'll have kids (that's a choice). It tells you what the ENERGY / RELATIONSHIP with children will be like.",
  manifestation: "If there are challenging aspects (Chiron, Saturn, etc.), you can work consciously to manifest better relationships with children.",
  important: "This can reveal heavy topics (loss, developmental issues, etc.). Must be prepared for difficult readings."
};

// src/engine/manifestation.js
function calculateManifestationProfile(chart, aspects) {
  const sun = chart.planets.sun;
  const pluto = chart.planets.pluto;
  const chiron = chart.planets.chiron;
  const moon2 = chart.planets.moon;
  const neptune = chart.planets.neptune;
  return {
    core: {
      why: getSunManifestation(sun),
      power: getPlutoPower(pluto),
      blocker: getChironBlocker(chiron),
      fear: getFearProfile(moon2, neptune)
    },
    transmutation: findTransmutableAspects(aspects),
    divineTiming: calculateProgressions(chart)
  };
}
function calculateProgressions(chart) {
  const birthYear = chart.birthData ? new Date(chart.birthData.date).getFullYear() : (/* @__PURE__ */ new Date()).getFullYear() - 30;
  const currentYear = (/* @__PURE__ */ new Date()).getFullYear();
  const age = currentYear - birthYear;
  const sun = chart.planets.sun;
  const signs = [
    "aries",
    "taurus",
    "gemini",
    "cancer",
    "leo",
    "virgo",
    "libra",
    "scorpio",
    "sagittarius",
    "capricorn",
    "aquarius",
    "pisces"
  ];
  let startSignIndex = signs.indexOf(sun.sign.toLowerCase());
  let startAbsDegree = startSignIndex * 30 + parseFloat(sun.degree);
  let progressedAbsDegree = startAbsDegree + age;
  progressedAbsDegree = progressedAbsDegree % 360;
  const newSignIndex = Math.floor(progressedAbsDegree / 30);
  const newSign = signs[newSignIndex];
  const newDegree = Math.floor(progressedAbsDegree % 30);
  return {
    age,
    natalSign: sun.sign,
    progressedSign: newSign,
    progressedDegree: newDegree,
    seasonTheme: getSeasonTheme(newSign),
    guidance: `You were born to be **${sun.sign}**, but right now you are in your **${newSign} Season** (Age ${age}). This is the "Divine Timing" overlay. You must use ${newSign} methods to achieve your ${sun.sign} goals.`
  };
}
function getSeasonTheme(sign) {
  const themes = {
    aries: "Action & Initiation",
    taurus: "Building & Stabilizing",
    gemini: "Learning & Connecting",
    cancer: "Nurturing & Home",
    leo: "Shining & Creating",
    virgo: "Refining & Perfecting",
    libra: "Relating & Balancing",
    scorpio: "Transforming & Deepening",
    sagittarius: "Expanding & Exploring",
    capricorn: "Achieving & Structuring",
    aquarius: "Innovating & Liberating",
    pisces: "Dreaming & Releasing"
  };
  return themes[sign] || "Growth";
}
function getSunManifestation(sun) {
  const desires = {
    aries: "Autonomy, Conquest, and Being First",
    taurus: "Stability, sensual pleasure, and material abundance",
    gemini: "Variety, Connection, and Intellectual Stimulation",
    cancer: "Emotional Safety, Family, and Nurturing",
    leo: "Recognition, Creative Expression, and Legacy",
    virgo: "Order, Service, and Perfection",
    libra: "Harmony, Partnership, and Beauty",
    scorpio: "Deep Intimacy, Power, and Transformation",
    sagittarius: "Freedom, Adventure, and Wisdom",
    capricorn: "Respect, Achievement, and Structure",
    aquarius: "Innovation, Community, and Uniqueness",
    pisces: "Spiritual Connection, Unity, and Dreams"
  };
  return {
    sign: sun.sign,
    house: sun.house,
    desire: desires[sun.sign] || "Self-Expression",
    guidance: `To truly manifest, you must align with your **${sun.sign}** nature. You aren't happy unless you have **${desires[sun.sign]}**. Don't manifest for others; manifest for this.`
  };
}
function getPlutoPower(pluto) {
  const powers = {
    aries: "Unstoppable Willpower",
    taurus: "Unshakable Persistence",
    gemini: "Psychological Deconstruction",
    cancer: "Emotional Resilience",
    leo: "Creative domination",
    virgo: "Critical Analysis",
    libra: "Strategic Diplomacy",
    scorpio: "Total Transformation",
    sagittarius: "Ideological Zeal",
    capricorn: "Authoritative Control",
    aquarius: "Revolutionary Change",
    pisces: "Spiritual Dissolution"
  };
  return {
    sign: pluto.sign,
    house: pluto.house,
    powerType: powers[pluto.sign] || "Transformation",
    guidance: `Your superpower is **${powers[pluto.sign]}**. When you need to push through a wall, channel this energy in the **${HOUSE_THEMES[pluto.house].name}** sector.`
  };
}
function getChironBlocker(chiron) {
  if (!chiron) return null;
  const wounds = {
    aries: "Fear of taking up space",
    taurus: "Fear of scarcity/loss",
    gemini: "Fear of being unintelligent",
    cancer: "Fear of clear abandonement",
    leo: "Fear of being ignored",
    virgo: "Fear of imperfection",
    libra: "Fear of conflict/isolation",
    scorpio: "Fear of betrayal/powerlessness",
    sagittarius: "Fear of meaninglessness",
    capricorn: "Fear of failure/status loss",
    aquarius: "Fear of not belonging",
    pisces: "Fear of boundaries/reality"
  };
  return {
    sign: chiron.sign,
    house: chiron.house,
    wound: wounds[chiron.sign] || "Deep Insecurity",
    guidance: `Your manifestation is often blocked by a **${wounds[chiron.sign]}**. Acknowledge this wound in the **${HOUSE_THEMES[chiron.house].name}** area, but do not let it drive the car.`
  };
}
function getFearProfile(moon2, neptune) {
  return {
    emotionalFear: `Comfort zone addiction (${moon2.sign})`,
    abstractFear: `Fear of the fog/unknown (${neptune.sign})`
  };
}
function findTransmutableAspects(aspects) {
  const hardAspects = aspects.filter(
    (a) => (a.type === "square" || a.type === "opposition") && (isPersonal(a.planetOne.name) || isPersonal(a.planetTwo.name))
  );
  hardAspects.sort((a, b) => parseFloat(a.orb) - parseFloat(b.orb));
  return hardAspects.slice(0, 3).map((aspect) => ({
    pair: `${aspect.planetOne.name} ${aspect.symbol} ${aspect.planetTwo.name}`,
    type: aspect.type,
    planets: [aspect.planetOne.name, aspect.planetTwo.name],
    guidance: generateTransmutationGuidance(aspect)
  }));
}
function isPersonal(planetName) {
  return ["sun", "moon", "mercury", "venus", "mars"].includes(planetName);
}
function generateTransmutationGuidance(aspect) {
  const p1 = aspect.planetOne.name;
  const p2 = aspect.planetTwo.name;
  if (aspect.type === "square") {
    return `This **Square** creates friction between **${p1}** and **${p2}**. Friction creates HEAT. Use this heat to propel you forward. Don't avoid the conflict\u2014lean into it to generate momentum.`;
  } else {
    return `This **Opposition** creates a tug-of-war. You are oscillating between **${p1}** and **${p2}**. Stop swinging and become the fulcrum. Use the tension to launch yourself like a slingshot.`;
  }
}

// src/engine/money.js
var calculateMoneyProfile = (chart, aspects) => {
  const secondHouse = chart.houses[1];
  const secondHouseRuler = getRuler(secondHouse.sign);
  const venus = chart.planets.find((p) => p.name === "Venus");
  const rulerPlanet = chart.planets.find((p) => p.name === secondHouseRuler);
  const risingSign = chart.houses[0].sign;
  const relationship = getMoneyRelationship(secondHouse.sign, secondHouseRuler);
  const magnet = getVenusMagnet(venus.sign);
  const generators = getMoneyGenerators(risingSign, secondHouse.sign);
  const rulerHouseId = rulerPlanet ? rulerPlanet.house : 1;
  const rulerHouseProfile = getRulerHouseInterpretation(rulerHouseId);
  const isRetrograde = rulerPlanet ? rulerPlanet.isRetrograde : false;
  const managerStyle = isRetrograde ? "The Maverick (Retrograde). You cannot follow standard advice. You must find your own unique way to wealth, often becoming a 'late bloomer'." : "The Direct Path. You can follow established roadmaps and traditional methods effectively.";
  const libraHouse = chart.houses.find((h) => h.sign === "Libra");
  const libraHouseNum = chart.houses.indexOf(libraHouse) + 1;
  const libraStrategy = getLibraHouseInterpretation(libraHouseNum);
  return {
    secondHouse: {
      sign: secondHouse.sign,
      ruler: secondHouseRuler,
      description: relationship.description,
      challenge: relationship.challenge
    },
    ruler: {
      name: secondHouseRuler,
      sign: rulerPlanet ? rulerPlanet.sign : "Unknown",
      house: rulerHouseId,
      role: relationship.rulerRole,
      style: managerStyle,
      houseDescription: rulerHouseProfile
    },
    libra: {
      house: libraHouseNum,
      strategy: libraStrategy
    },
    venus: {
      sign: venus.sign,
      strategy: magnet
    },
    generators
  };
};
var getLibraHouseInterpretation = (houseNum) => {
  const interpretations = {
    1: "Your personal brand and appearance are hidden money multipliers. People buy YOU.",
    2: "Your ability to save and manage assets directly impacts your income flow.",
    3: "Communication, contracts, and local networks are where you find financial balance.",
    4: "Your home, family, or real estate holdings provides the stability needed to build wealth.",
    5: "Creative risks and speculative investments (or children) are tied to your financial karma.",
    6: "Daily work habits and service to others are the backbone of your financial balance.",
    7: "Partnerships are ESSENTIAL. You likely make more money with a partner than alone.",
    8: "Joint resources, investments, and other people's money are key. Don't go it alone financially.",
    9: "Teaching, publishing, or international reach brings the necessary expansion for wealth.",
    10: "Your public professional reputation is your greatest asset. Protect it.",
    11: "Your social network and community are your safety net. Friends = Funds.",
    12: "Spiritual work or hidden sources of income provide the balance you need."
  };
  return interpretations[houseNum] || "Balance is key.";
};
var getRuler = (sign) => {
  const rulers = {
    "Aries": "Mars",
    "Taurus": "Venus",
    "Gemini": "Mercury",
    "Cancer": "Moon",
    "Leo": "Sun",
    "Virgo": "Mercury",
    "Libra": "Venus",
    "Scorpio": "Pluto",
    "Sagittarius": "Jupiter",
    "Capricorn": "Saturn",
    "Aquarius": "Uranus",
    "Pisces": "Neptune"
  };
  return rulers[sign] || "Venus";
};
var getRulerHouseInterpretation = (houseNum) => {
  const interpretations = {
    1: "Income depends on YOU. Your physical body, image, or personal action is the product. You must be pioneering and hands-on.",
    2: "Income stacks on income. You make money through finance, assets, accumulating possessions, and banking. Money makes money.",
    3: "Income from communication. Sales, writing, teaching, logistics, or using your hands/dexterity. Local travel is involved.",
    4: "Income from the foundation. Real estate, working from home, family business, or creating safe emotional spaces/nests.",
    5: "Income from creativity/risk. Entertainment, gambling/speculation (careful!), performance, or things involving children/fun.",
    6: "Income from service. Healthcare, daily admin, employment (working for others), organization, and solving practical problems.",
    7: "Income from others. Law, consulting, contracts, marriage/business partners, and 1-on-1 client work. You need a 'other' to bank.",
    8: "Income from hidden sources. Investments, insurance, debt/credit, psychology, or transformation. Using other people's resources.",
    9: "Income from expansion. Teaching, publishing, international travel, higher education, or religious/philosophical institutions.",
    10: "Income from status. Corporate career, government, climbing the ladder, public reputation, and being an authority figure.",
    11: "Income from networks. Technology, social media, groups, memberships, humanitarian efforts, and 'future' industries.",
    12: "Income from the unseen. Spiritual work, backstage roles (film/production), hospitals/institutions, or subconscious healing."
  };
  return interpretations[houseNum] || "Income comes from general life activities.";
};
var getMoneyRelationship = (sign, ruler) => {
  const relationships = {
    "Aries": {
      // Pisces Rising
      description: "Money is Action. You impulse-buy based on instant desire. You view money as a tool to 'get things done' immediately. You are a pioneer.",
      challenge: "Impulsiveness. Stop and think before spending on the first shiny thing.",
      rulerRole: "The Warrior"
    },
    "Taurus": {
      // Aries Rising
      description: "Money is Security. You need to see it to believe it. You love luxury, comfort, and tangible assets. You likely own 'two of everything'.",
      challenge: "Stagnation. Don't be afraid to spend money to make money.",
      rulerRole: "The Builder"
    },
    "Gemini": {
      // Taurus Rising
      description: "Money is Logic... usually. You rationalize every purchase but likely don't know your exact balance. You tend to have multiple streams of income.",
      challenge: "Scattered energy. You often have 'two of everything' or multiples of items.",
      rulerRole: "The Merchant"
    },
    "Cancer": {
      // Gemini Rising
      description: "Money is Emotion. You spend based on your mood ('I felt like buying this'). You are secretive about your finances\u2014it's private!",
      challenge: "Emotional spending. Don't buy things just to soothe your feelings.",
      rulerRole: "The Protector"
    },
    "Leo": {
      // Cancer Rising
      description: "Money is Identity. You like fancy, flashy things that make a statement. The Rule: The happier you are, the more money you make.",
      challenge: "Risk. You love the thrill of the gamble, but don't sit at the table too long.",
      rulerRole: "The Monarch"
    },
    "Virgo": {
      // Leo Rising
      description: "Money is Stress (initially). You feel you MUST work hard for every dollar. You value details and strategy over luck.",
      challenge: "Poverty consciousness. Stop worrying there won't be enough.",
      rulerRole: "The Accountant"
    },
    "Libra": {
      // Virgo Rising
      description: "Money is Partnership. You may unknowingly spend double by constantly paying for others. You seek a 'Level' lifestyle, not necessarily excess.",
      challenge: "Dependency. Ensure you have your own financial identity.",
      rulerRole: "The Diplomat"
    },
    "Scorpio": {
      // Libra Rising
      description: "Money is Depth. You find wealth by diving deeper into a niche than anyone else. You become a 'Household Name' through specialization.",
      challenge: "Obsession. Don't let money define your entire sense of power.",
      rulerRole: "The Alchemist"
    },
    "Sagittarius": {
      // Scorpio Rising
      description: "Money is Philosophy. You experience 'High Highs' and 'Low Lows'. You may view money as a game or construct, separating from the material world.",
      challenge: "Gambling. Jupiter expands bad streaks just as much as good ones.",
      rulerRole: "The Explorer"
    },
    "Capricorn": {
      // Sagittarius Rising
      description: "Money is Mastery. You play the long game. You are likely a 'late bloomer' financially, often feeling you only need 'the basics' until you mature.",
      challenge: "Workaholism. Money is the means, not the end.",
      rulerRole: "The Executive"
    },
    "Aquarius": {
      // Capricorn Rising
      description: "Money is Freedom (Rebellious). Income can be erratic ('feast or famine'). You might overspend on friends (buying rounds) or chase 'The Next Big Thing'.",
      challenge: "Detachment. You still need to pay bills in the 3D world.",
      rulerRole: "The Innovator"
    },
    "Pisces": {
      // Aquarius Rising
      description: "Money is Spiritual. You may view money as an 'illusion' or unnecessary. Danger: Money slips through your fingers like water.",
      challenge: "Delusion. Check your bank account regularly, not just your feelings.",
      rulerRole: "The Mystic"
    }
  };
  return relationships[sign] || relationships["Taurus"];
};
var getVenusMagnet = (sign) => {
  const magnets = {
    "Aries": "The Chase. Be bold, direct, and first. Launch new things.",
    "Taurus": "The Lure. Be sensual, stable, and high-quality. Let them come to you.",
    "Gemini": "The Word. Use wit, intelligence, and storytelling. Sell ideas.",
    "Cancer": "The Care. Be nurturing, protective, and make people feel at home.",
    "Leo": "The Star. Be loud, colorful, and confident. Sell your personal brand.",
    "Virgo": "The Fix. Be helpful, precise, and perfect. Solve their problems.",
    "Libra": "The Charm. Be beautiful, fair, and graceful. Partner up.",
    "Scorpio": "The Mystery. Be intense, private, and transformative. Sell the secret.",
    "Sagittarius": "The Truth. Be honest, adventurous, and wise. Sell the journey.",
    "Capricorn": "The Boss. Be authoritative, reliable, and premium. Sell the result.",
    "Aquarius": "The Rebel. Be different, weird, and futuristic. Sell the revolution.",
    "Pisces": "The Dream. Be magical, empathetic, and artistic. Sell the fantasy."
  };
  return magnets[sign] || "Attraction";
};
var getMoneyGenerators = (risingSign, secondHouseSign) => {
  if (risingSign === "Aries") {
    return [
      "Banking & Finance: Direct involvement with money systems.",
      "Food & Culinary: High-quality, tangible consumables.",
      "Art & Collecting: Creating or trading valuable objects.",
      "Luxury Goods: Selling comfort and status items."
    ];
  }
  if (risingSign === "Taurus") {
    return [
      "Communication: Writing, speaking, teaching.",
      "Logistics & Data: Organizing numbers and information (Accounting).",
      "Multiple Streams: Having 2-3 side hustles is essential.",
      "Hand-Crafted Goods: Using your hands to make valuable things."
    ];
  }
  if (risingSign === "Gemini") {
    return [
      "Real Estate & Home: Buying/selling homes or domestic goods.",
      "Nurturing Professions: Nursing, caretaking, cooking.",
      "Family Business: Working with or for family legacies.",
      "Intuitive Work: Using 'gut feeling' to make financial moves."
    ];
  }
  if (risingSign === "Cancer") {
    return [
      "Entertainment: Performing, acting, being 'on stage'.",
      "Creativity: Any artistic pursuit where YOU are the star.",
      "Leadership: Being the boss or face of a company.",
      "Risk/Speculation: High-reward gambling or stock picks (use with caution)."
    ];
  }
  if (risingSign === "Leo") {
    return [
      "Service: Helping others solve practical problems.",
      "Health & Wellness: Medical, fitness, or nutrition services.",
      "Automation: Creating systems that work for you.",
      "Details: Editing, auditing, or perfecting others' work."
    ];
  }
  if (risingSign === "Virgo") {
    return [
      "Partnerships: Making money with or through a spouse/business partner.",
      "Beauty & Design: Fashion, decor, or aesthetic consulting.",
      "Law & Mediation: Balancing scales, contracts, or acting as a Mediator.",
      "Client Services: High-end 1-on-1 consulting."
    ];
  }
  if (risingSign === "Libra") {
    return [
      "Other People's Money: Insurance, loans, debt management.",
      "Wealth Management: Managing portfolios for others.",
      "Transformation: Therapy, renovation, or fixing 'broken' things.",
      "Entrepreneurship: Starting your own unique business (often from home)."
    ];
  }
  if (risingSign === "Scorpio") {
    return [
      "Teaching & Coaching: Sharing your deep wisdom or philosophy.",
      "International Business: Import/Export or working with foreign cultures.",
      "Publishing: Getting your theories out into the world.",
      "Niche/Taboo Markets: Monetizing unique or 'weird' interests."
    ];
  }
  if (risingSign === "Sagittarius") {
    return [
      "Climbing the Ladder: Corporate hierarchy and promotion.",
      "Management: V.P. or C-Suite roles in established firms.",
      "Government/Structure: Working within large, solid systems.",
      "Stock Market/Systems: Playing the long game with investments."
    ];
  }
  if (risingSign === "Capricorn") {
    return [
      "Technology: Coding, software, or future-tech.",
      "Innovation: Inventing new systems or 'hacks'.",
      "Groups/Networks: Monetizing communities or memberships.",
      "Behind the Scenes: Tech/Crypto where you don't show your face."
    ];
  }
  if (risingSign === "Aquarius") {
    return [
      "Spiritual Work: Astrology, tarot, healing.",
      "Film & Video Games: Visual storytelling and immersive worlds.",
      "Behind the Scenes: Production, ghostwriting, or anonymous work.",
      "Creative Flow: Making money through pure artistic inspiration."
    ];
  }
  if (risingSign === "Pisces") {
    return [
      "Solo Acts: Being a solopreneur or freelancer.",
      "The Product: Promoting YOURSELF as the brand.",
      "Pioneering: Starting something completely new.",
      "Active Income: Making money through physical action/hustle."
    ];
  }
  return ["General Wealth Building: Focus on saving and investing."];
};

// src/data/transcript-knowledge.js
var TRANSCRIPT_KNOWLEDGE = [
  // ===========================================
  // REVERSE VANTAGE (Video 8)
  // ===========================================
  {
    id: "reverse-vantage-core",
    category: "Advanced Technique",
    keywords: ["reverse vantage", "vantage", "receiver", "receiving", "perspective"],
    content: `**Reverse Vantage** is a technique where you stop looking at how Planet A pushes onto Planet B, and instead ask: *"How is Planet B receiving this?"*.

Often, the receiving planet (Planet 2) is not prepared or willing to accept the energy. The solution is to adjust the receiver (Planet 2) to be able to integrate the incoming energy, rather than trying to fix the sender.`
  },
  {
    id: "forced-aspect",
    category: "Advanced Technique",
    keywords: ["forced aspect", "force", "orb", "chiron orbital"],
    content: `A **Forced Aspect** occurs when one planet (usually faster or with a wider orb) reaches out to another that doesn't "see" it back. For example, the Moon has a 3\xB0 orb, but Chiron only has 1\xB0. If they are 2\xB0 apart, the Moon is *forcing* a connection to Chiron, but Chiron isn't naturally reciprocating. This feels like one side of you is dragging the other along.`
  },
  {
    id: "chiron-vantage",
    category: "Chiron",
    keywords: ["chiron", "wound", "healing", "reverse vantage chiron"],
    content: `In Reverse Vantage, Chiron is often the "Sender" of a wound. But you must look at what it hits (e.g., the Moon). Is your emotional safety (Moon) built *upon* a wound? If so, your sense of security might actually depend on things *not* working out. You have to reprogram the Moon to feel safe *without* the wound.`
  },
  // ===========================================
  // CLASS #6 - MAKING MONEY (Deep Cuts)
  // ===========================================
  {
    id: "money-libra",
    category: "Money",
    keywords: ["libra point", "balance", "hidden money", "money partner"],
    content: `**The Libra Factor:** Anytime you look at the 2nd House (Money/Taurus), you MUST look at the Libra house in your chart. Venus rules both. The Libra house shows the *balance* required to keep the money you make. If you ignore your Libra placement, your financial bucket will have a hole in it.`
  },
  {
    id: "money-retrograde",
    category: "Money",
    keywords: ["retrograde money", "retrograde ruler", "financial delay"],
    content: `If your 2nd House ruler is **Retrograde**, standard financial advice (save 10%, buy index funds) likely won't work for you. You are a "Maverick." You make money in weird, non-linear ways, and often bloom later in life financially. You must trust your unique path, even if it looks risky to others.`
  },
  // ===========================================
  // CLASS #5 - MANIFESTATION
  // ===========================================
  {
    id: "manifest-power",
    category: "Manifestation",
    keywords: ["manifest", "manifestation", "power source", "pluto power"],
    content: `True manifestation isn't just "thinking positive." It's aligning your **Sun** (The Goal/Desire) with your **Pluto** (The Nuclear Engine). If your Sun wants fame but your Pluto in the 4th house wants privacy, you'll self-sabotage. You must use your Pluto placement to *fuel* your Sun's desire.`
  },
  {
    id: "transmutation",
    category: "Manifestation",
    keywords: ["transmutation", "square", "opposition", "hard aspect"],
    content: `**Transmutation** is the art of using "bad" aspects (Squares/Oppositions) as fuel. Squares create friction; friction creates heat; heat creates energy. Don't try to "fix" a square\u2014use the tension to launch yourself forward. Success requires the heat of a square.`
  },
  // ===========================================
  // CLASS #2 - RETROGRADES & KARMA
  // ===========================================
  {
    id: "natal-retrograde-meaning",
    category: "Retrogrades",
    keywords: ["retrograde", "natal retrograde", "internalized"],
    content: `A **Natal Retrograde** means that planet's energy is turned *inward*. It is not weak; it is highly pressurized. You process that energy internally (psychologically) rather than externally. It often indicates a "Karmic Do-Over"\u2014you are here to master that energy for *yourself*, not for the world.`
  },
  // ===========================================
  // PHILOSOPHY & BASICS
  // ===========================================
  {
    id: "phsr",
    category: "Philosophy",
    keywords: ["phsr", "reading order", "how to read"],
    content: `**PHSR** is the Golden Rule of reading energy: **P**lanet (The Actor) -> **H**ouse (The Stage) -> **S**ign (The Costume) -> **R**uler (The Director). Never read a placement without following the chain of rulership to see who is actually in charge.`
  },
  {
    id: "ascendant-importance",
    category: "Philosophy",
    keywords: ["ascendant", "rising sign", "importance"],
    content: `Your **Ascendant** is the most important point in your chart. It determines the entire house structure (the "Game Board" of your life). The Sun is just your battery; the Ascendant is the *Vehicle* you are driving.`
  },
  {
    id: "vibe-higher",
    category: "Philosophy",
    keywords: ["vibe higher", "vibration", "frequency"],
    content: `"Vibe Higher" isn't just a catchphrase. It means choosing the *highest expression* of your placements. Every placement has a basement (shadow) and a balcony (light). You can't change your chart, but you can choose which floor you live on. Mars in Aries can be "Violence" (Basement) or "Courageous Leadership" (Balcony).`
  }
];
function searchKnowledge(query) {
  const q = query.toLowerCase();
  return TRANSCRIPT_KNOWLEDGE.filter((item) => {
    return item.keywords.some((k) => q.includes(k));
  }).map((item) => ({
    ...item,
    relevance: 1
    // simplified for now
  }));
}

// src/engine/chat-engine.js
var ChatEngine = class {
  constructor(chartReading) {
    this.chartReading = chartReading;
    this.context = {
      lastTopic: null,
      userName: "friend"
    };
  }
  /**
   * Process a user specific query and return a response
   */
  processQuery(query) {
    const q = query.toLowerCase();
    if (q.match(/^(hi|hello|hey|yo)/)) {
      return {
        type: "text",
        message: "Hey! point me to a topic. I can look at your *Love Life*, *Career*, or *Creativity*? \u{1F31F}"
      };
    }
    if (q.match(/(love|relationship|partner|dating|marriage|crush|soulmate)/)) {
      return this.analyzeLove();
    }
    if (q.match(/(career|job|work|business|purpose|legacy|boss)/)) {
      return this.analyzeCareer();
    }
    if (q.match(/(child|kid|creative|creativity|art|project|baby)/)) {
      return this.analyzeCreativity();
    }
    if (q.match(/(who am i|identity|self|personality|strength|weakness)/)) {
      return this.analyzeIdentity();
    }
    if (q.match(/(manifest|power|dream|goal|success|stuck|block)/)) {
      return this.analyzeManifestation();
    }
    if ((q.includes("money") || q.includes("wealth")) && (q.includes("when") || q.includes("time") || q.includes("timing"))) {
      return this.analyzeMoneyTiming();
    }
    if (q.match(/(money|wealth|finance|rich|bank|invest|debt|salary)/)) {
      return this.analyzeMoney();
    }
    const knowledgeHits = searchKnowledge(q);
    if (knowledgeHits.length > 0) {
      return this.formatKnowledgeResponse(knowledgeHits[0]);
    }
    return {
      type: "text",
      message: "I'm tuning into your chart... Try asking specifically about **Money**, **Love**, or **Career**, or ask me deep questions like *'What is Reverse Vantage?'* or *'How does manifestation work?'* \u{1F52E}"
    };
  }
  /**
   * Generate Love Analysis (7th House Lens)
   */
  analyzeLove() {
    const house7 = this.chartReading.chart.houses[7];
    const ruler = SIGN_RULERS[house7.sign];
    const rulerPlanet = this.chartReading.chart.planets[ruler];
    let msg = `Ooh, let's look at your love life! \u2764\uFE0F

`;
    msg += `Your **7th House of Partnership** is in **${this.capitalize(house7.sign)}**.
`;
    msg += `This means you approach relationships with a **${house7.sign}** vibe\u2014you settle down with people who are ${LOVE_LENS.truthAboutLove} (just kidding, but seriously, you need **${this.getElement(house7.sign)}** energy).

`;
    msg += `**Your Match:** You are attracted to **${this.capitalize(ruler)}** energy because that's your 7th house ruler. `;
    msg += `I see your ${this.capitalize(ruler)} is in the **${rulerPlanet.house}th House**. `;
    msg += `This means for you, love is deeply connected to your **${HOUSE_THEMES[rulerPlanet.house].name}**.

`;
    msg += `*Advice:* Look for partners who help you with ${HOUSE_THEMES[rulerPlanet.house].keywords[0]}.`;
    return { type: "analysis", message: msg, topic: "love" };
  }
  /**
   * Generate Career Analysis (10th House Lens)
   */
  analyzeCareer() {
    const house10 = this.chartReading.chart.houses[10];
    const ruler = SIGN_RULERS[house10.sign];
    const rulerPlanet = this.chartReading.chart.planets[ruler];
    let msg = `Time to talk boss moves! \u{1F4BC}

`;
    msg += `Your **MC (Midheaven)** draws on **${this.capitalize(house10.sign)}** energy. `;
    msg += `The world wants you to be **${house10.sign}**-like: think ${CAREER_LENS.manifestation || "leadership and structure"}.

`;
    msg += `**Your Career Path:** Your career ruler, **${this.capitalize(ruler)}**, is over in the **${rulerPlanet.house}th House**. `;
    msg += `This is huge! It means your public success comes from focusing on **${HOUSE_THEMES[rulerPlanet.house].name}**.

`;
    const mcInterp = this.chartReading.interpretations.angles.midheaven;
    if (mcInterp && mcInterp.guidance) {
      msg += `**Strategy:** ${mcInterp.guidance.replace("To succeed in your public life, you should", "You should")}`;
    }
    return { type: "analysis", message: msg, topic: "career" };
  }
  /**
   * Generate Creativity/Children Analysis (5th House Lens)
   */
  analyzeCreativity() {
    const house5 = this.chartReading.chart.houses[5];
    const ruler = SIGN_RULERS[house5.sign];
    let msg = `Let's look at your creative spark (and kids)! \u{1F476}\u{1F3A8}

`;
    msg += `Your **5th House** is ruled by **${this.capitalize(house5.sign)}**. `;
    msg += `This is the house of *Fun, Romance, and Creation*.

`;
    msg += `You create best when you embody **${this.capitalize(house5.sign)}** energy. `;
    msg += `If you have children (or creative projects), they will likely take on the characteristics of this sign.`;
    return { type: "analysis", message: msg, topic: "creativity" };
  }
  /**
   * Generate Identity Analysis (Sun/ASC)
   */
  analyzeIdentity() {
    const sun = this.chartReading.chart.planets.sun;
    const asc = this.chartReading.chart.angles.ascendant;
    let msg = `The big question! "Who am I?" \u{1F914}

`;
    msg += `You are a **${this.capitalize(sun.sign)} Sun** (that's your core engine) with a **${this.capitalize(asc.sign)} Rising** (that's how you drive the car).

`;
    msg += `People *see* your ${this.capitalize(asc.sign)} side first\u2014${this.chartReading.interpretations.angles.ascendant.guidance.split(".")[1]}.

`;
    msg += `But deep down, you find happiness through **${this.capitalize(sun.sign)}** pursuits.`;
    return { type: "analysis", message: msg, topic: "identity" };
  }
  /**
   * Generate Manifestation Analysis (Class #5)
   */
  analyzeManifestation() {
    const profile = calculateManifestationProfile(this.chartReading.chart, this.chartReading.aspects);
    const { core, transmutation, divineTiming } = profile;
    let msg = `\u2728 **Time to Manifest!** Let's align your energy.

`;
    msg += `\u23F3 **Divine Timing:** You are currently in your **${divineTiming.progressedSign} Season** (Age ${divineTiming.age}).
`;
    msg += `*${divineTiming.guidance}*

`;
    msg += `**Your Goal:** You are designed to chase **${core.why.desire}**. ${core.why.guidance}

`;
    msg += `**Your Power:** Use your **${core.power.powerType}** in the **${HOUSE_THEMES[core.power.house].name}** sector to drive this. ${core.power.guidance}

`;
    if (core.blocker) {
      msg += `**The Block:** Watch out for **${core.blocker.wound}** in the ${HOUSE_THEMES[core.blocker.house].name} area. Don't let fear stop you.

`;
    }
    if (transmutation.length > 0) {
      msg += `**\u26A1 Kinetic Energy:** Use this tension to move forward:
`;
      msg += `*${transmutation[0].guidance}*`;
    } else {
      msg += `**\u26A1 Flow State:** You have a lot of harmonious energy. You need to create your own discipline because the universe won't push you hard enough!`;
    }
    return { type: "analysis", message: msg, topic: "manifestation" };
  }
  /**
   * Generate Money Analysis (Class #6)
   */
  analyzeMoney() {
    const profile = calculateMoneyProfile(this.chartReading.chart, this.chartReading.aspects);
    let msg = `\u{1F4B0} **Let's Talk Money!** (The "Start Making Money" Protocol)

`;
    msg += `**Your Relationship:** With 2nd House in **${profile.secondHouse.sign}**, ${profile.secondHouse.description}
`;
    msg += `*Watch out for:* ${profile.secondHouse.challenge}

`;
    msg += `**How You Attract Value:** Venus in **${profile.venus.sign}** says magnetism comes from: *${profile.venus.strategy}*

`;
    msg += `**\u{1F4B8} Your Money Generators:**
`;
    profile.generators.slice(0, 3).forEach((gen) => {
      msg += `- ${gen}
`;
    });
    return { type: "analysis", message: msg, topic: "money" };
  }
  /**
   * Generate Money Timing Analysis (Hybrid Class #5 & #6)
   */
  analyzeMoneyTiming() {
    const moneyProfile = calculateMoneyProfile(this.chartReading.chart, this.chartReading.aspects);
    const manifestProfile = calculateManifestationProfile(this.chartReading.chart, this.chartReading.aspects);
    const timing = manifestProfile.divineTiming;
    let msg = `\u23F0 **The "When" of Money:**

`;
    msg += `Astrology says you are always capable of wealth, but the *flavor* changes based on your **Life Season** (Progressions).

`;
    msg += `**Current Season:** You are in a **${timing.progressedSign}** Season (Age ${timing.age}).
`;
    msg += `*${timing.guidance}*

`;
    msg += `**Strategy Mix:**
`;
    msg += `You need to apply your standard **${moneyProfile.secondHouse.sign}** money strategy ("${moneyProfile.secondHouse.description.split(".")[0]}") using **${timing.progressedSign}** energy.

`;
    msg += `*Example:* If you are in an Aries Season, take bold action on your ${moneyProfile.secondHouse.sign} ideas *now*.`;
    return { type: "analysis", message: msg, topic: "money-timing" };
  }
  capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
  }
  getElement(sign) {
    return SIGN_ELEMENTS[sign] || "specific";
  }
  formatKnowledgeResponse(item) {
    return {
      type: "knowledge",
      topic: item.category,
      message: `\u{1F4DA} **From the Archives (${item.category}):**

${item.content}

*This is based on the ${item.id.replace(/-/g, " ")} teachings.*`
    };
  }
};

// src/core/spark-base.js
function calculateSpark(sign, degreeInSign) {
  const signIndex = ZODIAC_SIGNS.indexOf(sign.toLowerCase());
  if (signIndex === -1) return null;
  const isEven = (signIndex + 1) % 2 === 0;
  const startIndex = isEven ? 6 : 0;
  const sparkOffset = Math.floor(degreeInSign / 12);
  const sparkIndex = (startIndex + sparkOffset) % 12;
  const sparkSign = ZODIAC_SIGNS[sparkIndex];
  return {
    spark: sparkSign,
    sparkSymbol: getSparkSymbol(sparkSign),
    tone: sign,
    // The original sign is the "Tone" or "Paint"
    calculation: {
      originalSign: capitalize5(sign),
      degree: degreeInSign.toFixed(2),
      isEven,
      startSign: isEven ? "Libra" : "Aries",
      offset: sparkOffset,
      formula: `${Math.floor(degreeInSign)} \xF7 12 = ${Math.floor(degreeInSign / 12)} remainder ${Math.floor(degreeInSign) % 12}`
    },
    interpretation: `While the "paint" (Tone) is ${capitalize5(sign)}, the operating system (Spark) is ${capitalize5(sparkSign)}.`
  };
}
function calculateBase(planetName, houses) {
  const ruledSigns = [];
  for (const [sign, ruler] of Object.entries(SIGN_RULERS)) {
    if (ruler === planetName.toLowerCase()) {
      ruledSigns.push(sign);
    }
  }
  if (ruledSigns.length === 0) {
    return {
      base: null,
      interpretation: `${capitalize5(planetName)} does not rule a standard sign, so Base is N/A.`
    };
  }
  const bases = ruledSigns.map((ruledSign) => {
    for (const [houseNum, houseData] of Object.entries(houses)) {
      if (houseData.sign === ruledSign) {
        const houseNumber = parseInt(houseNum);
        const baseSign = ZODIAC_SIGNS[houseNumber - 1];
        return {
          ruledSign: capitalize5(ruledSign),
          houseNumber,
          baseSign: capitalize5(baseSign)
        };
      }
    }
    return null;
  }).filter(Boolean);
  if (bases.length === 0) {
    return {
      base: null,
      interpretation: `Could not determine Base for ${capitalize5(planetName)}.`
    };
  }
  const primaryBase = bases[0];
  return {
    base: primaryBase.baseSign.toLowerCase(),
    baseSymbol: getSparkSymbol(primaryBase.baseSign.toLowerCase()),
    ruledSign: primaryBase.ruledSign,
    houseNumber: primaryBase.houseNumber,
    allBases: bases,
    interpretation: `${capitalize5(planetName)} rules ${primaryBase.ruledSign}, which is the ${ordinal2(primaryBase.houseNumber)} House (${primaryBase.baseSign} Archetype). The Base is ${primaryBase.baseSign}.`
  };
}
function calculateFullIdentity(planetName, planetData, houses) {
  const spark = calculateSpark(planetData.sign, planetData.degreeInSign);
  const base = calculateBase(planetName, houses);
  return {
    planet: capitalize5(planetName),
    // Standard PHSR components
    tone: capitalize5(planetData.sign),
    // S - Sign
    field: planetData.house,
    // H - House
    // Advanced Alchemystic components
    spark: spark?.spark ? capitalize5(spark.spark) : null,
    base: base?.base ? capitalize5(base.base) : null,
    // Detailed breakdown
    sparkDetails: spark,
    baseDetails: base,
    // Narrative summary
    summary: generateIdentitySummary(planetName, planetData, spark, base)
  };
}
function generateIdentitySummary(planetName, planetData, spark, base) {
  let summary = `**${capitalize5(planetName)}**: `;
  if (spark?.spark) {
    summary += `${capitalize5(spark.spark)} ${capitalize5(planetName)}`;
    if (spark.tone !== spark.spark) {
      summary += ` (with ${capitalize5(spark.tone)} paint)`;
    }
  } else {
    summary += `${capitalize5(planetData.sign)} ${capitalize5(planetName)}`;
  }
  if (base?.base) {
    summary += ` with a ${capitalize5(base.base)} Base`;
  }
  summary += `.`;
  return summary;
}
function calculateTraumaTimeline(chartData) {
  const timeline = [];
  timeline.push({
    ageRange: "7-8",
    event: "First Saturn Square",
    description: "First major test of authority and structure. Early discipline/punishment themes.",
    type: "saturn"
  });
  timeline.push({
    ageRange: "14-15",
    event: "Saturn Opposition",
    description: "Peak rebellion/teenage crisis. Identity vs. Authority conflict.",
    type: "saturn"
  });
  timeline.push({
    ageRange: "21-22",
    event: "Third Saturn Square",
    description: "Transition to adulthood. Taking on adult responsibilities.",
    type: "saturn"
  });
  timeline.push({
    ageRange: "28-30",
    event: "Saturn Return",
    description: 'Major life restructuring. End of "youth" phase.',
    type: "saturn"
  });
  timeline.push({
    ageRange: "11-12",
    event: "First Jupiter Return",
    description: 'First expansion of belief systems. Puberty. "Becoming aware."',
    type: "jupiter"
  });
  timeline.push({
    ageRange: "23-24",
    event: "Second Jupiter Return",
    description: "Philosophy solidifies. Seeking truth and higher education.",
    type: "jupiter"
  });
  timeline.push({
    ageRange: "12-13",
    event: "Chiron Square (Waxing)",
    description: "First major wound activation. Insecurities become conscious.",
    type: "chiron"
  });
  timeline.push({
    ageRange: "20-21",
    event: "Chiron Opposition",
    description: "Wound is reflected back through relationships/others.",
    type: "chiron"
  });
  timeline.push({
    ageRange: "9",
    event: "First Lilith Return",
    description: "First cycle of suppressed instincts. Shadow begins to form.",
    type: "lilith"
  });
  timeline.push({
    ageRange: "18",
    event: "Second Lilith Return",
    description: 'Shadow themes resurface. Sexuality/power dynamics. "Coming out" of hiding.',
    type: "lilith"
  });
  timeline.sort((a, b) => parseInt(a.ageRange) - parseInt(b.ageRange));
  return timeline;
}
function calculateSpecificTraumaIndicators(chartData) {
  const indicators = [];
  const chiron = chartData.planets.chiron;
  const lilith = chartData.planets.meanLilith;
  const saturn = chartData.planets.saturn;
  if (chiron && [4, 8, 12].includes(chiron.house)) {
    indicators.push({
      planet: "Chiron",
      house: chiron.house,
      ageRange: "11-13 and 20-22",
      description: `Chiron in House ${chiron.house} suggests deep wounding in ${getHouseTheme(chiron.house)}. Activation likely around first square and opposition.`,
      severity: "high"
    });
  }
  if (lilith && chartData.planets.moon) {
    const moonLong = chartData.planets.moon.longitude;
    const lilithLong = lilith.longitude;
    const diff = Math.abs(moonLong - lilithLong);
    const normalizedDiff = diff > 180 ? 360 - diff : diff;
    if (normalizedDiff <= 8) {
      indicators.push({
        planet: "Lilith-Moon Conjunction",
        house: lilith.house,
        ageRange: "9, 18, 27",
        description: "Lilith conjunct Moon fuses Safety and Shame. Mother-wound or early gender-based trauma likely. Recurring at 9-year intervals.",
        severity: "high"
      });
    }
  }
  if (saturn && [4, 8].includes(saturn.house)) {
    indicators.push({
      planet: "Saturn",
      house: saturn.house,
      ageRange: "7, 14, 21, 29",
      description: `Saturn in House ${saturn.house} suggests authority/father issues tied to ${getHouseTheme(saturn.house)}. Discipline events at Saturn squares.`,
      severity: "medium"
    });
  }
  return indicators;
}
function analyzeDelegateFlow(planetName, planetData, houses) {
  const base = calculateBase(planetName, houses);
  if (!base?.houseNumber) {
    return {
      flow: null,
      interpretation: `Cannot trace delegate flow for ${capitalize5(planetName)}.`
    };
  }
  const sourceHouse = base.houseNumber;
  const placementHouse = planetData.house;
  const flow = {
    source: {
      house: sourceHouse,
      theme: getHouseTheme(sourceHouse),
      archetype: capitalize5(ZODIAC_SIGNS[sourceHouse - 1])
    },
    destination: {
      house: placementHouse,
      theme: getHouseTheme(placementHouse),
      archetype: capitalize5(ZODIAC_SIGNS[placementHouse - 1])
    }
  };
  return {
    planet: capitalize5(planetName),
    flow,
    interpretation: `${capitalize5(planetName)} pulls its energy from the ${ordinal2(sourceHouse)} House (${flow.source.theme}) and delegates it into the ${ordinal2(placementHouse)} House (${flow.destination.theme}). This means that ${flow.source.theme.toLowerCase()} themes are unconsciously pushed into ${flow.destination.theme.toLowerCase()} matters.`,
    warning: sourceHouse === 8 || sourceHouse === 12 ? `\u26A0\uFE0F The source is House ${sourceHouse} (${flow.source.theme}). This often indicates deep psychological material being delegated into conscious life.` : null
  };
}
function capitalize5(str) {
  if (!str) return "";
  return str.charAt(0).toUpperCase() + str.slice(1);
}
function ordinal2(n) {
  const s = ["th", "st", "nd", "rd"];
  const v = n % 100;
  return n + (s[(v - 20) % 10] || s[v] || s[0]);
}
function getSparkSymbol(sign) {
  const symbols = {
    aries: "\u2648",
    taurus: "\u2649",
    gemini: "\u264A",
    cancer: "\u264B",
    leo: "\u264C",
    virgo: "\u264D",
    libra: "\u264E",
    scorpio: "\u264F",
    sagittarius: "\u2650",
    capricorn: "\u2651",
    aquarius: "\u2652",
    pisces: "\u2653"
  };
  return symbols[sign.toLowerCase()] || "";
}
function getHouseTheme(houseNumber) {
  const themes = {
    1: "Self/Emergence",
    2: "Value/Resources",
    3: "Mind/Communication",
    4: "Home/Roots/Mother",
    5: "Vitality/Creation",
    6: "Routine/Health",
    7: "Partnership/Marriage",
    8: "Trauma/Intimacy/Shared Resources",
    9: "Expansion/Philosophy",
    10: "Public Standing/Father",
    11: "Future/Community",
    12: "Subconscious/Hidden"
  };
  return themes[houseNumber] || `House ${houseNumber}`;
}

// src/engine/profile-report.js
function generateProfileReport(chartReading, birthData, currentDate = /* @__PURE__ */ new Date()) {
  const { chart, interpretations, aspects, guidance } = chartReading;
  const report = {
    title: "Your Personal Astrological Profile",
    generatedDate: currentDate.toLocaleDateString("en-US", { weekday: "long", year: "numeric", month: "long", day: "numeric" }),
    birthInfo: formatBirthInfo(birthData),
    sections: []
  };
  report.sections.push(generateCoreIdentitySection(chart, interpretations));
  report.sections.push(generateTrueIdentitySection(chart));
  report.sections.push(generateEmotionalLandscapeSection(chart, interpretations));
  report.sections.push(generateConnectionSection(chart, interpretations));
  report.sections.push(generateLifePathSection(chart, interpretations, aspects));
  report.sections.push(generateDelegateFlowSection(chart));
  report.sections.push(generateTraumaTimelineSection(chart));
  report.sections.push(generateCurrentSeasonSection(chart, interpretations, birthData, currentDate));
  report.sections.push(generateMonthlyFocusSection(chart, interpretations, currentDate));
  report.sections.push(generateWatchOutsSection(chart, interpretations, aspects));
  report.sections.push(generateReverseVantageSection(chart, aspects));
  report.sections.push(generateGiftsSection(chart, guidance));
  return report;
}
function formatBirthInfo(birthData) {
  const time = birthData.time || "12:00";
  const date = /* @__PURE__ */ new Date(`${birthData.date}T${time}`);
  if (isNaN(date.getTime())) {
    return {
      dateFormatted: birthData.date,
      timeFormatted: birthData.time,
      location: birthData.locationName
    };
  }
  return {
    dateFormatted: date.toLocaleDateString("en-US", { weekday: "long", year: "numeric", month: "long", day: "numeric" }),
    timeFormatted: date.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit", hour12: true }),
    location: birthData.locationName
  };
}
function capitalize6(str) {
  if (!str) return "";
  return str.charAt(0).toUpperCase() + str.slice(1);
}
function generateCoreIdentitySection(chart, interpretations) {
  const sun = chart.planets.sun;
  const rising = chart.angles.ascendant;
  const sunInterp = interpretations.planets.sun;
  const trueIdentity = sunInterp.house.trueIdentity || capitalize6(sun.sign);
  const zodiacSign = capitalize6(sun.sign);
  let narrative = `At your core, you are a ${trueIdentity} soul`;
  if (trueIdentity !== zodiacSign) {
    narrative += ` (expressed through the lens of ${zodiacSign} energy)`;
  }
  narrative += `. Your Sun sits in House ${sun.house}, the house of ${HOUSE_THEMES[sun.house]?.name || "life"}, which means your essential life force and creative energy naturally flow into ${HOUSE_THEMES[sun.house]?.name.toLowerCase() || "this"} matters.

`;
  narrative += `Your Rising Sign is ${capitalize6(rising.sign)}, which acts as the "costume" you wear when meeting the world. This is the first impression you make on others and the lens through which you approach new situations. With ${capitalize6(rising.sign)} rising, you come across as ${getSignPersonality(rising.sign)}.

`;
  narrative += `${sunInterp.planet.beginnerExplanation || sunInterp.planet.focus}

`;
  narrative += `**What This Means For You:** ${sunInterp.guidance || "You are meant to shine brightly in this area of life. Embrace your authentic expression and let your light guide others."}`;
  return {
    title: "WHO YOU ARE: Your Core Identity",
    icon: "\u2609",
    content: narrative
  };
}
function generateEmotionalLandscapeSection(chart, interpretations) {
  const moon2 = chart.planets.moon;
  const moonInterp = interpretations.planets.moon;
  const trueNeeds = moonInterp.house.trueIdentity || capitalize6(moon2.sign);
  const zodiacSign = capitalize6(moon2.sign);
  let narrative = `Your emotional nature is deeply ${trueNeeds}`;
  if (trueNeeds !== zodiacSign) {
    narrative += ` (operating through ${zodiacSign} sensitivity)`;
  }
  narrative += `. The Moon in your chart represents your inner emotional world, your deepest needs, and what makes you feel safe and secure.

`;
  narrative += `With your Moon in House ${moon2.house} (${HOUSE_THEMES[moon2.house]?.name || "life"}), you find emotional fulfillment through ${HOUSE_THEMES[moon2.house]?.beginnerExplanation?.split(".")[0].toLowerCase() || "this area of life"}. `;
  narrative += `This is where you seek comfort and where your intuition is strongest.

`;
  const element = SIGN_ELEMENTS[moon2.sign];
  narrative += getEmotionalStyleByElement(element, moon2.sign);
  narrative += `

**Your Emotional Needs:** ${moonInterp.planet.simpleQuestion || "What do you need to feel emotionally secure?"} Understanding this about yourself is key to your happiness and wellbeing.`;
  if (moonInterp.guidance) {
    narrative += `

**Guidance:** ${moonInterp.guidance}`;
  }
  return {
    title: "YOUR INNER WORLD: Emotional Landscape",
    icon: "\u263D",
    content: narrative
  };
}
function generateConnectionSection(chart, interpretations) {
  const mercury = chart.planets.mercury;
  const venus = chart.planets.venus;
  const mars = chart.planets.mars;
  let narrative = `**How You Think & Communicate**
`;
  narrative += `Mercury in ${capitalize6(mercury.sign)} (House ${mercury.house}) shapes how your mind works. You think in a ${getSignThinkingStyle(mercury.sign)} manner. `;
  narrative += `Communication and learning flow best when you embrace these qualities. ${interpretations.planets.mercury?.sign.tone || ""}

`;
  narrative += `**How You Love & Attract**
`;
  narrative += `Venus in ${capitalize6(venus.sign)} (House ${venus.house}) defines your love language and what you find beautiful. You attract through ${getSignAttractionStyle(venus.sign)} qualities. `;
  narrative += `In relationships, you value ${interpretations.planets.venus?.planet.keywords?.[0] || "connection"} and express affection ${getSignLoveExpression(venus.sign)}.

`;
  narrative += `**How You Take Action**
`;
  narrative += `Mars in ${capitalize6(mars.sign)} (House ${mars.house}) drives how you pursue goals and handle conflict. Your action style is ${getSignActionStyle(mars.sign)}. `;
  narrative += `When you want something, you go after it with ${capitalize6(mars.sign)} determination.`;
  if (mars.motionState === "retrograde") {
    narrative += ` Note: With Mars retrograde in your birth chart, you may process action internally first before expressing it outwardly. Your drive is no less powerful, just more considered.`;
  }
  return {
    title: "HOW YOU CONNECT: Communication, Love & Action",
    icon: "\u2640",
    content: narrative
  };
}
function generateLifePathSection(chart, interpretations, aspects) {
  const saturn = chart.planets.saturn;
  const jupiter = chart.planets.jupiter;
  const pluto = chart.planets.pluto;
  let narrative = `**Your Life Lessons (Saturn)**
`;
  narrative += `Saturn in ${capitalize6(saturn.sign)} (House ${saturn.house}) points to your major life lessons. The ${HOUSE_THEMES[saturn.house]?.name || ""} area of life requires discipline, patience, and mastery from you. `;
  narrative += `This isn't punishment \u2013 it's where you build lasting achievement. What you build here with effort LASTS.

`;
  if (saturn.motionState === "retrograde") {
    narrative += `With Saturn retrograde, you may have internalized these lessons early in life. You're working through karmic patterns around authority and structure.

`;
  }
  narrative += `**Your Growth & Expansion (Jupiter)**
`;
  narrative += `Jupiter in ${capitalize6(jupiter.sign)} (House ${jupiter.house}) shows where luck and opportunity naturally find you. Your path to expansion and growth runs through ${HOUSE_THEMES[jupiter.house]?.name.toLowerCase() || "this"} matters. `;
  narrative += `Embrace ${capitalize6(jupiter.sign)} energy here \u2013 it's your fortunate zone.

`;
  narrative += `**Your Transformation (Pluto)**
`;
  narrative += `Pluto in ${capitalize6(pluto.sign)} (House ${pluto.house}) marks where deep transformation happens in your life. `;
  narrative += `This is intense territory \u2013 death and rebirth of old patterns. You have immense power here once you learn to wield it consciously.`;
  if (chart.planets.chiron) {
    const chiron = chart.planets.chiron;
    narrative += `

**Your Wound That Becomes Your Gift (Chiron)**
`;
    narrative += `Chiron in ${capitalize6(chiron.sign)} (House ${chiron.house}) reveals your deepest wound \u2013 and paradoxically, where you have the greatest wisdom to share. `;
    narrative += `Through healing this area, you become a healer for others walking a similar path.`;
  }
  if (chart.planets.meanLilith) {
    const lilith = chart.planets.meanLilith;
    narrative += `

**Your Raw Power & Shadow (Lilith)**
`;
    narrative += `Mean Lilith in ${capitalize6(lilith.sign)} (House ${lilith.house}) represents the raw, primal part of you that society (or early authority figures) may have shamed. `;
    narrative += `**The Protocol:** Radical Self-Acceptance. You must stop repressing this energy ("Let her out of the cage") because it is authentically YOU. `;
    narrative += `However, you must integrate it responsibly ("Keep her on the leash") within your **${HOUSE_THEMES[lilith.house]?.name || "House " + lilith.house}** activities. Don't hide this part of yourself\u2014use its raw power to fuel your life.`;
  }
  return {
    title: "YOUR LIFE PATH: Lessons, Growth & Transformation",
    icon: "\u2644",
    content: narrative
  };
}
function generateCurrentSeasonSection(chart, interpretations, birthData, currentDate) {
  const birthDate = new Date(birthData.date);
  const ageInYears = (currentDate - birthDate) / (365.25 * 24 * 60 * 60 * 1e3);
  const ageWhole = Math.floor(ageInYears);
  const sunLongitude = chart.planets.sun.longitude;
  const progressedLongitude = (sunLongitude + ageInYears) % 360;
  const progressedSignIndex = Math.floor(progressedLongitude / 30);
  const signs = ["aries", "taurus", "gemini", "cancer", "leo", "virgo", "libra", "scorpio", "sagittarius", "capricorn", "aquarius", "pisces"];
  const progressedSign = signs[progressedSignIndex];
  let narrative = `**Your Age:** ${ageWhole} years old

`;
  narrative += `**Your Current Life Season**
`;
  narrative += `Using the progressed Sun (which moves one degree per year of life), you are currently in a ${capitalize6(progressedSign)} season of life. `;
  narrative += `This colors everything you do right now with ${capitalize6(progressedSign)} energy.

`;
  narrative += getProgressedSeasonMeaning(progressedSign);
  const degreesIntoSign = progressedLongitude % 30;
  const yearsUntilNextSeason = Math.round(30 - degreesIntoSign);
  narrative += `

**Timeline:** You have approximately ${yearsUntilNextSeason} years in this life season before transitioning to your ${capitalize6(signs[(progressedSignIndex + 1) % 12])} phase.`;
  return {
    title: "CURRENT SEASON: Where You Are Now",
    icon: "\u23F3",
    content: narrative
  };
}
function generateMonthlyFocusSection(chart, interpretations, currentDate) {
  const month = currentDate.getMonth();
  const day = currentDate.getDate();
  const sunSigns = [
    { sign: "capricorn", until: { month: 0, day: 19 } },
    { sign: "aquarius", until: { month: 1, day: 18 } },
    { sign: "pisces", until: { month: 2, day: 20 } },
    { sign: "aries", until: { month: 3, day: 19 } },
    { sign: "taurus", until: { month: 4, day: 20 } },
    { sign: "gemini", until: { month: 5, day: 20 } },
    { sign: "cancer", until: { month: 6, day: 22 } },
    { sign: "leo", until: { month: 7, day: 22 } },
    { sign: "virgo", until: { month: 8, day: 22 } },
    { sign: "libra", until: { month: 9, day: 22 } },
    { sign: "scorpio", until: { month: 10, day: 21 } },
    { sign: "sagittarius", until: { month: 11, day: 21 } }
  ];
  let transitSign = "capricorn";
  for (const entry of sunSigns) {
    if (month < entry.until.month || month === entry.until.month && day <= entry.until.day) {
      transitSign = entry.sign;
      break;
    }
  }
  if (month === 11 && day > 21) transitSign = "capricorn";
  const signs = ["aries", "taurus", "gemini", "cancer", "leo", "virgo", "libra", "scorpio", "sagittarius", "capricorn", "aquarius", "pisces"];
  const ascSign = chart.angles.ascendant.sign;
  const ascIndex = signs.indexOf(ascSign);
  const transitIndex = signs.indexOf(transitSign);
  let transitHouse = (transitIndex - ascIndex + 12) % 12 + 1;
  const monthName = currentDate.toLocaleDateString("en-US", { month: "long" });
  let narrative = `**${monthName} ${currentDate.getFullYear()} Focus**

`;
  narrative += `The Sun is currently transiting through ${capitalize6(transitSign)}, which activates your **House ${transitHouse}** \u2013 the house of ${HOUSE_THEMES[transitHouse]?.name || "life"}.

`;
  narrative += `**What This Month Asks of You:**
`;
  narrative += `${HOUSE_THEMES[transitHouse]?.beginnerExplanation || "Focus on this life area."}

`;
  narrative += `**Monthly Action Items:**
`;
  narrative += getMonthlyActions(transitHouse);
  narrative += `

**This Month's Energy:** ${capitalize6(transitSign)} energy is flowing through this area. Approach ${HOUSE_THEMES[transitHouse]?.name.toLowerCase() || "matters"} with ${getSignApproach(transitSign)} for best results.`;
  return {
    title: `THIS MONTH'S FOCUS: ${monthName} ${currentDate.getFullYear()}`,
    icon: "\u{1F4C5}",
    content: narrative
  };
}
function generateWatchOutsSection(chart, interpretations, aspects) {
  let narrative = `**Retrograde Planets in Your Chart**
`;
  const retrogrades = Object.entries(chart.planets).filter(([name, data]) => data.motionState === "retrograde");
  if (retrogrades.length === 0) {
    narrative += `You have no natal retrograde planets. Energy flows outward naturally for you.

`;
  } else {
    narrative += `You have ${retrogrades.length} planet(s) retrograde at birth:

`;
    for (const [name, data] of retrogrades) {
      narrative += `\u2022 **${capitalize6(name)} Retrograde** in ${capitalize6(data.sign)}: `;
      narrative += getRetrogradeWarning(name);
      narrative += `

`;
    }
  }
  narrative += `**Challenging Aspects to Be Aware Of**
`;
  const challengingAspects = aspects.filter((a) => a.type === "square" || a.type === "opposition").slice(0, 3);
  if (challengingAspects.length === 0) {
    narrative += `Your chart flows relatively harmoniously. You may need to generate your own motivation since the universe won't force growth through crisis as much.
`;
  } else {
    for (const aspect of challengingAspects) {
      narrative += `\u2022 **${capitalize6(aspect.planetOne.name)} ${aspect.symbol} ${capitalize6(aspect.planetTwo.name)}**: `;
      narrative += `${aspect.perception || "This creates tension that drives growth."} `;
      narrative += `*Resolution:* ${aspect.resolution || "Find balance between these energies."}

`;
    }
  }
  return {
    title: "AWARENESS: What to Watch For",
    icon: "\u26A0\uFE0F",
    content: narrative
  };
}
function generateReverseVantageSection(chart, aspects) {
  let narrative = `**Understanding Your Energy Flow (Reverse Vantage)**
`;
  narrative += `Most astrology reads energy in one direction (Planet A affects Planet B). Reverse Vantage reveals the *hidden truth*: how the receiving planet actually experiences and processes that energy. This is especially critical for "Forced Aspects" where one planet pushes onto another that isn't ready to receive it.

`;
  const relevantAspects = aspects.filter((a) => {
    const isForced = a.forcedStatus && a.forcedStatus !== "mutual" && a.forcedStatus !== "weak";
    const isMajor = ["conjunction", "square", "opposition", "trine"].includes(a.type);
    return isForced || isMajor;
  }).sort((a, b) => {
    const aForced = a.forcedStatus && a.forcedStatus !== "mutual" && a.forcedStatus !== "weak" ? 1 : 0;
    const bForced = b.forcedStatus && b.forcedStatus !== "mutual" && b.forcedStatus !== "weak" ? 1 : 0;
    return bForced - aForced;
  }).slice(0, 6);
  if (relevantAspects.length === 0) {
    narrative += `Your chart shows a relatively integrated energy flow without major forced conflicts in the primary placements.
`;
  } else {
    relevantAspects.forEach((aspect) => {
      const p1Name = capitalize6(aspect.planetOne.name);
      const p2Name = capitalize6(aspect.planetTwo.name);
      let receiverName = p2Name;
      let senderName = p1Name;
      let receiverHouse = aspect.planetTwo.house;
      let isForced = false;
      let forceDir = "";
      if (aspect.forcedStatus === "forced_by_1") {
        receiverName = p2Name;
        senderName = p1Name;
        receiverHouse = aspect.planetTwo.house;
        isForced = true;
        forceDir = `${p1Name} pushes onto ${p2Name}`;
      } else if (aspect.forcedStatus === "forced_by_2") {
        receiverName = p1Name;
        senderName = p2Name;
        receiverHouse = aspect.planetOne.house;
        isForced = true;
        forceDir = `${p2Name} pushes onto ${p1Name}`;
      } else {
        receiverName = p2Name;
        senderName = p1Name;
        receiverHouse = aspect.planetTwo.house;
      }
      narrative += `**${senderName} ${aspect.symbol} ${receiverName} (${capitalize6(aspect.type)})**`;
      if (isForced) narrative += ` \u26A0\uFE0F FORCED`;
      narrative += `
`;
      narrative += `*The Dynamic:* ${senderName} is sending energy to ${receiverName}.
`;
      narrative += `*Reverse Vantage (${receiverName} in House ${receiverHouse}):* `;
      if (isForced) {
        narrative += `This is a **Forced Aspect**. ${receiverName} does not naturally "see" ${senderName}, so the energy feels like an intrusion or a blind-side hit. ${receiverName} is being force-fed energy it didn't ask for. `;
      } else {
        narrative += `${receiverName} receives this energy naturally. `;
      }
      if (aspect.type === "trine") {
        narrative += `**Caution:** Because this is a Trine, ${receiverName} has **NO DEFENSE** against this flow. The energy floods in instantly. If ${senderName} is toxic or difficult, ${receiverName} absorbs it all without a filter. You must check the health of ${senderName}!
`;
      } else if (aspect.type === "square" || aspect.type === "opposition") {
        narrative += `${receiverName} feels blocked or challenged. It must create a new strategy in House ${receiverHouse} to accommodate this friction. The "problem" isn't ${senderName} \u2013 the solution is upgrading how ${receiverName} handles pressure.
`;
      } else {
        narrative += `${receiverName} must integrate this flow to function effectively.
`;
      }
      narrative += `
`;
    });
  }
  narrative += `**Why This Matters:** By understanding the "Receiver's" point of view, you can see where you might be unconsciously blocking support (squares/oppositions) or ignoring gifts (trines/sextiles).`;
  return {
    title: "REVERSE VANTAGE: The Hidden Flow",
    icon: "\u{1F504}",
    content: narrative
  };
}
function generateGiftsSection(chart, guidance) {
  let narrative = `**Your Natural Gifts & Strengths**

`;
  if (guidance?.strengths && guidance.strengths.length > 0) {
    for (const strength of guidance.strengths.slice(0, 4)) {
      narrative += `\u2022 **${strength.aspect}**: ${strength.description}
`;
      if (strength.advice) {
        narrative += `  *How to use it:* ${strength.advice}
`;
      }
      narrative += `
`;
    }
  } else {
    narrative += `Your unique combination of placements gives you special gifts:

`;
    const sun = chart.planets.sun;
    const moon2 = chart.planets.moon;
    narrative += `\u2022 Your ${capitalize6(sun.sign)} Sun in House ${sun.house} gives you ${getSignGift(sun.sign)} in ${HOUSE_THEMES[sun.house]?.name.toLowerCase() || "life"} matters.

`;
    narrative += `\u2022 Your ${capitalize6(moon2.sign)} Moon provides ${getSignGift(moon2.sign)} emotional intelligence.

`;
  }
  narrative += `**Remember:** These are not just abilities \u2013 they are responsibilities. You have these gifts to share with the world. When you use them, you fulfill your purpose.`;
  return {
    title: "YOUR GIFTS: Natural Strengths",
    icon: "\u2728",
    content: narrative
  };
}
function generateTrueIdentitySection(chart) {
  let narrative = `**Your True Operating System (Spark & Base)**
`;
  narrative += `Standard astrology reads the "paint" (zodiac sign). Alchemystic Astrology reads the "operating system" (Spark) and the "fuel source" (Base). This is who you REALLY are.

`;
  const sunIdentity = calculateFullIdentity("sun", chart.planets.sun, chart.houses);
  narrative += `**\u2609 Your Sun (Vitality/Identity)**
`;
  narrative += `${sunIdentity.summary}
`;
  if (sunIdentity.sparkDetails) {
    narrative += `\u2022 *Tone (Paint):* ${sunIdentity.tone} \u2013 This is the color people see.
`;
    narrative += `\u2022 *Spark (Operating System):* ${sunIdentity.spark} \u2013 This is how you actually function.
`;
  }
  if (sunIdentity.baseDetails?.base) {
    narrative += `\u2022 *Base (Fuel Source):* ${capitalize6(sunIdentity.baseDetails.base)} \u2013 This is where your vitality pulls its energy from.
`;
    narrative += `  ${sunIdentity.baseDetails.interpretation}
`;
  }
  narrative += `
`;
  const moonIdentity = calculateFullIdentity("moon", chart.planets.moon, chart.houses);
  narrative += `**\u263D Your Moon (Safety/Needs)**
`;
  narrative += `${moonIdentity.summary}
`;
  if (moonIdentity.sparkDetails) {
    narrative += `\u2022 *Tone (Paint):* ${moonIdentity.tone} \u2013 The emotional filter.
`;
    narrative += `\u2022 *Spark (Operating System):* ${moonIdentity.spark} \u2013 How you actually process emotions.
`;
  }
  if (moonIdentity.baseDetails?.base) {
    narrative += `\u2022 *Base (Fuel Source):* ${capitalize6(moonIdentity.baseDetails.base)} \u2013 Where your emotional safety is sourced from.
`;
    narrative += `  ${moonIdentity.baseDetails.interpretation}
`;
  }
  narrative += `
`;
  const rising = chart.angles.ascendant;
  narrative += `**Your Anchor:** ${capitalize6(rising.sign)} Rising. This is the lens through which all Sparks and Bases express. The houses are counted from here.
`;
  return {
    title: "TRUE IDENTITY: Spark & Base",
    icon: "\u26A1",
    content: narrative
  };
}
function generateDelegateFlowSection(chart) {
  let narrative = `**Where Your Energy Patterns Come From**
`;
  narrative += `In Alchemystic Astrology, a planet doesn't just "sit" in a house. It *pulls* energy from another house (its Base) and *delegates* it into its placement. This reveals the hidden "why" behind your patterns.

`;
  const sunFlow = analyzeDelegateFlow("sun", chart.planets.sun, chart.houses);
  if (sunFlow.flow) {
    narrative += `**\u2609 Sun Delegation (Identity/Father)**
`;
    narrative += `${sunFlow.interpretation}
`;
    if (sunFlow.warning) {
      narrative += `${sunFlow.warning}
`;
    }
    narrative += `
`;
  }
  const moonFlow = analyzeDelegateFlow("moon", chart.planets.moon, chart.houses);
  if (moonFlow.flow) {
    narrative += `**\u263D Moon Delegation (Safety/Mother)**
`;
    narrative += `${moonFlow.interpretation}
`;
    if (moonFlow.warning) {
      narrative += `${moonFlow.warning}
`;
    }
    narrative += `
`;
  }
  const venusFlow = analyzeDelegateFlow("venus", chart.planets.venus, chart.houses);
  if (venusFlow.flow) {
    narrative += `**\u2640 Venus Delegation (Value/Love)**
`;
    narrative += `${venusFlow.interpretation}
`;
    if (venusFlow.warning) {
      narrative += `${venusFlow.warning}
`;
    }
    narrative += `
`;
  }
  narrative += `**The Key Insight:** When you understand delegation, you stop blaming the "destination" house for problems. The issue is always in the "source" house. Fix the source, and the destination clears up.`;
  return {
    title: "DELEGATE FLOW: The Hidden Why",
    icon: "\u{1F517}",
    content: narrative
  };
}
function generateTraumaTimelineSection(chart) {
  let narrative = `**Significant Ages & Trauma Indicators**
`;
  narrative += `Planetary cycles create predictable activation points. These are ages when deep psychological material is likely to surface or when significant events occurred.

`;
  const timeline = calculateTraumaTimeline(chart);
  narrative += `**Universal Activation Points:**
`;
  for (const event of timeline.slice(0, 8)) {
    narrative += `\u2022 **Age ${event.ageRange}** (${event.event}): ${event.description}
`;
  }
  narrative += `
`;
  const specificIndicators = calculateSpecificTraumaIndicators(chart);
  if (specificIndicators.length > 0) {
    narrative += `**Your Specific Indicators:**
`;
    for (const indicator of specificIndicators) {
      const severityIcon = indicator.severity === "high" ? "\u26A0\uFE0F" : "\u{1F4CD}";
      narrative += `${severityIcon} **${indicator.planet}** (House ${indicator.house}): ${indicator.description}
`;
      narrative += `   *Key Ages:* ${indicator.ageRange}

`;
    }
  } else {
    narrative += `No major trauma indicators detected in the primary placements. This does not mean no challenges exist, but the chart does not show the typical "hot spots."
`;
  }
  narrative += `**Note:** This section identifies *patterns*, not predictions. Use this information for self-understanding, not diagnosis.`;
  return {
    title: "SIGNIFICANT AGES: Trauma Timeline",
    icon: "\u{1F4C5}",
    content: narrative
  };
}
function getSignPersonality(sign) {
  const personalities = {
    aries: "bold, direct, and action-oriented",
    taurus: "grounded, sensual, and steady",
    gemini: "curious, adaptable, and communicative",
    cancer: "nurturing, protective, and intuitive",
    leo: "confident, warm, and charismatic",
    virgo: "analytical, helpful, and detail-oriented",
    libra: "charming, diplomatic, and balanced",
    scorpio: "intense, magnetic, and perceptive",
    sagittarius: "adventurous, philosophical, and optimistic",
    capricorn: "ambitious, disciplined, and professional",
    aquarius: "unique, innovative, and humanitarian",
    pisces: "compassionate, intuitive, and imaginative"
  };
  return personalities[sign] || "unique in your own way";
}
function getEmotionalStyleByElement(element, sign) {
  const styles = {
    fire: `As a ${capitalize6(sign)} Moon (Fire element), your emotions are passionate and quick to ignite. You need excitement, adventure, and creative expression to feel alive. Boredom is your enemy \u2013 you thrive when inspired.`,
    earth: `As a ${capitalize6(sign)} Moon (Earth element), you need tangible security and stability to feel emotionally safe. Physical comfort, financial stability, and routine ground you. You process emotions practically.`,
    air: `As a ${capitalize6(sign)} Moon (Air element), you process emotions through thinking and communicating. Talking things out helps you understand how you feel. You need intellectual stimulation and social connection.`,
    water: `As a ${capitalize6(sign)} Moon (Water element), you feel deeply and intuitively. You pick up on the emotions of others and need time alone to process. Your emotional world is rich and complex.`
  };
  return styles[element] || "Your emotional style is unique to you.";
}
function getSignThinkingStyle(sign) {
  const styles = {
    aries: "quick, decisive, and action-oriented",
    taurus: "methodical, practical, and thorough",
    gemini: "versatile, curious, and quick-witted",
    cancer: "intuitive, memory-based, and emotionally intelligent",
    leo: "creative, confident, and dramatic",
    virgo: "analytical, precise, and detail-focused",
    libra: "balanced, diplomatic, and weighing all sides",
    scorpio: "deep, investigative, and penetrating",
    sagittarius: "expansive, philosophical, and big-picture",
    capricorn: "strategic, structured, and goal-oriented",
    aquarius: "innovative, unconventional, and futuristic",
    pisces: "imaginative, intuitive, and flowing"
  };
  return styles[sign] || "unique";
}
function getSignAttractionStyle(sign) {
  const styles = {
    aries: "bold confidence and directness",
    taurus: "sensuality and reliability",
    gemini: "wit and intellectual charm",
    cancer: "nurturing warmth and emotional depth",
    leo: "radiant confidence and generosity",
    virgo: "helpfulness and attention to care",
    libra: "grace, beauty, and diplomacy",
    scorpio: "magnetic intensity and mystery",
    sagittarius: "adventurous spirit and optimism",
    capricorn: "ambition and quiet strength",
    aquarius: "uniqueness and intellectual appeal",
    pisces: "dreamy romance and empathy"
  };
  return styles[sign] || "your unique qualities";
}
function getSignLoveExpression(sign) {
  const expressions = {
    aries: "passionately and directly",
    taurus: "through physical touch and gifts",
    gemini: "through words and conversation",
    cancer: "through nurturing and care",
    leo: "grandly and dramatically",
    virgo: "through acts of service",
    libra: "through partnership and harmony",
    scorpio: "intensely and deeply",
    sagittarius: "through adventure and freedom",
    capricorn: "through commitment and providing",
    aquarius: "through friendship and acceptance",
    pisces: "through devotion and compassion"
  };
  return expressions[sign] || "in your own unique way";
}
function getSignActionStyle(sign) {
  const styles = {
    aries: "immediate, bold, and pioneering",
    taurus: "steady, persistent, and unstoppable once started",
    gemini: "adaptable, multi-tasking, and quick",
    cancer: "emotionally driven and protective",
    leo: "confident, dramatic, and heart-centered",
    virgo: "precise, methodical, and improvement-focused",
    libra: "balanced, fair, and partnership-oriented",
    scorpio: "strategic, intense, and all-or-nothing",
    sagittarius: "enthusiastic, expansive, and freedom-seeking",
    capricorn: "disciplined, strategic, and results-focused",
    aquarius: "unconventional, innovative, and cause-driven",
    pisces: "intuitive, fluid, and compassion-motivated"
  };
  return styles[sign] || "unique";
}
function getProgressedSeasonMeaning(sign) {
  const meanings = {
    aries: "This is a time of new beginnings and bold initiatives. You are learning to assert yourself and take the lead. Start new projects, be courageous, and trust your pioneering instincts.",
    taurus: "This is a stabilizing period focused on building and grounding. Slow down, appreciate beauty, cultivate resources, and focus on what has lasting value. Patience is your ally.",
    gemini: "This is a curious, social, and learning-focused period. Gather information, make connections, explore ideas, and stay adaptable. Your mind is hungry for stimulation.",
    cancer: "This is a period of emotional deepening and home focus. Family, roots, and creating a sanctuary matter now. Nurture yourself and others. Honor your feelings.",
    leo: "This is a creative, expressive, and heart-centered period. Shine brightly, take center stage, create from the heart, and lead with warmth. This is your time to be seen.",
    virgo: "This is a period of refinement, health, and service. Improve yourself, organize your life, focus on wellness, and be of service. The details matter now.",
    libra: "This is a relationship-focused, balance-seeking period. Partnerships of all kinds take center stage. Seek harmony, beauty, and fairness in all things.",
    scorpio: "This is a deep, transformative, and intense period. You are going through profound changes. Let go of what no longer serves you to make room for rebirth.",
    sagittarius: "This is an expansive, adventurous, and philosophical period. Seek truth, expand your horizons, travel (mentally or physically), and embrace freedom.",
    capricorn: "This is an ambitious, disciplined, and achievement-focused period. Build toward long-term goals, take on responsibility, and establish your legacy.",
    aquarius: "This is an innovative, humanitarian, and future-focused period. Break free from limitations, embrace your uniqueness, and contribute to the collective.",
    pisces: "This is a spiritual, intuitive, and dissolving period. Rest, dream, connect to the divine, and prepare for the next cycle. Let go of rigid structures."
  };
  return meanings[sign] || "Embrace this season of life and its unique lessons.";
}
function getMonthlyActions(house) {
  const actions = {
    1: "\u2022 Update your personal presentation\n\u2022 Start a self-improvement project\n\u2022 Assert your needs clearly",
    2: "\u2022 Review your finances\n\u2022 Clarify your values\n\u2022 Build something of lasting worth",
    3: "\u2022 Reach out to siblings or neighbors\n\u2022 Learn something new\n\u2022 Communicate important messages",
    4: "\u2022 Focus on home and family\n\u2022 Connect with your roots\n\u2022 Create emotional security",
    5: "\u2022 Express yourself creatively\n\u2022 Enjoy romance and fun\n\u2022 Spend quality time with children",
    6: "\u2022 Optimize your daily routines\n\u2022 Focus on health and wellness\n\u2022 Be of service to others",
    7: "\u2022 Nurture key relationships\n\u2022 Seek partnership opportunities\n\u2022 Find balance with others",
    8: "\u2022 Handle shared resources\n\u2022 Go deep emotionally\n\u2022 Let go of what no longer serves",
    9: "\u2022 Expand your horizons\n\u2022 Study or travel\n\u2022 Explore your beliefs",
    10: "\u2022 Make career moves\n\u2022 Build your public reputation\n\u2022 Set long-term goals",
    11: "\u2022 Connect with friends and groups\n\u2022 Work toward hopes and dreams\n\u2022 Contribute to community",
    12: "\u2022 Rest and reflect\n\u2022 Engage in spiritual practice\n\u2022 Process what is completing"
  };
  return actions[house] || "\u2022 Focus on growth in this life area";
}
function getSignApproach(sign) {
  const approaches = {
    aries: "boldness and initiative",
    taurus: "patience and persistence",
    gemini: "flexibility and curiosity",
    cancer: "nurturing and intuition",
    leo: "confidence and heart",
    virgo: "precision and helpfulness",
    libra: "diplomacy and grace",
    scorpio: "depth and intensity",
    sagittarius: "optimism and adventure",
    capricorn: "discipline and strategy",
    aquarius: "innovation and openness",
    pisces: "compassion and intuition"
  };
  return approaches[sign] || "authenticity";
}
function getRetrogradeWarning(planet) {
  const warnings = {
    mercury: "Communication and thinking may be more internalized. Revisit ideas before speaking. Double-check details.",
    venus: "Relationships and values may need internal review. Old loves or values may resurface for resolution.",
    mars: "Action may be more considered and strategic. You process anger internally. Use physical outlets.",
    jupiter: "Growth and expansion happen more through internal wisdom than external opportunity.",
    saturn: "You internalized discipline early. You may be harder on yourself than necessary.",
    uranus: "Your rebellious and innovative nature expresses in subtle, inner ways.",
    neptune: "Your spirituality and imagination are very personal and private.",
    pluto: "Deep transformation happens within. You may resist external change until internally ready."
  };
  return warnings[planet] || "This energy is internalized in your chart.";
}
function getSignGift(sign) {
  const gifts = {
    aries: "pioneering leadership and courage",
    taurus: "grounded stability and persistence",
    gemini: "quick wit and communication skills",
    cancer: "emotional intelligence and nurturing",
    leo: "natural charisma and creative expression",
    virgo: "analytical precision and helpfulness",
    libra: "diplomatic grace and relationship skills",
    scorpio: "transformative depth and intuition",
    sagittarius: "inspiring optimism and wisdom-seeking",
    capricorn: "strategic ambition and mastery",
    aquarius: "innovative thinking and humanitarian vision",
    pisces: "compassionate understanding and artistic vision"
  };
  return gifts[sign] || "unique talents";
}
function generateReportHTML(report) {
  let html = `
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${report.title}</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Inter:wght@400;500;600&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Cormorant Garamond', Georgia, serif;
            font-size: 18px;
            line-height: 1.8;
            color: #2d2d2d;
            background: #fdfcfa;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .report-header {
            text-align: center;
            margin-bottom: 50px;
            padding-bottom: 30px;
            border-bottom: 2px solid #8b7355;
        }
        
        .report-title {
            font-size: 2.5rem;
            font-weight: 600;
            color: #4a3728;
            margin-bottom: 10px;
            letter-spacing: 2px;
        }
        
        .report-subtitle {
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            color: #7a6a5a;
            text-transform: uppercase;
            letter-spacing: 3px;
        }
        
        .birth-info {
            font-family: 'Inter', sans-serif;
            font-size: 0.9rem;
            color: #5a4a3a;
            margin-top: 20px;
            padding: 15px;
            background: linear-gradient(135deg, #f5f0e8 0%, #ebe4d8 100%);
            border-radius: 8px;
        }
        
        .section {
            margin-bottom: 50px;
            page-break-inside: avoid;
        }
        
        .section-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #d4c4a8;
        }
        
        .section-icon {
            font-size: 1.8rem;
            color: #8b7355;
        }
        
        .section-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: #4a3728;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .section-content {
            text-align: justify;
            hyphens: auto;
        }
        
        .section-content p {
            margin-bottom: 1em;
            text-indent: 1.5em;
        }
        
        .section-content p:first-of-type {
            text-indent: 0;
        }
        
        .section-content strong {
            color: #4a3728;
            font-weight: 600;
        }
        
        .section-content em {
            font-style: italic;
            color: #6a5a4a;
        }
        
        .generated-date {
            text-align: center;
            font-family: 'Inter', sans-serif;
            font-size: 0.8rem;
            color: #999;
            margin-top: 50px;
            padding-top: 20px;
            border-top: 1px solid #ddd;
        }
        
        @page {
            margin: 0.6in 0.5in;
            size: auto;
        }
        
        @media print {
            body {
                padding: 0;
                margin: 0;
                font-size: 11pt;
            }
            
            .report-header {
                margin-bottom: 30px;
                page-break-after: avoid;
            }
            
            .section {
                margin-bottom: 30px;
                page-break-inside: auto;
            }
            
            .section h2 {
                page-break-after: avoid;
            }
            
            .section p {
                orphans: 3;
                widows: 3;
            }
        }
        
        /* Action items styling */
        .section-content ul {
            list-style: none;
            margin: 1em 0;
            padding-left: 0;
        }
        
        .section-content li {
            margin-bottom: 0.5em;
            padding-left: 1.5em;
            position: relative;
        }
        
        .section-content li::before {
            content: "\u2022";
            position: absolute;
            left: 0;
            color: #8b7355;
            font-weight: bold;
        }
        .print-bar{position:fixed;top:0;left:0;right:0;background:rgba(0,0,0,0.9);padding:12px 20px;display:flex;justify-content:center;gap:15px;z-index:9999;}
        .print-bar button{padding:10px 24px;border:none;border-radius:8px;font-family:'Inter',sans-serif;font-size:0.9rem;cursor:pointer;font-weight:500;}
        .print-btn{background:#c9a96e;color:#000;}
        .close-btn{background:rgba(255,255,255,0.15);color:#fff;border:1px solid rgba(255,255,255,0.3)!important;}
        @media print{.print-bar{display:none!important;}}
    </style>
</head>
<body>
    <div class="print-bar">
      <button class="print-btn" onclick="window.print()">Print / Save as PDF</button>
      <button class="close-btn" onclick="window.close()">Close</button>
    </div>
    <header class="report-header">
        <h1 class="report-title">${report.title}</h1>
        <p class="report-subtitle">Based on ADS/FREE Theory Calculations</p>
        <div class="birth-info">
            <strong>Born:</strong> ${report.birthInfo.dateFormatted} at ${report.birthInfo.timeFormatted}<br>
            <strong>Location:</strong> ${report.birthInfo.location}
        </div>
    </header>
    
    <main>
`;
  for (const section of report.sections) {
    let content = section.content.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>").replace(/\*(.*?)\*/g, "<em>$1</em>").replace(/\n\n/g, "</p><p>").replace(/\n/g, "</p><ul><li>").replace(/\s/g, "</li><li>").replace(/(<li>.*?)(?=<\/p>|$)/g, "$1</li></ul>");
    if (!content.startsWith("<p>")) {
      content = "<p>" + content + "</p>";
    }
    html += `
        <section class="section">
            <div class="section-header">
                <span class="section-icon">${section.icon}</span>
                <h2 class="section-title">${section.title}</h2>
            </div>
            <div class="section-content">
                ${content}
            </div>
        </section>
`;
  }
  html += `
    </main>
    
    <footer class="generated-date">
        Report generated on ${report.generatedDate}<br>
        <em>Readings-Astrology \u2022 ADS/FREE Theory Chart Engine</em>
    </footer>
</body>
</html>
`;
  return html;
}

// src/engine/question-discovery.js
var DISCOVERY_CATEGORIES = [
  {
    id: "relationships",
    label: "\u{1F495} Relationships & Love",
    description: "Partnership patterns, compatibility, timing",
    icon: "\u{1F495}",
    color: "#f472b6"
  },
  {
    id: "career",
    label: "\u{1F4BC} Career & Life Purpose",
    description: "Vocation, calling, professional path",
    icon: "\u{1F4BC}",
    color: "#60a5fa"
  },
  {
    id: "personal_growth",
    label: "\u{1F331} Personal Growth & Healing",
    description: "Shadow work, wounds, transformation",
    icon: "\u{1F331}",
    color: "#34d399"
  },
  {
    id: "timing",
    label: "\u23F0 Current Life Situation",
    description: "What's happening now, transits, timing",
    icon: "\u23F0",
    color: "#fbbf24"
  },
  {
    id: "general",
    label: "\u{1F3AF} Complete Profile",
    description: "Comprehensive reading of all areas",
    icon: "\u{1F3AF}",
    color: "#c084fc"
  },
  {
    id: "specific",
    label: "\u2753 Specific Question",
    description: "I have something particular to ask",
    icon: "\u2753",
    color: "#fb923c"
  }
];
var FOLLOW_UP_QUESTIONS = {
  relationships: [
    {
      id: "rel_status",
      question: "Current relationship status?",
      type: "choice",
      options: [
        "Single, looking",
        "Dating someone",
        "In a relationship",
        "Married / Long-term",
        "Complicated situation",
        "Recently ended"
      ]
    },
    {
      id: "rel_focus",
      question: "What do you want to understand?",
      type: "multi",
      options: [
        "Why my relationships follow certain patterns",
        "Compatibility with someone specific",
        "When I'll meet someone",
        "How to heal from past relationships",
        "What I need in a partner",
        "Current relationship challenges"
      ]
    }
  ],
  career: [
    {
      id: "career_status",
      question: "Where are you in your career journey?",
      type: "choice",
      options: [
        "Just starting / exploring",
        "Established but unfulfilled",
        "Considering a change",
        "Between careers",
        "Building something new",
        "Successful, seeking next level"
      ]
    },
    {
      id: "career_focus",
      question: "What do you want to understand?",
      type: "multi",
      options: [
        "My true calling / life purpose",
        "Best career paths for me",
        "Timing for career changes",
        "How to overcome obstacles",
        "Financial patterns & opportunities",
        "Work-life balance"
      ]
    }
  ],
  personal_growth: [
    {
      id: "growth_focus",
      question: "What areas of growth are calling to you?",
      type: "multi",
      options: [
        "Healing old wounds",
        "Understanding shadow patterns",
        "Embracing my power",
        "Breaking free from limitations",
        "Spiritual development",
        "Self-acceptance"
      ]
    }
  ],
  timing: [
    {
      id: "timing_context",
      question: "What's happening in your life right now?",
      type: "text"
    },
    {
      id: "timing_focus",
      question: "What do you want to understand about this time?",
      type: "multi",
      options: [
        "Why things feel challenging",
        "What opportunities are available",
        "When will things shift",
        "What lessons am I learning",
        "How to navigate this period"
      ]
    }
  ]
};
var ANALYSIS_ROUTING = {
  relationships: {
    chartFactors: [
      { name: "Venus", key: "venus", description: "Love style & attraction", icon: "\u2640" },
      { name: "Mars", key: "mars", description: "Pursuit & desire patterns", icon: "\u2642" },
      { name: "7th House", key: "house_7", description: "Partnerships & commitment", icon: "\u2696" },
      { name: "5th House", key: "house_5", description: "Romance & pleasure", icon: "\u{1F3AD}" },
      { name: "8th House", key: "house_8", description: "Intimacy & shared resources", icon: "\u{1F982}" },
      { name: "Chiron", key: "chiron", description: "Relationship wounds", icon: "\u26B7" },
      { name: "Black Moon Lilith", key: "lilith", description: "Shadow dynamics in love", icon: "\u26B8" },
      { name: "Descendant", key: "descendant", description: "What you attract", icon: "\u2193" }
    ],
    methodologies: [
      "Taming & Embracing Black Moon Lilith",
      "Accepting Chiron",
      "Delegates and house conditions"
    ],
    knowledgeQueries: [
      "Venus placement interpretation love",
      "7th house relationships partnership",
      "Chiron relationship wounds healing",
      "Black Moon Lilith shadow love"
    ]
  },
  career: {
    chartFactors: [
      { name: "Midheaven (MC)", key: "midheaven", description: "Career path & public image", icon: "MC" },
      { name: "10th House", key: "house_10", description: "Public role & reputation", icon: "\u{1F3DB}" },
      { name: "Sun", key: "sun", description: "Core identity & vitality", icon: "\u2609" },
      { name: "Saturn", key: "saturn", description: "Discipline & mastery", icon: "\u2644" },
      { name: "2nd House", key: "house_2", description: "Income & values", icon: "\u{1F4B0}" },
      { name: "6th House", key: "house_6", description: "Daily work & service", icon: "\u2692" },
      { name: "North Node", key: "northNode", description: "Life direction", icon: "\u260A" }
    ],
    methodologies: [
      "True Placements + Base",
      "Delegates and house conditions"
    ],
    knowledgeQueries: [
      "Midheaven career path vocation",
      "10th house public role reputation",
      "Saturn work discipline mastery",
      "North Node life direction purpose"
    ]
  },
  personal_growth: {
    chartFactors: [
      { name: "Chiron", key: "chiron", description: "Core wound & healing", icon: "\u26B7" },
      { name: "Black Moon Lilith", key: "lilith", description: "Shadow integration", icon: "\u26B8" },
      { name: "North Node", key: "northNode", description: "Evolutionary direction", icon: "\u260A" },
      { name: "12th House", key: "house_12", description: "Unconscious patterns", icon: "\u{1F30A}" },
      { name: "Pluto", key: "pluto", description: "Transformation power", icon: "\u2647" },
      { name: "Saturn", key: "saturn", description: "Limitations to overcome", icon: "\u2644" },
      { name: "Neptune", key: "neptune", description: "Spiritual connection", icon: "\u2646" }
    ],
    methodologies: [
      "Accepting Chiron",
      "Taming & Embracing Black Moon Lilith",
      "Reverse Vantage",
      "Natal Retrograde Optimization"
    ],
    knowledgeQueries: [
      "Chiron wound healing acceptance",
      "Black Moon Lilith shadow embrace",
      "Pluto transformation rebirth",
      "North Node growth evolution"
    ]
  },
  timing: {
    chartFactors: [
      { name: "Current Transits", key: "transits", description: "Active planetary influences", icon: "\u{1F310}" },
      { name: "Spark Points", key: "spark", description: "Activation moments", icon: "\u26A1" },
      { name: "Jupiter Transit", key: "jupiter_transit", description: "Expansion & opportunity", icon: "\u2643" },
      { name: "Saturn Transit", key: "saturn_transit", description: "Structure & lessons", icon: "\u2644" },
      { name: "Pluto Transit", key: "pluto_transit", description: "Deep transformation", icon: "\u2647" },
      { name: "Uranus Transit", key: "uranus_transit", description: "Sudden changes", icon: "\u2645" }
    ],
    methodologies: [
      "True Placements + Base + Intro to Spark",
      "Transit interpretation"
    ],
    knowledgeQueries: [
      "transit interpretation timing",
      "spark point activation current",
      "Saturn transit lessons structure"
    ]
  },
  general: {
    chartFactors: [
      { name: "Sun", key: "sun", description: "Core identity", icon: "\u2609" },
      { name: "Moon", key: "moon", description: "Emotional needs", icon: "\u263D" },
      { name: "Ascendant", key: "ascendant", description: "Surface personality", icon: "AC" },
      { name: "Venus", key: "venus", description: "Love & values", icon: "\u2640" },
      { name: "Mars", key: "mars", description: "Drive & action", icon: "\u2642" },
      { name: "Saturn", key: "saturn", description: "Discipline & fears", icon: "\u2644" },
      { name: "Chiron", key: "chiron", description: "Core wound", icon: "\u26B7" },
      { name: "North Node", key: "northNode", description: "Life direction", icon: "\u260A" },
      { name: "Current Transits", key: "transits", description: "What's happening now", icon: "\u{1F310}" }
    ],
    methodologies: [
      "True Placements + Base",
      "Accepting Chiron",
      "Delegates and house conditions",
      "Aspect Spectrum"
    ],
    knowledgeQueries: [
      "true placement base identity",
      "Chiron wound healing",
      "aspect spectrum interpretation"
    ]
  }
};
function buildAnalysisPlan(selectedCategories, followUpResponses = {}) {
  const plan = {
    categories: selectedCategories,
    chartFactors: [],
    methodologies: /* @__PURE__ */ new Set(),
    knowledgeQueries: [],
    userContext: followUpResponses,
    estimatedSteps: 0,
    estimatedTime: 0
  };
  for (const category of selectedCategories) {
    const routing = ANALYSIS_ROUTING[category];
    if (!routing) continue;
    plan.chartFactors.push(...routing.chartFactors);
    routing.methodologies.forEach((m) => plan.methodologies.add(m));
    plan.knowledgeQueries.push(...routing.knowledgeQueries);
  }
  const seen = /* @__PURE__ */ new Set();
  plan.chartFactors = plan.chartFactors.filter((f) => {
    if (seen.has(f.key)) return false;
    seen.add(f.key);
    return true;
  });
  plan.methodologies = [...plan.methodologies];
  plan.estimatedSteps = plan.chartFactors.length + 2;
  plan.estimatedTime = Math.max(3, plan.estimatedSteps * 0.8);
  return plan;
}
function inferPlanFromQuestion(question) {
  const q = question.toLowerCase();
  const categories = [];
  const relWords = ["relationship", "love", "partner", "dating", "marriage", "boyfriend", "girlfriend", "spouse", "attract", "connection", "romance", "crush", "ex"];
  if (relWords.some((w) => q.includes(w))) categories.push("relationships");
  const careerWords = ["career", "job", "work", "profession", "calling", "vocation", "purpose", "path", "success", "money", "income", "business"];
  if (careerWords.some((w) => q.includes(w))) categories.push("career");
  const growthWords = ["grow", "heal", "overcome", "challenge", "shadow", "wound", "pattern", "struggle", "block", "fear", "anxiety", "trauma"];
  if (growthWords.some((w) => q.includes(w))) categories.push("personal_growth");
  const timingWords = ["when", "timing", "now", "currently", "happening", "future", "soon", "period", "this year", "month"];
  if (timingWords.some((w) => q.includes(w))) categories.push("timing");
  if (categories.length === 0) categories.push("general");
  return buildAnalysisPlan(categories, { specificQuestion: question });
}
function generateFocusedReading(chartReading, analysisPlan) {
  const { chart, aspects, interpretations, guidance } = chartReading;
  const sections = [];
  for (const factor of analysisPlan.chartFactors) {
    const section = generateFactorSection(factor, chart, aspects, interpretations);
    if (section) sections.push(section);
  }
  const synthesis = generateSynthesis(analysisPlan, chart, aspects, interpretations, guidance);
  return {
    title: getReadingTitle(analysisPlan),
    subtitle: getReadingSubtitle(analysisPlan),
    categories: analysisPlan.categories,
    sections,
    synthesis,
    methodologies: analysisPlan.methodologies,
    factorCount: analysisPlan.chartFactors.length,
    generatedAt: (/* @__PURE__ */ new Date()).toISOString()
  };
}
function generateFactorSection(factor, chart, aspects, interpretations) {
  const planets = chart.planets || {};
  const houses = chart.houses || {};
  const angles = chart.angles || {};
  switch (factor.key) {
    case "sun":
    case "moon":
    case "mercury":
    case "venus":
    case "mars":
    case "jupiter":
    case "saturn":
    case "uranus":
    case "neptune":
    case "pluto":
    case "chiron":
    case "lilith":
    case "northNode": {
      const planetKey = factor.key === "northNode" ? "north node" : factor.key;
      const planetData = planets[planetKey] || planets[factor.key];
      if (!planetData) return null;
      const interp = interpretations?.planets?.[planetKey] || interpretations?.planets?.[factor.key];
      const planetAspects = aspects.filter(
        (a) => a.planetOne?.name === planetKey || a.planetTwo?.name === planetKey || a.planetOne?.name === factor.key || a.planetTwo?.name === factor.key
      );
      return {
        title: `${factor.icon} ${factor.name}`,
        subtitle: factor.description,
        type: "planet",
        data: {
          sign: planetData.sign,
          house: planetData.house,
          degree: planetData.degree,
          retrograde: planetData.motionState === "retrograde",
          interpretation: interp,
          aspects: planetAspects.slice(0, 5).map((a) => ({
            type: a.type,
            symbol: a.symbol,
            otherPlanet: a.planetOne?.name === planetKey ? a.planetTwo?.name : a.planetOne?.name,
            perception: a.perception,
            reality: a.reality,
            resolution: a.resolution
          }))
        }
      };
    }
    case "ascendant":
    case "descendant":
    case "midheaven": {
      const angleData = angles[factor.key];
      if (!angleData) return null;
      return {
        title: `${factor.icon} ${factor.name}`,
        subtitle: factor.description,
        type: "angle",
        data: {
          sign: angleData.sign,
          degree: angleData.degree
        }
      };
    }
    case "house_2":
    case "house_5":
    case "house_6":
    case "house_7":
    case "house_8":
    case "house_10":
    case "house_12": {
      const houseNum = parseInt(factor.key.split("_")[1]);
      const houseData = houses[houseNum];
      if (!houseData) return null;
      const planetsInHouse = Object.entries(planets).filter(([, p]) => p.house === houseNum).map(([name, data]) => ({ name, ...data }));
      return {
        title: `${factor.icon} ${factor.name}`,
        subtitle: factor.description,
        type: "house",
        data: {
          number: houseNum,
          sign: houseData.sign,
          planets: planetsInHouse
        }
      };
    }
    case "transits":
    case "spark":
    case "jupiter_transit":
    case "saturn_transit":
    case "pluto_transit":
    case "uranus_transit":
      return {
        title: `${factor.icon} ${factor.name}`,
        subtitle: factor.description,
        type: "transit",
        data: { note: "Transit data available in yearly forecast section." }
      };
    default:
      return null;
  }
}
function generateSynthesis(plan, chart, aspects, interpretations, guidance) {
  const lines = [];
  if (plan.categories.includes("relationships")) {
    const venus = chart.planets?.venus;
    const mars = chart.planets?.mars;
    if (venus && mars) {
      lines.push(`Your love style is shaped by Venus in ${capitalize7(venus.sign)} (House ${venus.house}) \u2014 this defines how you attract and what you value in partnership.`);
      lines.push(`Mars in ${capitalize7(mars.sign)} (House ${mars.house}) fuels your pursuit energy and shows how you go after what you desire.`);
    }
  }
  if (plan.categories.includes("career")) {
    const sun = chart.planets?.sun;
    const saturn = chart.planets?.saturn;
    if (sun) {
      lines.push(`Your career identity is anchored by the Sun in ${capitalize7(sun.sign)} (House ${sun.house}) \u2014 this is your core vitality and what you're here to express.`);
    }
    if (saturn) {
      lines.push(`Saturn in ${capitalize7(saturn.sign)} (House ${saturn.house}) shows where you must build mastery through discipline and patience.`);
    }
  }
  if (plan.categories.includes("personal_growth")) {
    const chiron = chart.planets?.chiron;
    const pluto = chart.planets?.pluto;
    if (chiron) {
      lines.push(`Chiron in ${capitalize7(chiron.sign)} (House ${chiron.house}) reveals your deepest wound \u2014 and simultaneously your greatest gift for healing others.`);
    }
    if (pluto) {
      lines.push(`Pluto in ${capitalize7(pluto.sign)} (House ${pluto.house}) is your engine of transformation. Embrace the cycles of death and rebirth here.`);
    }
  }
  if (guidance?.actions?.length > 0) {
    lines.push("");
    lines.push("**Key Actions:**");
    for (const action of guidance.actions.slice(0, 3)) {
      lines.push(`\u2022 ${action.focus}: ${action.action}`);
    }
  }
  return lines.join("\n");
}
function getReadingTitle(plan) {
  if (plan.categories.length === 1) {
    const titles = {
      relationships: "Love & Relationships Reading",
      career: "Career & Life Purpose Reading",
      personal_growth: "Personal Growth & Healing Reading",
      timing: "Current Transits & Timing Reading",
      general: "Complete Profile Reading"
    };
    return titles[plan.categories[0]] || "Your Astrological Reading";
  }
  return "Focused Astrological Reading";
}
function getReadingSubtitle(plan) {
  const factorCount = plan.chartFactors.length;
  const methodCount = plan.methodologies.length;
  return `Examining ${factorCount} chart factors using ${methodCount} interpretive methods`;
}
function capitalize7(str) {
  if (!str) return "";
  return str.charAt(0).toUpperCase() + str.slice(1);
}
var SessionContext = class _SessionContext {
  constructor() {
    this.sessionId = this.generateId();
    this.clientInfo = {};
    this.chartReading = null;
    this.queries = [];
    this.discoveryResponses = {};
    this.createdAt = /* @__PURE__ */ new Date();
    this.lastAccessed = /* @__PURE__ */ new Date();
  }
  generateId() {
    return "session_" + Date.now() + "_" + Math.random().toString(36).substr(2, 9);
  }
  setClientInfo(info) {
    this.clientInfo = info;
    this.lastAccessed = /* @__PURE__ */ new Date();
  }
  setChartReading(reading) {
    this.chartReading = reading;
    this.lastAccessed = /* @__PURE__ */ new Date();
  }
  addQuery(question, response) {
    this.queries.push({
      question,
      response,
      timestamp: /* @__PURE__ */ new Date()
    });
    this.lastAccessed = /* @__PURE__ */ new Date();
  }
  setDiscoveryResponses(responses) {
    this.discoveryResponses = responses;
    this.lastAccessed = /* @__PURE__ */ new Date();
  }
  save() {
    try {
      const data = {
        sessionId: this.sessionId,
        clientInfo: this.clientInfo,
        queries: this.queries,
        discoveryResponses: this.discoveryResponses,
        createdAt: this.createdAt.toISOString(),
        lastAccessed: this.lastAccessed.toISOString()
      };
      localStorage.setItem(`astro_session_${this.sessionId}`, JSON.stringify(data));
      localStorage.setItem("astro_last_session", this.sessionId);
    } catch (e) {
      console.warn("Could not save session:", e);
    }
  }
  static loadLast() {
    try {
      const lastId = localStorage.getItem("astro_last_session");
      if (!lastId) return null;
      const data = localStorage.getItem(`astro_session_${lastId}`);
      if (!data) return null;
      const parsed = JSON.parse(data);
      const session = new _SessionContext();
      Object.assign(session, parsed);
      session.createdAt = new Date(parsed.createdAt);
      session.lastAccessed = new Date(parsed.lastAccessed);
      return session;
    } catch (e) {
      return null;
    }
  }
};

// src/engine/deep-report.js
function cap(s) {
  return s ? s.charAt(0).toUpperCase() + s.slice(1) : "";
}
function deg(d) {
  return d != null ? d.toFixed(1) + String.fromCharCode(176) : "?" + String.fromCharCode(176);
}
var ALCHEMIST_ORBS = {
  mars: 4,
  moon: 3,
  chiron: 1.5,
  // The "Low Orb" rule
  default: 2
};
function getFusionStatus(pName, pData) {
  if (!pData || pData.degreeInSign === void 0) return null;
  const orb = ALCHEMIST_ORBS[pName] || ALCHEMIST_ORBS.default;
  const deg2 = pData.degreeInSign;
  if (deg2 >= 28.5) return "FUSION";
  if (deg2 + orb >= 30) return "REACHING";
  return null;
}
function getReverseVantage(aspect, chart) {
  const p1 = aspect.planetOne;
  const p2 = aspect.planetTwo;
  if (!p1 || !p2) return null;
  const p1Name = p1.name.toLowerCase();
  const p2Name = p2.name.toLowerCase();
  const receivers = {
    moon: `Your **Moon** (Receiver) is catching this energy from ${cap(p1Name)}. This means your emotional security is founded upon how you process this ${cap(p1Name)} influence. It isn't just about the wound or the action; it's about whether your inner child FEELS safe with it. Alignment is required\u2014you have to "put the glove up" to catch this ball.`,
    chiron: `Your **Chiron** is the one receiving this. This energy is pushing directly into your wound. You might feel attacked or exposed, but the Reverse Vantage shows that this is an invitation to use YOUR wound as a bridge for this energy.`,
    ascendant: `Your **Ascendant** is the receiver. My motors and motivations didn't ask for this ${cap(p1Name)} energy, but here it is. I have to reposition my "vehicle" to say: "Okay, you want to be here too? What are you offering me?"`,
    sun: `Your **Sun** is receiving this. It becomes a matter of identity. Does this ${cap(p1Name)} energy help you shine, or does it feel like a forced obligation?`,
    saturn: `Your **Saturn** is the receiver. Responsibility is being demanded. Your Saturn expects this ${cap(p1Name)} energy to be part of the work. Build it right or don't build it at all.`
  };
  if (p1Name === "chiron" && p2Name === "moon") {
    return `Coming from **Reverse Vantage**, we look at your **Moon** first. Your emotional security is currently tied to a wound (${cap(p1Name)}). But instead of just saying "I'm wounded," your Moon is asking: "Did I even want this message? Am I prepared to receive it?" You need to assess your internal structure and mother-dynamics to see why you're and only reading the wound as emotional rebellion. True security comes when you stop asserting the moon on the wound and start understanding what the wound actually needs.`;
  }
  return receivers[p2Name] || `From the perspective of your **${cap(p2Name)}**, this ${cap(p1Name)} influence is something that must be integrated into your ${PLANET_REAL_TALK[p2Name]?.focus || "energy"}. It is about how you *receive* the message, not just who sent it.`;
}
var SIGN_STYLE = {
  aries: "bold, direct, and action-first",
  taurus: "grounded, steady, and sensual",
  gemini: "curious, quick, and adaptable",
  cancer: "nurturing, protective, and emotionally driven",
  leo: "confident, warm, and expressive",
  virgo: "analytical, precise, and detail-oriented",
  libra: "diplomatic, charming, and balance-seeking",
  scorpio: "intense, magnetic, and deeply perceptive",
  sagittarius: "adventurous, philosophical, and freedom-loving",
  capricorn: "ambitious, disciplined, and strategic",
  aquarius: "innovative, independent, and future-focused",
  pisces: "intuitive, compassionate, and imaginative"
};
var PLANET_REAL_TALK = {
  sun: { focus: "your identity, your vitality, your right to exist", why: "It shows where you MUST take risks to feel alive. Without honoring your Sun, you feel hollow.", icon: String.fromCodePoint(9737) },
  moon: { focus: "your emotional needs, your safety, your gut reactions", why: "This is what you need to feel SAFE. When your Moon is not fed, anxiety and fear take over.", icon: String.fromCodePoint(9789) },
  mercury: { focus: "how you think, process information, and communicate", why: "This is your mental wiring. It determines how you learn, speak, and make decisions.", icon: String.fromCodePoint(9791) },
  venus: { focus: "what you value, how you love, and your self-worth", why: "Venus is not just romance. It is VALUE. What you find worthy of your time, energy, and heart.", icon: String.fromCodePoint(9792) },
  mars: { focus: "how you take action, your physical drive, and your force", why: "Mars is your engine. It is how you connect to the external world through action and assertion.", icon: String.fromCodePoint(9794) },
  jupiter: { focus: "where you expand, grow, and what gets amplified", why: "Jupiter amplifies whatever it touches, good OR bad. Debt, ego, luck, wisdom: it makes it BIGGER.", icon: String.fromCodePoint(9795) },
  saturn: { focus: "your life lessons, restrictions, and long-term goals", why: "Saturn is the test. It shows where life demands discipline, boundaries, and patience before rewarding you.", icon: String.fromCodePoint(9796) },
  uranus: { focus: "where you experience sudden change and awakening", why: 'Uranus is too fast to allow luck to "sit." It signifies quickness regarding luck. It breaks what Saturn built, but only what is outdated.', icon: String.fromCodePoint(9797) },
  neptune: { focus: "where reality gets foggy, spiritual, or confusing", why: `Neptune dissolves boundaries. It relates to the "illusion of health"\u2014thinking things are a certain way when they aren't. Trust your gut.`, icon: String.fromCodePoint(9798) },
  pluto: { focus: "where you experience deep transformation and power dynamics", why: "Pluto is the phoenix. It is about evolution and potential death of the old self. Whatever it touches must be reborn.", icon: String.fromCodePoint(9799) },
  chiron: { focus: "your authentic wound and your hidden authority", why: 'Chiron represents where you feel "broken" or "not normal." Once you stop trying to fix the wound and start accepting it, you discover that this is where your greatest mentorship power lives. It is the key to your unique authority.', icon: String.fromCodePoint(9911) },
  meanLilith: { focus: "your raw, primal power and deep visceral instincts", why: "Lilith is the energy society shamed. In Alchemistic Astrology, we don't hide her\u2014we alchemize her. This is your raw power that must be accepted without guilt or remorse.", icon: String.fromCodePoint(9912) },
  vesta: { focus: "your internal spark of life and original devotion", why: 'Vesta is the "Spark of Life." It is the eternal flame that keeps you going when everything else fails. It is what you are truly devoted to.', icon: "\u{1F56F}\uFE0F" }
};
var HOUSE_REAL_TALK = {
  1: "your identity, how people see you, your physical body",
  2: "your money, your resources, your self-worth",
  3: "your mind, communication, siblings, local environment",
  4: "your home, family, roots, emotional foundation",
  5: "your creativity, romance, children, fun",
  6: "your daily work, health, routines, service",
  7: "your partnerships, marriage, close one-on-one relationships",
  8: "shared resources, intimacy, transformation, other people's stuff",
  9: "beliefs, philosophy, higher learning, travel, expansion",
  10: "your career, public reputation, legacy, authority",
  11: "your friends, community, hopes, dreams, networks",
  12: "your subconscious, hidden enemies, spirituality, isolation"
};
var TRANSIT_DESCRIPTIONS = {
  Pluto: {
    conjunction: (natal) => `Pluto is currently sitting on your natal ${cap(natal)}. This is a moment of deep, forced authenticity. The demolition of the old self is not meant to harm you, but to remove the survival structures that are no longer serving your true nature. We must ask: What are you so afraid of losing that Pluto must break it for you?`,
    opposition: (natal) => `Pluto is in opposition to your natal ${cap(natal)}. This is the "tug of war" between your past adaptations and your present need for evolution. Power struggles with others are merely mirrors for the internal struggle to own your authentic power. The stress you feel is the resistance of the old self to the new reality.`,
    square: (natal) => `Pluto is squaring your natal ${cap(natal)}, creating internal pressure that often manifests as visceral stress. This is not arbitrary friction; it is the friction required for a total psychic reorganization. You are being pushed to find the power that lives beneath your defenses.`,
    trine: (natal) => `Pluto is in a trine to your natal ${cap(natal)}. Transformation is flowing through you with less resistance. This is a time to look gently at your patterns and allow the parts of you that have reached their expiration date to fall away without the need for a crisis.`
  },
  Neptune: {
    conjunction: (natal) => `Neptune is currently dissolving the boundaries of your ${cap(natal)}. This fog is not a defect; it is a temporary invitation to stop navigating through your defenses and start navigating through your soul. Where are you still clinging to a rigid reality that Neptune is trying to spiritualize for you?`,
    opposition: (natal) => `Neptune is opposing your natal ${cap(natal)}, creating a mirror of idealization or illusion. You may be seeking an external savior or a utopian escape because the internal reality feels too heavy. The question is: What pain are you trying to bypass with this fog?`,
    square: (natal) => `Neptune is squaring your natal ${cap(natal)}, creating a period of spiritual confusion. The "ground" of your ${cap(natal).toLowerCase()} energy feels slippery. This confusion is a prerequisite for a deeper clarity that comes not from the mind, but from a profound state of being.`,
    trine: (natal) => `Neptune is flowing into your natal ${cap(natal)}. Intuition and compassion are your primary navigators right now. It is a time for gentle integration\u2014allowing the spiritual and the material to coexist without the usual friction.`
  },
  Uranus: {
    conjunction: (natal) => `Uranus is electrifying your natal ${cap(natal)}. Abrupt shifts are expected. Remember: the chaos you feel is the breakable part of your life proving that it can no longer contain your authentic self. Uranus only shatters the structures that were already suffocating you.`,
    opposition: (natal) => `Uranus is opposing your natal ${cap(natal)}. You may experience unpredictability from others. This is a mirror for your own internal restlessness. Can you be the stable center while the world around your ${cap(natal).toLowerCase()} energy shifts?`,
    square: (natal) => `Uranus is squaring your natal ${cap(natal)}, a transit of profound restlessness. This is the authentic self screaming to be heard. Do not make impulsive escapes; instead, make intentional space for your own uniqueness.`,
    trine: (natal) => `Uranus is trining your natal ${cap(natal)}. Fresh perspectives and positive innovations are available. This is the energy of "quick luck"\u2014a sudden opening that rewards your willingness to be different.`
  },
  Saturn: {
    conjunction: (natal) => `Saturn is currently sitting on your natal ${cap(natal)}. This is the "final exam" of your current developmental stage. It asks: Have you built a container strong enough to hold your true potential? If you have been avoiding responsibility, you will feel restriction. If you have been doing the work, you will feel stability.`,
    opposition: (natal) => `Saturn is opposing your natal ${cap(natal)}. The world is holding up a mirror to your boundaries and your maturity. Frustration here is merely the signal that your internal structure needs to be reinforced. It is a time for absolute honesty with yourself.`,
    square: (natal) => `Saturn is squaring your natal ${cap(natal)}, creating the pressure of a "reality check." The friction is not there to block you, but to ensure that what you are building is structurally sound. Effort is required, but the reward is a foundation that can never be shaken.`,
    trine: (natal) => `Saturn is trining your natal ${cap(natal)}. You are naturally establishing the systems and boundaries that will serve you for years to can. Discipline feels less like a burden and more like a relief.`
  },
  Jupiter: {
    conjunction: (natal) => `Jupiter is amplifying your natal ${cap(natal)}. It expands whatever it touches. If you have been living in avoidance, that avoidance will grow. If you have been living in truth, that truth will prosper. It is an amplifier of your current state, inviting you to see what is truly there.`,
    opposition: (natal) => `Jupiter is opposing your natal ${cap(natal)}. You may be looking for external validation or excess to fill an internal void. The expansion you seek is outside of you; the amplification you need is within.`,
    square: (natal) => `Jupiter is squaring your natal ${cap(natal)}. This is a growth push that feels uncomfortable. You are being asked to expand your capacity for ${cap(natal).toLowerCase()} energy beyond your current comfort zone. The friction is the stretch marks of the soul.`,
    trine: (natal) => `Jupiter is trining your natal ${cap(natal)}. Support and expansiveness come naturally now. Doors open, and your internal truth feels more easily shared with the world. Take the leap while the energy is buoyant.`
  },
  Chiron: {
    trine: (natal) => `Chiron is gently supporting your natal ${cap(natal)} through a trine. Healing happens naturally and without force. Your ${cap(natal).toLowerCase()} energy is integrating past wounds in a way that feels organic. You may find that things that used to trigger you barely register anymore. This is quiet, powerful healing.`
  }
};
function generateOpeningMessage(name, gender, chart) {
  const rising = cap(chart.angles.ascendant.sign);
  const sun = cap(chart.planets.sun.sign);
  const moon2 = cap(chart.planets.moon.sign);
  let text = `Dear ${name},

The question we are really asking here is not just "Who am I?" but "How did I adapt to survive?" and "What is my authentic self trying to tell me through this pain?"

Your chart is a map of your energetic blueprint. You are a ${sun} Sun, ${moon2} Moon, and ${rising} Rising. This combination is a sacred architecture. My goal in this report is to help you see these placements not as static "traits," but as adaptations and potentials.

We have organized your report into the following Alchemical Sections:

`;
  text += `**Section 1: The Delegate Hierarchy - ** We start with your Chain of Command. If you don't have the order, you don't have astrology. 

`;
  text += `**Section 2: The Individual Placements - ** We look at each planet as a survival adaptation. These are the parts of your personality that "learned" how to be you to stay safe.

`;
  text += `**Section 3: The Inner Conversations - ** How your adaptations speak to each other (Aspects).

`;
  text += `**Section 4: The Current Sky - ** What the universe is pressing into you right now (Transits).

`;
  if (gender === "female") {
    text += `We will look into the shadow\u2014the places where you may have suppressed your truth to maintain safety or attachment\u2014and we will explore how that internal friction is actually the engine of your evolution. This is an invitation to move from adaptation back into authenticity.

Let us begin this compassionate inquiry together.`;
  } else {
    text += `This report is an exploration of that infrastructure. We aren't going to stay on the surface. We are going to ask: "What stress are you carrying in your body that actually belongs to these energetic blocks?" and "Where is your authenticity screaming to be heard?"

Let's move into the inquiry.`;
  }
  return text;
}
function writePlanetSection(planetName, planetData, chart, interpretations) {
  const info = PLANET_REAL_TALK[planetName];
  const mean = PLANET_MEANINGS[planetName];
  if (!info) return null;
  const sign = planetData.sign;
  const house = planetData.house;
  const signInfo = SIGN_MEANINGS[sign] || {};
  const houseInfo = HOUSE_THEMES[house] || { name: "this life area" };
  const houseArea = houseInfo.name;
  const ruler = SIGN_RULERS[sign];
  const rulerData = chart.planets[ruler];
  const rulerHouse = rulerData?.house;
  const isRetro = planetData.motionState === "retrograde";
  const rxInfo = isRetro ? RETROGRADE_MEANINGS[planetName] : null;
  const spark = Math.floor(planetData.degreeInSign);
  const tone = cap(sign);
  const field = `${house}${ordSuffix(house)} house`;
  let text = `**${info.icon} Your ${cap(planetName)}** in ${tone} ${SIGN_SYMBOLS[sign] || ""}, House ${house} (${deg(planetData.degreeInSign)})`;
  if (isRetro) text += ` Rx RETROGRADE`;
  text += `

`;
  text += `**The Inquiry:** We are looking at your **Pulse**\u2014the core energy of ${cap(planetName)}. It manifests within the **Field** of your ${field} (**${houseArea}**). This is not just a placement; it is the site of a developmental adaptation. 

`;
  text += `**Deep Insight:** ${mean?.beginnerExplanation || info.why}

`;
  text += `**The Adaptation (Tone):** Because this energy is in ${tone}, ${signInfo.adaptation || ""}

`;
  if (planetName === "chiron") {
    text += `**Teacher Voice (Rule R017/Rule of Authority):** "Chiron is the Rainbow Bridge between your structure (Saturn) and your rebellion (Uranus). It is where you feel 'broken,' but that break is actually an opening for authority. If Juno is also retrograde, do not try to commit to the wound\u2014accept the instability."

`;
    text += `Because your Chiron is in the **${field}**, the friction manifests regarding **${houseArea}**. ${CHIRON_HOUSE_INSIGHTS[house] || ""}

`;
    text += `**The Alchemical Shift:** Stop trying to fix what you believe is broken. Accept the wound, and you transition from 'victim' to 'authority'\u2014mentoring others who walk this same jagged path.

`;
  } else if (planetName === "venus") {
    text += `**Alchemistic Insight (Rule R021):** Venus rules Value, both Self-Worth (2nd) and Relational (7th). She also relates to hormones and legal matters. Because she is in ${tone}, her value is "tinted" by this sign's frequency. If this is Aries, you may feel an urgent need to prove your worth (Color Theory Tainting).

`;
  } else if (planetName === "pluto" && house === 2) {
    text += `**Rule R018/R019 (Money through Trauma):** With Pluto in your 2nd House, your sense of resources is tied to Scorpio's location. This means your value or money often comes from other people's trauma or deep investigations rather than standard hourly work.

`;
  } else if (planetName === "meanLilith") {
    text += `**Teacher Voice:** "Mean Lilith is the 'Mean Bully'\u2014the internalized shame we use to repress our own truth (Rule R012). It feels like a recurring theme of rebellion that was never allowed to breathe."

`;
    if (house === 6) {
      text += `**Rule R026 (The Workloop Paradox):** In your 6th house, this creates a feeling of needing to work constantly without a clear reason. You must lower your expectations to avoid overthinking.

`;
    } else {
      text += `Because this is in your **${field}**, ${LILITH_HOUSE_INSIGHTS[house] || ""}

`;
    }
    text += `**The Work:** Move toward a "Shame-Free Zone." Acknowledge where you have been bullying yourself for your primal needs. You aren't wrong; you were just trying to survive.

`;
  } else if (planetName === "trueLilith") {
    text += `**Teacher Voice:** "This is the precise point of your rebellion\u2014the jagged, oscillating path of your raw truth. The winning strategy is the **Leash Rule**: you must let her out of the cage, but do not let her off the leash (Rule R011)."

`;
    text += `This ${field} placement represents an outward projection of freedom. If you don't ground this energy, it becomes "extremely dangerous" and leads to total isolation. Ground yourself in your authentic presence, not just the act of rebellion.

`;
  } else if (planetName === "mercury") {
    text += `**Identity Note:** Mercury is your ID and your Identity. It rules the inward mind (Gemini) and the practical routine (Virgo). Because it is in ${tone}, your processing style is uniquely suited for ${signInfo.adaptation || "this field"}.

`;
  } else if (planetName === "moon" && house === 8) {
    text += `**Rule R011 (Moon in 8th Warning):** This is a sensitive placement. The Moon in the 8th is often "not desired" because the intensity of hidden or secret emotions can feel overwhelming. You process emotional security through depth, which can feel like a constant state of transition.

`;
  } else if (planetName === "pluto" && house === 2) {
    text += `**Rule R018/R019 (Money through Trauma):** With Pluto in your 2nd House, your sense of resources is tied to Scorpio's location. This means your value or money often comes from other people's trauma or deep investigations rather than standard hourly work.

`;
  }
  if (rulerHouse && ruler !== planetName) {
    text += `**The Delegate Connection (PHSR):** The 'Boss' of your ${tone} energy is **${cap(ruler)}**, located in House ${rulerHouse}. This means your success in ${houseArea} is actually linked to how you handle your **${HOUSE_THEMES[rulerHouse]?.name || "that other area"}**. When you fix the internal delegate, the primary house stabilizes.

`;
  }
  if (isRetro && rxInfo) {
    text += `**Rx Retrograde (${rxInfo.theme}):** ${rxInfo.description}
`;
    text += `*The Gift:* ${rxInfo.gift}
`;
    text += `*The Challenge:* ${rxInfo.challenge}

`;
  }
  return { title: `${info.icon} ${cap(planetName)} in ${tone}, House ${house}`, content: text, icon: info.icon };
}
function writeAspectSection(aspects) {
  if (!aspects || aspects.length === 0) return null;
  let text = `The aspects in your chart are the internal conversations between your different survival adaptations. Some are harmonious, flowing without resistance, while others create the friction necessary for evolution. We must ask: How do these two parts of you either support or sabotage each other? Tension is not a defect; it is energy that has not yet been alchemized into authenticity.

`;
  const sorted = [...aspects].sort((a, b) => {
    const aForced = a.forcedStatus && a.forcedStatus !== "mutual" && a.forcedStatus !== "weak" ? 1 : 0;
    const bForced = b.forcedStatus && b.forcedStatus !== "mutual" && b.forcedStatus !== "weak" ? 1 : 0;
    if (bForced !== aForced) return bForced - aForced;
    const typeOrder = { conjunction: 0, square: 1, opposition: 2, trine: 3, sextile: 4 };
    return (typeOrder[a.type] || 5) - (typeOrder[b.type] || 5);
  }).slice(0, 10);
  for (const asp of sorted) {
    const p1 = cap(asp.planetOne?.name || "");
    const p2 = cap(asp.planetTwo?.name || "");
    const isForced = asp.forcedStatus && asp.forcedStatus !== "mutual" && asp.forcedStatus !== "weak";
    text += `**${p1} ${asp.symbol || "."} ${p2} (${cap(asp.type)})**`;
    if (isForced) text += ` WARNING: FORCED`;
    text += `
`;
    if (asp.type === "conjunction") {
      text += `These two energies are MERGED. They act as one. ${p1} and ${p2} cannot be separated in your experience. When one activates, the other fires too.
`;
    } else if (asp.type === "square") {
      text += `This is TENSION. ${p1} and ${p2} are in conflict, creating friction. But here is the thing: this friction is what drives you forward. Do not try to "fix" it. Use it as fuel.
`;
    } else if (asp.type === "opposition") {
      text += `These two are pulling in opposite directions. ${p1} wants one thing, ${p2} wants the opposite. The lesson is BALANCE, not choosing one over the other.
`;
    } else if (asp.type === "trine") {
      text += `This is natural flow. ${p1} and ${p2} support each other effortlessly. But caution: trines have NO DEFENSE. If either planet carries toxic energy, the other absorbs it without a filter.
`;
    } else if (asp.type === "sextile") {
      text += `This is an opportunity aspect. ${p1} and ${p2} can work together beautifully, but you have to actively USE it. It will not activate on its own.
`;
    } else if (asp.type === "quintile") {
      text += `This is a **Creative Powerhouse**. You are creatively innovative here and can purposefully manifest things. It is about unique, purposeful manifestation.
`;
    } else if (asp.type === "biQuintile") {
      text += `This is an **Internal Talent**. You have access to deep creative and artistic solutions here. It is an internal gift for problem-solving.
`;
    } else if (asp.type === "quincunx") {
      text += `This is the **Queen Kunk**. These two planets are in a constant "toggle." They do not see each other and speak different languages. You must intentionally bridge them.
`;
    }
    if (asp.perception) text += `*What you feel:* ${asp.perception}
`;
    if (asp.resolution) text += `*How to use it:* ${asp.resolution}
`;
    if (isForced) {
      const receiver = asp.forcedStatus === "forced_by_1" ? p2 : p1;
      text += `WARNING: This is a **Forced Aspect**. ${receiver} does not naturally "see" this energy coming. It feels like a blind-side hit. ${receiver} needs to be upgraded to handle this incoming energy.
`;
    }
    text += `
`;
  }
  return { title: "Your Key Aspects: The Inner Conversations", content: text, icon: String.fromCodePoint(9889) };
}
function writeDelegateHierarchy(chart) {
  let text = `**Rule R016: "If you don't have the Order, you don't have Astrology."**

`;
  text += `In this section, we reveal your chart's **Chain of Command**. Astrology is not a collection of static placements; it is a system of **Delegation**. When a house (a field of life) has a specific sign on its cusp, it delegates its "intentions" to the planet that rules that sign. 

`;
  text += `We follow the energy from the **Field** (the House) to the **Delegate** (the Ruler) to see where your life matters are actually being processed. This is the **PHSR Sequence**: Planet \u2192 House \u2192 Sign \u2192 Ruler.

`;
  const keyHouses = [1, 2, 4, 7, 10];
  const signs = ["aries", "taurus", "gemini", "cancer", "leo", "virgo", "libra", "scorpio", "sagittarius", "capricorn", "aquarius", "pisces"];
  for (const hNum of keyHouses) {
    const hData = chart.houses[hNum];
    const hSign = hData.sign;
    const hRuler = SIGN_RULERS[hSign];
    const rData = chart.planets[hRuler];
    const rHouse = rData?.house;
    const houseArea = HOUSE_REAL_TALK[hNum];
    text += `### \u{1F3DB}\uFE0F The ${hNum}${ordSuffix(hNum)} House Authority (${cap(houseArea)})
`;
    text += `**Intent (Sign):** ${cap(hSign)} energy sets the tone.
`;
    text += `**The Delegate:** **${cap(hRuler)}** is the representative of this house.
`;
    text += `**Current Location:** House ${rHouse} (${HOUSE_REAL_TALK[rHouse] || "that field"}).
`;
    text += `**Command Logic:** Your ${houseArea} energy is **DELEGATED** to your ${HOUSE_REAL_TALK[rHouse] || "other area"}. This means that for your ${houseArea} to function properly, the conditions in House ${rHouse} must be addressed first. (Rule R002/R028).

`;
    if (rData && rData.motionState === "retrograde") {
      text += `> **Warning (Rule R009):** Your delegate is in Retrograde. The "status" of the delegate is internalized. It does not change its ruler status (The Rulership Firewall), but it means these matters are processed in private or through re-evaluation before the world sees the result.

`;
    }
  }
  text += `**Formula F006:** The House Ruler (Delegate) always takes precedence for the local environment, while the Natural Ruler provides the flavor. If you find conflict between your 2nd house (Money) and 7th house (Partnerships), look for the delegate connection\u2014they are likely speaking different languages.
`;
  return { title: "Section 1: The Delegate Hierarchy", content: text, icon: "\u{1F4DC}" };
}
function writeTransitSection(chart, currentDate) {
  let text = `Here is what is happening in the sky RIGHT NOW and how it is hitting YOUR chart specifically. This is not general astrology. These are the exact transits affecting your personal placements.

`;
  const now = currentDate || /* @__PURE__ */ new Date();
  const transits = [
    { planet: "Pluto", sign: "aquarius", degree: 3, icon: String.fromCodePoint(9799), speed: "Very Slow (20yr cycle)" },
    { planet: "Neptune", sign: "aries", degree: 0, icon: String.fromCodePoint(9798), speed: "Slow (14yr cycle)" },
    { planet: "Uranus", sign: "taurus", degree: 27, icon: String.fromCodePoint(9797), speed: "Slow (7yr cycle)" },
    { planet: "Saturn", sign: "pisces", degree: 28, icon: String.fromCodePoint(9796), speed: "Medium (2.5yr cycle)" },
    { planet: "Jupiter", sign: "cancer", degree: 17, icon: String.fromCodePoint(9795), speed: "Medium (1yr per sign)" },
    { planet: "Chiron", sign: "taurus", degree: 5, icon: String.fromCodePoint(9911), speed: "Slow (varies)" }
  ];
  const signs = ["aries", "taurus", "gemini", "cancer", "leo", "virgo", "libra", "scorpio", "sagittarius", "capricorn", "aquarius", "pisces"];
  const ascSign = chart.angles.ascendant.sign;
  const ascIdx = signs.indexOf(ascSign);
  text += `**Your Rising Sign is ${cap(ascSign)}, so here is how the current sky maps onto YOUR houses:**

`;
  for (const t of transits) {
    const tIdx = signs.indexOf(t.sign);
    const transitHouse = (tIdx - ascIdx + 12) % 12 + 1;
    const houseArea = HOUSE_REAL_TALK[transitHouse] || "this area";
    text += `**${t.icon} Transit ${t.planet} in ${cap(t.sign)} ${deg(t.degree)}** is in Your House ${transitHouse} (${houseArea})
`;
    text += `*Speed: ${t.speed}*
`;
    const natalHits = [];
    for (const [pName, pData] of Object.entries(chart.planets)) {
      if (!pData || !pData.longitude) continue;
      const tLong = tIdx * 30 + t.degree;
      const diff = Math.abs((tLong - pData.longitude + 180) % 360 - 180);
      let aspectType = null;
      if (diff <= 6) aspectType = "conjunction";
      else if (Math.abs(diff - 180) <= 6) aspectType = "opposition";
      else if (Math.abs(diff - 90) <= 5) aspectType = "square";
      else if (Math.abs(diff - 120) <= 5) aspectType = "trine";
      if (aspectType) {
        natalHits.push({ planet: pName, type: aspectType, orb: diff <= 6 ? diff : Math.abs(diff - (aspectType === "opposition" ? 180 : aspectType === "square" ? 90 : 120)) });
      }
    }
    if (natalHits.length > 0) {
      for (const hit of natalHits) {
        const orbStr = hit.orb.toFixed(1);
        text += `   > **${cap(hit.type)} your natal ${cap(hit.planet)}** (orb: ${orbStr}${String.fromCharCode(176)})
`;
        const descSet = TRANSIT_DESCRIPTIONS[t.planet];
        if (descSet && descSet[hit.type]) {
          text += `   ${descSet[hit.type](hit.planet)}
`;
        } else {
          text += `   This transit is activating your ${cap(hit.planet).toLowerCase()} energy through a ${hit.type}.
`;
        }
      }
    } else {
      text += `   No direct hits to natal planets right now, but the house theme (${houseArea}) is still activated.
`;
    }
    text += `
`;
  }
  const saturnNatal = chart.planets.saturn;
  if (saturnNatal) {
    const satTransitSign = "pisces";
    const satTransitDeg = 28;
    const satNatalLong = saturnNatal.longitude;
    const satTransitLong = signs.indexOf(satTransitSign) * 30 + satTransitDeg;
    const satDiff = Math.abs((satTransitLong - satNatalLong + 180) % 360 - 180);
    if (satDiff <= 10) {
      text += `
SATURN RETURN ALERT
`;
      text += `Transit Saturn is within ${satDiff.toFixed(1)}${String.fromCharCode(176)} of your natal Saturn. `;
      if (satDiff <= 3) {
        text += `This is EXACT or nearly exact. You are IN your Saturn Return right now. `;
      } else {
        text += `Your Saturn Return is either approaching or just passed. `;
      }
      text += `The Saturn Return (age 28 to 30) is a major life exam. Saturn comes back to where it was when you were born and tests you: "Did you learn the lesson?" For you, the lesson is in House ${saturnNatal.house} (${HOUSE_REAL_TALK[saturnNatal.house] || "this area"}). Set FIRM boundaries, get serious about what you will and will not tolerate, and Saturn will reward you with stability and respect. But you have to pass the test first.

`;
    }
  }
  text += `**Bottom line:** Transits are not predictions. They are weather. You cannot control the weather, but you can decide how to dress for it. The planets create pressure; YOU decide how to respond.
`;
  return { title: "Current Transits: What Is Happening Right Now", content: text, icon: String.fromCodePoint(127756) };
}
function ordSuffix(n) {
  const s = ["th", "st", "nd", "rd"];
  const v = n % 100;
  return s[(v - 20) % 10] || s[v] || s[0];
}
var QUESTION_ROUTING = {
  career: { keywords: ["career", "job", "work", "profession", "calling", "purpose", "business", "money", "income", "boss", "coworker", "fired", "promotion", "stuck in my career", "unemployed"], houses: [6, 10, 2], planets: ["saturn", "sun", "jupiter", "mars"], angles: ["midheaven"] },
  relationships: { keywords: ["relationship", "love", "partner", "dating", "marriage", "boyfriend", "girlfriend", "spouse", "attract", "romance", "crush", "ex", "breakup", "divorce", "single", "soulmate", "twin flame"], houses: [7, 5, 8], planets: ["venus", "mars", "moon", "chiron"], angles: ["descendant"] },
  emotions: { keywords: ["emotion", "feel", "feeling", "anxiety", "depressed", "overwhelm", "cry", "anger", "fear", "mood", "sensitive", "unstable", "attacked", "spiral"], houses: [4, 1, 12], planets: ["moon", "neptune", "pluto", "chiron"] },
  home: { keywords: ["home", "family", "parent", "mother", "father", "roommate", "move", "house", "living situation", "childhood"], houses: [4, 10], planets: ["moon", "saturn", "pluto"] },
  friends: { keywords: ["friend", "friendship", "social", "community", "betrayal", "fake friend", "lonely", "isolated", "group"], houses: [11, 3], planets: ["venus", "mercury", "neptune"] },
  health: { keywords: ["health", "body", "sick", "energy", "tired", "weight", "illness", "pain", "routine", "exercise"], houses: [6, 1], planets: ["mars", "saturn", "chiron"] },
  growth: { keywords: ["grow", "heal", "transform", "change", "stuck", "pattern", "repeat", "block", "shadow", "wound", "karma", "past life"], houses: [12, 8, 1], planets: ["chiron", "pluto", "saturn", "meanLilith"] },
  identity: { keywords: ["identity", "who am i", "purpose", "lost", "direction", "confused", "authentic", "self", "confidence", "worth"], houses: [1, 10, 5], planets: ["sun", "moon", "chiron", "meanLilith"], angles: ["ascendant"] }
};
function categorizeQuestion(question) {
  const q = question.toLowerCase();
  const matches = [];
  for (const [category, data] of Object.entries(QUESTION_ROUTING)) {
    const score = data.keywords.filter((kw) => q.includes(kw)).length;
    if (score > 0) matches.push({ category, score, ...data });
  }
  matches.sort((a, b) => b.score - a.score);
  return matches.length > 0 ? matches : [{ category: "general", houses: [1, 4, 7, 10], planets: ["sun", "moon", "saturn", "chiron"], keywords: [] }];
}
function writeQuestionAnswer(question, chart, aspects, currentDate) {
  const categories = categorizeQuestion(question);
  const primary = categories[0];
  const signs = ["aries", "taurus", "gemini", "cancer", "leo", "virgo", "libra", "scorpio", "sagittarius", "capricorn", "aquarius", "pisces"];
  const ascSign = chart.angles.ascendant.sign;
  const ascIdx = signs.indexOf(ascSign);
  let text = "";
  text += `**Your Question:** "${question}"

`;
  text += `I am not going to give you a generic answer. I pulled up your actual chart, ran the math, and I am going to show you exactly what is going on based on YOUR placements and what the planets are doing right now. Let me break this down.

`;
  const transits = getApproxTransitPositions(currentDate);
  const allPlanets = Object.entries(chart.planets).filter(([, p]) => p && p.house);
  const houseCounts = {};
  for (const [name, p] of allPlanets) {
    if (!houseCounts[p.house]) houseCounts[p.house] = [];
    houseCounts[p.house].push({ name, ...p });
  }
  for (const t of transits) {
    const tIdx = signs.indexOf(t.sign);
    const tLong = tIdx * 30 + t.degree;
    const tHouse = getHouseFromLongitude2(tLong, ascIdx);
    if (!houseCounts[tHouse]) houseCounts[tHouse] = [];
    if (["Pluto", "Neptune", "Uranus", "Saturn", "Jupiter"].includes(t.planet)) {
      houseCounts[tHouse].push({ name: "Transit " + t.planet, sign: t.sign, degree: t.degree, isTransit: true });
    }
  }
  for (const houseNum of primary.houses) {
    const occupants = houseCounts[houseNum];
    if (occupants && occupants.length >= 3) {
      const houseArea = HOUSE_REAL_TALK[houseNum] || "this area";
      text += `**MAJOR ALERT: ${occupants.length} PLANETS IN YOUR ${houseNum}${ordSuffix(houseNum)} HOUSE (${houseArea.toUpperCase()})**

`;
      text += `Right now there are **${occupants.length} planets** concentrated in your ${houseNum}${ordSuffix(houseNum)} house:
`;
      for (const occ of occupants) {
        const prefix = occ.isTransit ? "(Transit) " : "";
        text += `  ${prefix}${cap(occ.name)} in ${cap(occ.sign || "")} ${occ.degree != null ? deg(occ.degree) : ""}
`;
      }
      text += `
**What this means:** This house is getting MASSIVE energy right now. This area of your life (${houseArea}) is not quiet, it is a focal point. `;
      if (occupants.some((o) => o.name.toLowerCase().includes("mars") || o.name.toLowerCase().includes("pluto"))) {
        text += `With Mars and/or Pluto energy here, there can be power struggles, intense emotions, and situations that feel forced or high-pressure. `;
      }
      text += `The more planets here, the more this area dominates your experience.

`;
    }
  }
  text += `**YOUR NATAL CHART ON THIS TOPIC:**

`;
  for (const houseNum of primary.houses) {
    const houseSign = signs[(ascIdx + houseNum - 1) % 12];
    const ruler = SIGN_RULERS[houseSign];
    const rulerData = chart.planets[ruler];
    const planetsInHouse = Object.entries(chart.planets).filter(([, p]) => p && p.house === houseNum);
    const houseArea = HOUSE_REAL_TALK[houseNum] || "this area";
    text += `**${houseNum}${ordSuffix(houseNum)} House (${cap(houseArea)}):** ${cap(houseSign)} on the cusp.
`;
    if (ruler && rulerData) {
      text += `The ruler is **${cap(ruler)}** in ${cap(rulerData.sign)} at ${deg(rulerData.degreeInSign)} in House ${rulerData.house} (${HOUSE_REAL_TALK[rulerData.house] || "that area"}).`;
      if (rulerData.motionState === "retrograde") {
        text += ` **And it is retrograde.** `;
        if (houseNum === 10 || ruler === "saturn") {
          text += `**Important:** Since your 10th house ruler (or Saturn) is retrograde, you are not meant to have a career in the standard traditional sense. Your path involves re-working and re-visiting how you show up as an authority. `;
        }
        text += `Standard approaches in this area do not work for you. The energy is turned inward. You process this area of life internally before you act on it externally. That is not a flaw, that is your design.`;
      } else {
        text += ` So the energy of your ${houseArea} is being DIRECTED through House ${rulerData.house}. Whatever happens in your ${HOUSE_REAL_TALK[rulerData.house] || "that area"} directly feeds back into your ${houseArea}.`;
      }
      const rulerAspects = aspects.filter(
        (a) => a.planetOne?.name === ruler || a.planetTwo?.name === ruler
      ).slice(0, 3);
      if (rulerAspects.length > 0) {
        text += ` Key aspects: `;
        for (const asp of rulerAspects) {
          const other = asp.planetOne?.name === ruler ? asp.planetTwo?.name : asp.planetOne?.name;
          if (asp.type === "square") text += `${cap(ruler)} square ${cap(other)} (friction, pressure). `;
          else if (asp.type === "opposition") text += `${cap(ruler)} opposition ${cap(other)} (tug of war). `;
          else if (asp.type === "conjunction") text += `${cap(ruler)} conjunct ${cap(other)} (merged energy). `;
          else if (asp.type === "trine") text += `${cap(ruler)} trine ${cap(other)} (natural flow). `;
          else if (asp.type === "sextile") text += `${cap(ruler)} sextile ${cap(other)} (opportunity). `;
        }
      }
      text += `
`;
    }
    if (planetsInHouse.length > 0) {
      for (const [pName, pData] of planetsInHouse) {
        const info = PLANET_REAL_TALK[pName];
        const rxInfo = pData.motionState === "retrograde" ? RETROGRADE_MEANINGS[pName] : null;
        if (info) {
          text += `  ${info.icon} **${cap(pName)}** (${deg(pData.degreeInSign)} ${cap(pData.sign)}): ${info.focus}. `;
          if (rxInfo) {
            text += `**Rx:** ${rxInfo.theme}. ${rxInfo.description.split(".")[0]}. `;
          }
          if (pName === "chiron") {
            text += `This is your Rainbow Bridge. Stop trying to fix the ${houseArea} wound; accept it as your unique authority.`;
          } else if (pName === "saturn") {
            text += `This is your Container, requiring discipline around your ${houseArea}.`;
          }
          text += `
`;
        }
      }
    } else {
      text += `Remember that **empty houses are not really empty.** Your ${houseArea} is managed by the "Boss" planet (**${cap(ruler)}**), currently located in House ${rulerData?.house}. Follow the boss to understand this house.
`;
    }
    text += `
`;
  }
  text += `**THE KEY PLAYERS:**

`;
  for (const planetKey of primary.planets) {
    const pData = chart.planets[planetKey];
    if (!pData) continue;
    const info = PLANET_REAL_TALK[planetKey];
    if (!info) continue;
    text += `${info.icon} **${cap(planetKey)}** in ${cap(pData.sign)}, House ${pData.house} at ${deg(pData.degreeInSign)}`;
    if (pData.motionState === "retrograde") text += ` (RETROGRADE)`;
    text += `
`;
    text += `${info.focus}. `;
    if (planetKey === "moon") {
      text += `Your emotional safety is anchored in ${cap(pData.sign)} energy and expressed through House ${pData.house} (${HOUSE_REAL_TALK[pData.house] || ""}). When this area of life gets disrupted, your ENTIRE emotional state destabilizes. `;
    }
    if (planetKey === "venus") {
      text += `This is how you love, what you value, and what you attract. Venus in ${cap(pData.sign)} means you are attracted to ${SIGN_STYLE[pData.sign] || "a specific type of"} energy. In House ${pData.house}, your love story plays out through ${HOUSE_REAL_TALK[pData.house] || "this area"}. `;
      if (pData.house === 12) text += `Venus in the 12th is significant. Your love style is hidden, private, possibly self-sacrificing. You may attract situations where love is behind the scenes, unavailable, or complicated. `;
      if (pData.house === 8) text += `Venus in the 8th means love is not casual for you. It is deep, transformative, all-or-nothing. Surface-level relationships will never satisfy you. `;
      if (pData.house === 7) text += `Venus in the 7th is strong for partnerships. You value commitment and are designed for one-on-one connections. `;
    }
    if (planetKey === "chiron") {
      text += `Chiron is your **Authentic Wound**. It represents a lack of confidence in an area where you already HAVE authority. Most people spend their lives trying to fix this; in Alchemistic Astrology, we learn to accept it. This "weakness" in ${HOUSE_REAL_TALK[pData.house] || "this area"} is what allows you to see what others miss. `;
    }
    const planetAspects = aspects.filter(
      (a) => a.planetOne?.name === planetKey || a.planetTwo?.name === planetKey
    ).slice(0, 4);
    if (planetAspects.length > 0) {
      text += `
Key connections: `;
      for (const asp of planetAspects) {
        const other = asp.planetOne?.name === planetKey ? asp.planetTwo?.name : asp.planetOne?.name;
        if (asp.type === "square") text += `**Square ${cap(other)}** (friction, fuel). `;
        else if (asp.type === "opposition") text += `**Opposition ${cap(other)}** (tug of war, mirror). `;
        else if (asp.type === "conjunction") text += `**Conjunct ${cap(other)}** (merged, amplified). `;
        else if (asp.type === "trine") text += `**Trine ${cap(other)}** (natural support). `;
        else if (asp.type === "sextile") text += `**Sextile ${cap(other)}** (gentle assist). `;
        else if (asp.type === "quintile") text += `**Quintile ${cap(other)}** (creative manifestor). `;
        else if (asp.type === "biQuintile") text += `**Bi-Quintile ${cap(other)}** (internal talent). `;
        else if (asp.type === "quincunx") text += `**Quincunx ${cap(other)}** (Queen Kunk: toggle). `;
      }
    }
    text += `

`;
  }
  let transitHits = [];
  for (const t of transits) {
    const tIdx = signs.indexOf(t.sign);
    const tLong = tIdx * 30 + t.degree;
    for (const [planetKey, pData] of Object.entries(chart.planets)) {
      if (!pData || !pData.longitude) continue;
      const diff = Math.abs((tLong - pData.longitude + 540) % 360 - 180);
      let aspectType = null;
      let exactAngle = 0;
      if (diff <= 8) {
        aspectType = "conjunction";
        exactAngle = 0;
      } else if (Math.abs(diff - 180) <= 8) {
        aspectType = "opposition";
        exactAngle = 180;
      } else if (Math.abs(diff - 90) <= 6) {
        aspectType = "square";
        exactAngle = 90;
      } else if (Math.abs(diff - 120) <= 6) {
        aspectType = "trine";
        exactAngle = 120;
      }
      if (aspectType) {
        const orb = aspectType === "conjunction" ? diff : Math.abs(diff - exactAngle);
        const isRelevant = primary.planets.includes(planetKey);
        transitHits.push({
          transit: t.planet,
          transitSign: t.sign,
          transitDegree: t.degree,
          natal: planetKey,
          natalSign: pData.sign,
          natalDegree: pData.degreeInSign,
          natalHouse: pData.house,
          type: aspectType,
          orb,
          isRelevant
        });
      }
    }
  }
  transitHits.sort((a, b) => {
    if (a.isRelevant !== b.isRelevant) return a.isRelevant ? -1 : 1;
    return a.orb - b.orb;
  });
  const seen = /* @__PURE__ */ new Set();
  transitHits = transitHits.filter((h) => {
    const key = h.transit + "-" + h.natal + "-" + h.type;
    if (seen.has(key)) return false;
    seen.add(key);
    return true;
  });
  if (transitHits.length > 0) {
    text += `**WHAT IS HAPPENING RIGHT NOW (Current Transits):**

`;
    const critical = transitHits.filter((h) => h.orb <= 5 && ["Pluto", "Neptune", "Uranus", "Saturn", "Chiron"].includes(h.transit));
    const supporting = transitHits.filter((h) => !critical.includes(h)).slice(0, 5);
    if (critical.length > 0) {
      text += `**CRITICAL TRANSITS (Tight Orbs):**

`;
      for (let i = 0; i < critical.length && i < 8; i++) {
        const hit = critical[i];
        text += `**${i + 1}. ${hit.transit.toUpperCase()} ${hit.type.toUpperCase()} NATAL ${cap(hit.natal).toUpperCase()}**
`;
        text += `   Transit ${hit.transit} in ${cap(hit.transitSign)} ${deg(hit.transitDegree)} > ${cap(hit.type)} > Natal ${cap(hit.natal)} in ${cap(hit.natalSign)} ${deg(hit.natalDegree)}
`;
        text += `   Orb: ${hit.orb.toFixed(1)}${String.fromCharCode(176)}`;
        if (hit.orb <= 2) text += ` (EXACT!)`;
        else if (hit.orb <= 4) text += ` (Very tight)`;
        text += `

`;
        const descSet = TRANSIT_DESCRIPTIONS[hit.transit];
        if (descSet && descSet[hit.type]) {
          text += `   ${descSet[hit.type](hit.natal)}

`;
        }
        if (hit.natalHouse) {
          text += `   This is hitting your House ${hit.natalHouse} (${HOUSE_REAL_TALK[hit.natalHouse] || ""}) energy. So the effects show up most in ${HOUSE_REAL_TALK[hit.natalHouse] || "that area"} of your life.

`;
        }
      }
    }
    if (supporting.length > 0) {
      text += `**Supporting Transits:**

`;
      for (const hit of supporting) {
        text += `${hit.transit} ${hit.type} your ${cap(hit.natal)} (orb: ${hit.orb.toFixed(1)}${String.fromCharCode(176)}). `;
        const descSet = TRANSIT_DESCRIPTIONS[hit.transit];
        if (descSet && descSet[hit.type]) {
          text += descSet[hit.type](hit.natal);
        }
        text += `

`;
      }
    }
  }
  const saturnNatal = chart.planets.saturn;
  if (saturnNatal) {
    for (const t of transits) {
      if (t.planet === "Saturn") {
        const tIdx = signs.indexOf(t.sign);
        const tLong = tIdx * 30 + t.degree;
        const diff = Math.abs((tLong - saturnNatal.longitude + 540) % 360 - 180);
        if (diff <= 15) {
          text += `**SATURN RETURN ALERT:**
`;
          text += `Saturn is within ${diff.toFixed(0)}${String.fromCharCode(176)} of your natal Saturn in ${cap(saturnNatal.sign)} (House ${saturnNatal.house}). `;
          if (diff <= 5) {
            text += `This is your **Saturn Return** happening RIGHT NOW. This is the most important transit of your late 20s/early 30s. Saturn is testing you: did you learn the lesson? For you, the lesson is around ${HOUSE_REAL_TALK[saturnNatal.house] || "this area"}. Every boundary you failed to set, every responsibility you avoided is being called out. But if you DO the work, Saturn rewards you with permanent stability.

`;
          } else {
            text += `Your Saturn Return is **approaching**. The pressure in ${HOUSE_REAL_TALK[saturnNatal.house] || "this area"} will intensify. Start setting boundaries NOW. Those who prepare get promoted. Those who resist get repeated.

`;
          }
        }
      }
    }
  }
  text += `**SUMMARY: WHY YOUR CHART SAYS THIS IS HAPPENING**

`;
  if (primary.category === "relationships") {
    const venus = chart.planets.venus;
    const chiron = chart.planets.chiron;
    const moon2 = chart.planets.moon;
    const h7Sign = signs[(ascIdx + 6) % 12];
    text += `**Based on your natal chart + current transits:**

`;
    text += `1. **Your Love Pattern:**
`;
    if (venus) {
      text += `   Venus in ${cap(venus.sign)} (House ${venus.house}) controls how you attract and what you value. `;
      if (venus.house === 12) text += `In the 12th house, your love life has a "hidden" quality. Love happens behind closed doors, through sacrifice, or with unavailable people. You attract karmic relationships that force you to confront your deepest patterns.`;
      else if (venus.house === 8) text += `In the 8th house, love is never surface-level for you. You need DEPTH, intensity, and total honesty. Casual does not work. This also means you attract transformative, sometimes painful, dynamics.`;
      else if (venus.house === 5) text += `In the 5th house, romance and joy are central. You want love that feels FUN. But you may confuse the excitement of the chase with real commitment.`;
      else text += `In House ${venus.house}, your love energy flows through the area of ${HOUSE_REAL_TALK[venus.house] || "life"}.`;
    }
    text += `

`;
    text += `2. **What You Attract:**
`;
    text += `   Your 7th house is ${cap(h7Sign)}. The ruler, ${cap(SIGN_RULERS[h7Sign])}, determines the CONDITIONS and TYPE of people who show up as partners. Look at where that ruler sits in your chart. Its condition (sign, house, aspects, retrograde status) tells you everything about the quality and nature of your partnerships.

`;
    if (chiron) {
      text += `3. **The Wound:**
`;
      text += `   Chiron in ${cap(chiron.sign)} (House ${chiron.house}) shows where you feel "broken." This wound keeps attracting the SAME types of situations until you heal it. When you say "everyone cheats or leaves," that is Chiron's pattern repeating. The pattern does not change until YOU change your relationship to the wound.

`;
    }
    if (moon2) {
      text += `4. **Emotional Needs:**
`;
      text += `   Your Moon in ${cap(moon2.sign)} (House ${moon2.house}) is what you NEED to feel safe. If your partners are not providing ${SIGN_STYLE[moon2.sign] || "this type of"} security, you will always feel unsettled regardless of how "good" they look on paper.

`;
    }
    text += `**Bottom Line:** The answer to "what am I doing wrong" is rarely about you being wrong. Your chart is set up in a specific way that requires specific conditions for love to work. When you try to force love to look like everyone else's, it breaks. When you honor how YOUR Venus, 7th house, and Moon are designed, the right connection finds you. Stop chasing what looks right on paper and start honoring what your chart actually NEEDS.

`;
  } else if (primary.category === "career") {
    const saturnP = chart.planets.saturn;
    const venus = chart.planets.venus;
    text += `**Based on your natal chart + current transits:**

`;
    const isMoney = /money|income|wealth|finance|salary|paid/i.test(question);
    if (isMoney) {
      text += `1. **The Money Code (The "Libra Point"):**
`;
      text += `   Most people check the 2nd House for money. That is basic. While your 2nd House (and its ruler) shows how you **make** money, the secret is your **Libra House**. Venus rules both Taurus (Money) and Libra (Balance). If your financial bucket has a hole in it, it is always the Libra House.
`;
      const libraIndex = signs.indexOf("libra");
      const libraHouse = (libraIndex - ascIdx + 12) % 12 + 1;
      text += `   Your Libra is likely in **House ${libraHouse}** (${HOUSE_REAL_TALK[libraHouse] || "this area"}). This is where you must maintain balance to KEEP what you earn. If this area is chaotic, your bank account will be too, no matter how much you hustle.

`;
      if (venus) {
        text += `2. **Your Value Driver (Venus):**
`;
        text += `   Venus in ${cap(venus.sign)} (House ${venus.house}) shows what you VALUE. Money flows when you honor this placement. If you are doing work that conflicts with your Venus sign's values, the money will dry up because the energetic alignment is off.

`;
      }
    } else {
      text += `1. **Work Zone Issues:**
`;
      text += `   Your 6th house shows daily work and the 10th house shows career path. The rulers of these houses and their conditions explain WHY things feel the way they do.

`;
    }
    if (saturnP) {
      text += `3. **Saturn's Lesson:**
`;
      text += `   Saturn in House ${saturnP.house} shows where you MUST build discipline and set boundaries. If people are walking all over you or you feel restricted, check if Saturn's lesson (boundaries, discipline) has been learned or ignored.

`;
    }
    text += `**Bottom Line:** Your career/financial path is not broken. It is being tested. ${isMoney ? "Look at your Libra house\u2014restore balance there, and the money stabilizes." : "Set boundaries. Take responsibility for what is yours. Let go of what is not."} The pressure is temporary, but your decisions under pressure are permanent.

`;
  } else if (primary.category === "identity") {
    const sun = chart.planets.sun;
    const pluto = chart.planets.pluto;
    const nn = chart.planets.northNode || chart.planets["North Node"] || chart.planets["north node"] || chart.points && (chart.points.northNode || chart.points.north_node);
    text += `**Based on your natal chart + deep manifestation mechanics:**

`;
    if (sun && pluto) {
      text += `1. **The Manifestation Engine (Sun + Pluto):**
`;
      text += `   True manifestation is not just "thinking positive." It is aligning your **Sun** (The Conscious Goal) with your **Pluto** (The Nuclear Power Source). 
`;
      text += `   Your Sun is in ${cap(sun.sign)} (House ${sun.house}). This is what you WANT.
`;
      text += `   Your Pluto is in ${cap(pluto.sign)} (House ${pluto.house}). This is your POWER.
`;
      const sunPlutoAspect = aspects.find(
        (a) => a.planetOne.name === "sun" && a.planetTwo.name === "pluto" || a.planetOne.name === "pluto" && a.planetTwo.name === "sun"
      );
      if (sunPlutoAspect) {
        if (["square", "opposition"].includes(sunPlutoAspect.type)) {
          text += `   **You have a ${cap(sunPlutoAspect.type)} between them.** This means your conscious desires and your subconscious power are fighting. You might self-sabotage right when you get close to the goal. The Secret: **Transmutation.** You need to use the friction (the fear/intensity) as FUEL. Do not try to be calm. Use the intensity to drive the action.

`;
        } else if (["trine", "sextile"].includes(sunPlutoAspect.type)) {
          text += `   **You have a ${cap(sunPlutoAspect.type)} between them.** This is a superpower. Your will and your deep power flow together naturally. Use this. When you truly decide on a goal, you can move mountains with less effort than others.

`;
        } else if (sunPlutoAspect.type === "conjunction") {
          text += `   **They are Conjunct.** You are a powerhouse. Your identity IS transformation. You do not just achieve goals, you destroy the old version of yourself to get them.

`;
        }
      } else {
        text += `   They are not forming a major aspect. This means you have to consciously bridge them. Your power source (Pluto) is separate from your ego (Sun). You must intentionally visit your Pluto house (${HOUSE_REAL_TALK[pluto.house]}) to recharge before chasing your Sun goals.

`;
      }
    }
    if (sun && moon && Math.abs(sun.longitude - moon.longitude) < 3) {
      text += `3. **Your New Moon Signature:**
`;
      text += `   You were born during a **New Moon** (Sun conjunct Moon). This is a powerful, unified signature. Your ego (Sun) and your emotional needs (Moon) are aligned. You don't have the typical internal "tug of war" between what you want and what you feel\u2014they are one and the same. This gives you a massive ability to manifest because you aren't fighting yourself.

`;
    }
    if (nn) {
      text += `4. **Your True North (The North Node):**
`;
      text += `   If you feel lost, it is because you are hanging out in your South Node (your comfort zone/past lives). Your **North Node is in ${cap(nn.sign)} (House ${nn.house})**.
`;
      text += `   **The Secret:** The North Node always feels uncomfortable at first. It feels "new" and "risky." But it is the ONLY direction that fulfills you. Stop doing what you are good at (South Node) and start doing what scares you a little (North Node).

`;
    }
    text += `**Bottom Line:** You are not lost. You are just buffering between who you were (South Node) and who you are becoming (North Node). Align your Sun's goal with Pluto's power, and move toward the thing that scares you. That is the map.

`;
  } else if (primary.category === "emotions") {
    const moonP = chart.planets.moon;
    text += `**Based on your natal chart + current transits:**

`;
    if (moonP) {
      text += `1. **Emotional Core:**
`;
      text += `   Your Moon in ${cap(moonP.sign)} (House ${moonP.house}) is what you FEEL. When that is threatened, anxiety and overwhelm take over. This is not you being "too emotional." This is your Moon being unmet.

`;
    }
    text += `2. **What Is Triggering You:**
`;
    text += `   The transits above show exactly what is shaking your foundation right now. ${transitHits.filter((h) => h.natal === "moon").length > 0 ? "Your Moon IS being hit by active transits. The instability you feel is real and has a cause." : "Even without direct Moon transits, the chart activation is creating pressure."}

`;
    text += `**Bottom Line:** Your emotions are not the enemy. They are data. Stop trying to control them and start LISTENING. What does your Moon actually need? Give it that.

`;
  } else {
    text += `Every placement connected to your question tells a specific story. The houses show WHERE, the planets show WHAT, the signs show HOW, and the transits show WHEN. You are not imagining things. The chart confirms what you are feeling.

`;
  }
  text += `**THE PROTOCOL: THE ALCHEMICAL PATH**

`;
  text += `You have to understand the sequence: **Spark (Degree) > Tone (Sign) > Field (House) > Delegate (Ruler)**. Stop looking at your placements as "static" things. They are energies in motion. 

`;
  text += `When you face a challenge in this area, use the **Reverse Vantage.** Ask: "How is my receiving planet (the planet being hit) programmed to catch this ball?" You have the power of alchemy. The planets create the pressure; you decide the manifestation. Change the internal reception, and you change the external result. 

`;
  text += `Remember: You are an extension of the Earth. The whole chart is YOU. Let's look at your Subheaven (IC) to see what roots you, and your Ascendant to see why you emerged.

`;
  text += `Teacher Voice: "Fixed the internal, and the map opens up. If you haven't dealt with the inner authority issues, no relocation or success will fix it\u2014you'll just be relocating the problems." Trust your blueprint.
`;
  return { title: "Your Question Answered", content: text, icon: String.fromCodePoint(128172) };
}
function getApproxTransitPositions(date) {
  const d = date instanceof Date ? date : /* @__PURE__ */ new Date();
  const refDate = new Date(2026, 0, 1);
  const daysSinceRef = (d - refDate) / (1e3 * 60 * 60 * 24);
  return [
    { planet: "Pluto", sign: "aquarius", degree: Math.min(29, Math.max(0, 1 + daysSinceRef * 0.01)) },
    { planet: "Neptune", sign: daysSinceRef > 80 ? "aries" : "pisces", degree: daysSinceRef > 80 ? Math.min(29, (daysSinceRef - 80) * 0.011) : Math.min(29, 29.5 + daysSinceRef * 0.011) },
    { planet: "Uranus", sign: daysSinceRef > 180 ? "gemini" : "taurus", degree: daysSinceRef > 180 ? Math.min(29, (daysSinceRef - 180) * 0.012) : Math.min(29, 27 + daysSinceRef * 0.012) },
    { planet: "Saturn", sign: daysSinceRef > 150 ? "aries" : "pisces", degree: daysSinceRef > 150 ? Math.min(29, (daysSinceRef - 150) * 0.033) : Math.min(29, 25 + daysSinceRef * 0.033) },
    { planet: "Jupiter", sign: "cancer", degree: Math.min(29, Math.max(0, 12 + daysSinceRef * 0.083)) },
    { planet: "Chiron", sign: "taurus", degree: Math.min(29, Math.max(0, 24 + daysSinceRef * 0.015)) }
  ];
}
function getHouseFromLongitude2(longitude, ascIdx) {
  const signIdx = Math.floor(longitude % 360 / 30);
  return (signIdx - ascIdx + 12) % 12 + 1;
}
function generateDeepReport(chartReading, birthData, currentDate = /* @__PURE__ */ new Date(), userQuestions = []) {
  const { chart, interpretations, aspects } = chartReading;
  const name = birthData.name || "Friend";
  const gender = birthData.gender || "female";
  const sections = [];
  sections.push({ title: "A Personal Message", content: generateOpeningMessage(name, gender, chart), icon: String.fromCodePoint(128171), isOpening: true });
  if (userQuestions && userQuestions.length > 0) {
    for (let i = 0; i < userQuestions.length; i++) {
      const qSection = writeQuestionAnswer(userQuestions[i], chart, aspects, currentDate);
      qSection.title = userQuestions.length > 1 ? `Question ${i + 1} Answered` : "Your Question Answered";
      sections.push(qSection);
    }
  }
  sections.push(writeDelegateHierarchy(chart));
  let coreText = `Before we dive into individual planets, let's look at the baseline of your energetic container:

`;
  const asc = chart.angles.ascendant;
  coreText += `**Your Rising Sign: ${cap(asc.sign)} ${SIGN_SYMBOLS[asc.sign] || ""}**
`;
  coreText += `Your Rising Sign is the most critical point in your blueprint. It is not your personality; it is the **primary response style** you developed to navigate the world. It determines the entire landscape of your life\u2014the "Field" in which every other part of you must operate. 

`;
  coreText += `With **${cap(asc.sign)}** Rising, you learned to project an energy that is ${SIGN_MEANINGS[asc.sign]?.style || "unique"}. This was your first successful adaptation for interacting with society. Whether you are aware of it or not, this is the "vehicle" you are driving through this lifetime.

`;
  if (asc.degreeInSign >= 11.5 && asc.degreeInSign <= 12.5) {
    coreText += `**Special Signature (12 Degrees):** Since your Ascendant is at 12 degrees, you have a deep, intuitive, and Neptune-influenced layer to your response style. You sense the "undercurrents" of a room before anything is even said.

`;
  }
  sections.push({ title: `Your Foundation: ${cap(asc.sign)} Rising`, content: coreText, icon: String.fromCodePoint(127963) });
  const rxPlanets = Object.keys(chart.planets).filter((p) => chart.planets[p] && chart.planets[p].motionState === "retrograde");
  if (rxPlanets.length > 0) {
    let rxText = `You have **${rxPlanets.length} planets in retrograde** in your chart: ${rxPlanets.map((p) => cap(p)).join(", ")}.

`;
    rxText += `In our work together, we see retrogrades as **Internalized Survival Protocols**. Because these energies were not mirrored or supported in your early environment, you turned them inward. You are here to master these areas for *yourself* first, often going through a period of "overcompensation" until you find your own internal authority.
`;
    sections.push({ title: "The Internal Turn: Retrograde Overview", content: rxText, icon: "\u{1F504}" });
  }
  const planetOrder = ["sun", "moon", "mercury", "venus", "mars", "jupiter", "saturn", "uranus", "neptune", "pluto", "chiron", "meanLilith"];
  for (const p of planetOrder) {
    if (!chart.planets[p]) continue;
    const section = writePlanetSection(p, chart.planets[p], chart, interpretations);
    if (section) sections.push(section);
  }
  let advancedText = `This is where we go beyond basic descriptions and look at the **Mechanics of your Integration**. These are the subtle thresholds where your adaptations blend and your wounds find surgical precision.

`;
  let hasAdvanced = false;
  let fusionHits = [];
  for (const pName of planetOrder) {
    const pData = chart.planets[pName];
    const status = getFusionStatus(pName, pData);
    if (status) {
      const nextHouse = pData.house % 12 + 1;
      if (status === "FUSION") {
        let fusionDesc = `**${cap(pName)} at ${deg(pData.degreeInSign)}:** You are in a **Threshold Area**. Your ${PLANET_REAL_TALK[pName].focus} is not just in one house; it is definitively bleeding into the next. You influence multiple areas of life through a single pulse. It's a "gradient spill-off" effect where your boundaries between life areas are naturally thin.`;
        if (Math.round(pData.degreeInSign) === 29) {
          fusionDesc += ` **Special Note:** Being at the 29th degree specifically brings in a sense of urgency. You may feel regular "teardowns" in this area as you prepare to move into a new state of being.`;
        }
        fusionHits.push(fusionDesc);
      } else {
        fusionHits.push(`**${cap(pName)} at ${deg(pData.degreeInSign)}:** Your influence is **reaching into the next field**. While your direct actions are in one house, the emotional impact is already felt in the next. You are living on the edge of a developmental shift.`);
      }
    }
  }
  if (fusionHits.length > 0) {
    hasAdvanced = true;
    advancedText += `### \u{1F9EC} Threshold Areas: Where Your Worlds Blend
`;
    advancedText += `In our work, when a planet sits at the edge of a sign, we call it a **Threshold**. You aren't just "in the room"; you are "at the door." The energy is merging. You cannot separate these two areas of your life easily.

`;
    advancedText += fusionHits.join("\n\n") + `

`;
  }
  if (aspects && aspects.length > 0) {
    hasAdvanced = true;
    advancedText += `### \u{1F504} The Receiver's Voice: Internal Dialogue
`;
    advancedText += `Most analysis tells you how your planets "fight." But we ask: how are you **receiving** the pressure? To understand an internal conflict, we must go to the part of you that is "catching the ball." 

`;
    const rvAspects = aspects.slice(0, 4);
    for (const asp of rvAspects) {
      const rvDescription = getReverseVantage(asp, chart);
      if (rvDescription) {
        advancedText += `**${cap(asp.planetOne.name)} interaction with ${cap(asp.planetTwo.name)}:** ${rvDescription}

`;
      }
    }
  }
  const signsArr = ["aries", "taurus", "gemini", "cancer", "leo", "virgo", "libra", "scorpio", "sagittarius", "capricorn", "aquarius", "pisces"];
  const ascIdx = signsArr.indexOf(chart.angles.ascendant.sign);
  const house6Sign = signsArr[(ascIdx + 5) % 12];
  const ruler6 = SIGN_RULERS[house6Sign];
  const ruler6Data = chart.planets[ruler6];
  if (ruler6Data && ruler6Data.motionState === "retrograde") {
    hasAdvanced = true;
    advancedText += `### \u2696\uFE0F The Burden Release Adaptation
`;
    advancedText += `Your **6th House Ruler (${cap(ruler6)}) is Retrograde**. You likely adapted to stress by taking on more and more responsibility, hoping it would make you safe. **The Inquiry:** As soon as you determine something is "enough," get it out the door. Releasing the work is the only way to avoid the physical burden of stress.

`;
  }
  if (chart.planets.chiron) {
    hasAdvanced = true;
    advancedText += `### \u{1F3F9} The Surgical Wound: Chiron
`;
    advancedText += `Chiron highlights where our wounds are most precise. `;
    if (chart.planets.chiron.house === 10) {
      advancedText += `With this in your field of Authority, you may feel public scrutiny is a recurring pain. Your path is to own your story so completely that the public "theatrics" no longer have power over your internal peace. `;
    }
    if (chart.planets.chiron.house === 12) {
      advancedText += `In the field of Isolation, your wound feels "hidden" or "weird." Accept this as your power\u2014you are a bridge between the seen and unseen worlds. `;
    }
    advancedText += `Chiron is simply there to be felt and eventually integrated into your authority.

`;
  }
  if (hasAdvanced) {
    sections.push({ title: "Mechanics of Integration", content: advancedText, icon: "\u{1F9EA}" });
  }
  if (aspects && aspects.length > 0) {
    const aspSection = writeAspectSection(aspects);
    if (aspSection) sections.push(aspSection);
  }
  sections.push(writeTransitSection(chart, currentDate));
  let acText = `Astrology doesn't just happen in time; it happens in **Location**. This is the art of Astrocartography.

`;
  acText += `**Relocation Insight:** If you've been thinking about moving, remember that someone might tell you to "move to your Venus line" or "move to your Jupiter line" because they sound amazing. While these lines *can* be incredible for love and expansion, you must beware that many generic astrology books are inaccurate. You have to consider the aspects\u2014if Neptune is negatively aspecting your Venus, that line might bring more fog than love.

`;
  if (chart.planets.sun && chart.planets.moon && asc) {
    const pofLong = (asc.longitude + (chart.planets.moon.longitude - chart.planets.sun.longitude) + 360) % 360;
    const pofDeg = pofLong % 30;
    if (pofDeg >= 15.5 && pofDeg <= 16.5) {
      acText += `**Important Orb Note:** Your Part of Fortune is at 16 degrees. In relocation work, it is important to note that this is **out of the orb of influence** (which cuts off at 15 degrees). Since these are mathematical points, we have to be precise. You'll want to consider if moving east moves your Part of Fortune into a sextile with your Ascendant, which would unlock inherent luck in sales and local communication.

`;
    }
  }
  acText += `**Teacher Voice:** It's really important to know that this is supposed to be fun! The longer you stay in a location, the more these lines activate. But remember: if you haven't dealt with your inner issues, relocation astrology won't fix them\u2014it will just relocate the issues.
`;
  sections.push({ title: "Location & Relocation (Astrocartography)", content: acText, icon: "\u{1F30D}" });
  let text = `Welcome to the family. I am so happy you are here and taking this step to understand your energetic blueprint. Remember that this is not about "fortune telling"\u2014it is about **Alchemy**. It is about taking the cards you were dealt and learning how to play them at the highest level.

`;
  text += `Stay in the work. Join the vibe tribe. And most importantly, keep using this map to navigate your own evolution.

`;
  text += `Talk soon,

The Alchemistic Astrology Team`;
  const bTime = birthData.time || "12:00";
  const bDate = /* @__PURE__ */ new Date(`${birthData.date}T${bTime}`);
  const displayDate = !isNaN(bDate.getTime()) ? bDate.toLocaleDateString("en-US", { weekday: "long", year: "numeric", month: "long", day: "numeric" }) : birthData.date;
  const displayTime = !isNaN(bDate.getTime()) ? bDate.toLocaleTimeString("en-US", { hour: "numeric", minute: "2-digit", hour12: true }) : birthData.time;
  return {
    title: `${name}'s Astrological Blueprint`,
    subtitle: `${cap(chart.planets.sun.sign)} Sun . ${cap(chart.planets.moon.sign)} Moon . ${cap(asc.sign)} Rising`,
    name,
    gender,
    sections,
    birthInfo: {
      date: displayDate,
      time: displayTime,
      location: birthData.locationName
    },
    generatedDate: currentDate.toLocaleDateString("en-US", { weekday: "long", year: "numeric", month: "long", day: "numeric" })
  };
}
function generateDeepReportHTML(report) {
  const isFemale = report.gender === "female";
  const theme = isFemale ? {
    bg: "linear-gradient(135deg, #1a1020 0%, #2d1f3d 30%, #1a1020 100%)",
    accent: "#e8a4c8",
    accent2: "#c084fc",
    accent3: "#f9a8d4",
    gold: "#f0c27f",
    textPrimary: "#f8f0f4",
    textSecondary: "#c9b3c9",
    sectionBg: "rgba(232,164,200,0.06)",
    sectionBorder: "rgba(232,164,200,0.2)",
    headerGradient: "linear-gradient(135deg, #e8a4c8, #c084fc, #f9a8d4)",
    openingBg: "linear-gradient(135deg, rgba(249,168,212,0.1), rgba(192,132,252,0.08))",
    closingBg: "linear-gradient(135deg, rgba(232,164,200,0.12), rgba(249,168,212,0.08))",
    divider: "linear-gradient(90deg, transparent, #e8a4c8, transparent)",
    printBg: "#fdf6f9",
    printText: "#3d2b3a",
    printAccent: "#9b4d7a",
    printGold: "#8b6914",
    printSection: "#faf0f5",
    printBorder: "#e8c4d8"
  } : {
    bg: "linear-gradient(135deg, #0a0e1a 0%, #1a1f3d 30%, #0a0e1a 100%)",
    accent: "#64b5f6",
    accent2: "#90caf9",
    accent3: "#42a5f5",
    gold: "#ffd54f",
    textPrimary: "#e8ecf4",
    textSecondary: "#a0aec0",
    sectionBg: "rgba(100,181,246,0.06)",
    sectionBorder: "rgba(100,181,246,0.2)",
    headerGradient: "linear-gradient(135deg, #ffd54f, #64b5f6, #90caf9)",
    openingBg: "linear-gradient(135deg, rgba(255,213,79,0.1), rgba(100,181,246,0.08))",
    closingBg: "linear-gradient(135deg, rgba(100,181,246,0.12), rgba(255,213,79,0.08))",
    divider: "linear-gradient(90deg, transparent, #64b5f6, transparent)",
    printBg: "#f5f7fa",
    printText: "#1a2332",
    printAccent: "#1e3a5f",
    printGold: "#8b6914",
    printSection: "#eef2f7",
    printBorder: "#c4d4e8"
  };
  const fontImport = isFemale ? `@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&family=Lora:ital,wght@0,400;0,500;1,400&family=Inter:wght@300;400;500&display=swap');` : `@import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;600;700&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&family=Inter:wght@300;400;500&display=swap');`;
  const displayFont = isFemale ? "'Playfair Display', Georgia, serif" : "'Cinzel', 'Times New Roman', serif";
  const bodyFont = isFemale ? "'Lora', Georgia, serif" : "'Source Serif 4', Georgia, serif";
  let html = `<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>${report.title}</title>
<style>
${fontImport}
*{margin:0;padding:0;box-sizing:border-box;}
body{font-family:${bodyFont};font-size:17px;line-height:1.85;color:${theme.textPrimary};background:${theme.bg};padding:0;margin:0;}
.report-wrap{max-width:820px;margin:0 auto;padding:40px 50px 60px;}

/* HEADER */
.report-cover{text-align:center;padding:60px 20px 50px;margin-bottom:50px;border-bottom:2px solid;border-image:${theme.divider} 1;}
.cover-symbol{font-size:4rem;margin-bottom:20px;display:block;opacity:0.8;}
.cover-title{font-family:${displayFont};font-size:2.6rem;font-weight:700;background:${theme.headerGradient};-webkit-background-clip:text;-webkit-text-fill-color:transparent;background-clip:text;letter-spacing:1px;margin-bottom:12px;}
.cover-subtitle{font-family:'Inter',sans-serif;font-size:1rem;color:${theme.textSecondary};letter-spacing:3px;text-transform:uppercase;margin-bottom:20px;}
.cover-info{font-family:'Inter',sans-serif;font-size:0.85rem;color:${theme.textSecondary};padding:15px 25px;background:${theme.sectionBg};border:1px solid ${theme.sectionBorder};border-radius:12px;display:inline-block;}

/* SECTIONS */
.report-section{margin-bottom:45px;page-break-inside:avoid;}
.section-divider{width:60%;height:1px;background:${theme.divider};margin:0 auto 45px;border:none;}
.section-head{display:flex;align-items:center;gap:14px;margin-bottom:20px;padding-bottom:12px;border-bottom:1px solid ${theme.sectionBorder};}
.section-ico{font-size:1.6rem;color:${theme.accent};}
.section-ttl{font-family:${displayFont};font-size:1.4rem;font-weight:600;color:${theme.accent};letter-spacing:0.5px;}
.section-body{text-align:left;padding:0 5px;}
.section-body p{margin-bottom:1em;}
.section-body strong{color:${theme.gold};font-weight:600;}
.section-body em{color:${theme.accent2};font-style:italic;}

/* OPENING/CLOSING special */
.opening-section .section-body,.closing-section .section-body{padding:25px 30px;background:${theme.openingBg};border:1px solid ${theme.sectionBorder};border-radius:12px;font-size:1.05rem;line-height:2;white-space:pre-line;}
.closing-section .section-body{background:${theme.closingBg};}

/* FOOTER */
.report-footer{text-align:center;font-family:'Inter',sans-serif;font-size:0.8rem;color:${theme.textSecondary};margin-top:50px;padding-top:25px;border-top:1px solid ${theme.sectionBorder};}
.report-footer em{color:${theme.accent};}

/* PRINT STYLES - proper margins, minimize whitespace, suppress browser chrome */
@page{margin:0.5in 0.6in;size:auto;}
@media print{
  body{background:${theme.printBg}!important;color:${theme.printText}!important;-webkit-print-color-adjust:exact;print-color-adjust:exact;padding:0;margin:0;}
  .report-wrap{padding:0;max-width:100%;}
  .cover-title{background:none!important;-webkit-text-fill-color:${theme.printAccent}!important;color:${theme.printAccent}!important;font-size:2.2rem;}
  .cover-subtitle{color:${theme.printGold}!important;}
  .cover-info{background:${theme.printSection}!important;border-color:${theme.printBorder}!important;color:${theme.printText}!important;}
  .section-ttl{color:${theme.printAccent}!important;}
  .section-body{color:${theme.printText}!important;}
  .section-body strong{color:${theme.printGold}!important;}
  .section-body em{color:${theme.printAccent}!important;}
  .opening-section .section-body,.closing-section .section-body{background:${theme.printSection}!important;border-color:${theme.printBorder}!important;color:${theme.printText}!important;padding:15px 20px!important;}
  .report-section{page-break-inside:auto;margin-bottom:25px;}
  .section-head{page-break-inside:avoid;page-break-after:avoid;border-color:${theme.printBorder}!important;}
  .section-body p{orphans:3;widows:3;}
  .section-divider{background:${theme.printBorder}!important;margin:15px auto!important;}
  .cover-symbol{filter:grayscale(0.3);}
  .report-cover{page-break-after:avoid;padding:30px 20px 25px!important;margin-bottom:25px!important;}
  .report-footer{color:#888!important;border-color:${theme.printBorder}!important;}
}

/* PRINT BUTTON (hidden when printing) */
.print-bar{position:fixed;top:0;left:0;right:0;background:rgba(0,0,0,0.9);padding:12px 20px;display:flex;justify-content:center;gap:15px;z-index:9999;}
.print-bar button{padding:10px 24px;border:none;border-radius:8px;font-family:'Inter',sans-serif;font-size:0.9rem;cursor:pointer;font-weight:500;}
.print-btn{background:${theme.accent};color:#000;}
.close-btn{background:rgba(255,255,255,0.15);color:#fff;border:1px solid rgba(255,255,255,0.3)!important;}
@media print{.print-bar{display:none!important;}}
</style></head><body>
<div class="print-bar">
  <button class="print-btn" onclick="window.print()">Print / Save as PDF</button>
  <button class="close-btn" onclick="window.close()">Close</button>
</div>
<div class="report-wrap">
  <header class="report-cover">
    <span class="cover-symbol">${isFemale ? "\u2728" : "\u26A1"}</span>
    <h1 class="cover-title">${report.title}</h1>
    <p class="cover-subtitle">${report.subtitle}</p>
    <div class="cover-info">
      <strong>Born:</strong> ${report.birthInfo.date || "N/A"} at ${report.birthInfo.time || "N/A"}<br>
      <strong>Location:</strong> ${report.birthInfo.location || "N/A"}<br>
      <strong>Report Generated:</strong> ${report.generatedDate}
    </div>
  </header>
  <main>`;
  for (let i = 0; i < report.sections.length; i++) {
    const s = report.sections[i];
    if (i > 0) html += `<hr class="section-divider">`;
    const cls = s.isOpening ? " opening-section" : s.isClosing ? " closing-section" : "";
    let content = s.content.replace(/\*\*(.*?)\*\*/g, "<strong>$1</strong>").replace(/\*(.*?)\*/g, "<em>$1</em>").replace(/\n\n/g, "</p><p>").replace(/\n/g, "<br>");
    if (!content.startsWith("<p>")) content = "<p>" + content + "</p>";
    html += `
    <section class="report-section${cls}">
      <div class="section-head">
        <span class="section-ico">${s.icon}</span>
        <h2 class="section-ttl">${s.title}</h2>
      </div>
      <div class="section-body">${content}</div>
    </section>`;
  }
  html += `
  </main>
  <footer class="report-footer">
    Report generated on ${report.generatedDate}<br>
    <em>Readings-Astrology . ADS/FREE Theory Chart Engine</em><br>
    <small>Based on Alchemistic Astrology principles. This is an energetic blueprint, not a prediction.</small>
  </footer>
</div></body></html>`;
  return html;
}
export {
  ANALYSIS_ROUTING,
  CAREER_LENS,
  CHILDREN_LENS,
  COURSE_3_ASPECTS,
  ChatEngine,
  DECANS,
  DISCOVERY_CATEGORIES,
  FOLLOW_UP_QUESTIONS,
  HOUSE_THEMES,
  LENSES_PHILOSOPHY,
  LOVE_LENS,
  MAJOR_ASPECTS,
  MOTION_STATES,
  PLANETARY_ORBS,
  PLANETARY_TIERS,
  PLANET_SYMBOLS,
  PLANET_TO_TIER,
  SIGN_ELEMENTS,
  SIGN_MODALITIES,
  SIGN_RULERS,
  SIGN_SYMBOLS,
  SessionContext,
  TRANSCRIPT_KNOWLEDGE,
  ZODIAC_SIGNS,
  analyzeAspect,
  buildAnalysisPlan,
  calculateAllPlanets,
  calculateAscendant,
  calculateLST,
  calculateManifestationProfile,
  calculateMidheaven,
  calculateMoneyProfile,
  calculateWholeSignHouses,
  checkAspect,
  checkCluster,
  dateToAstroTime,
  determineAspectPhase,
  findAllAspects,
  generateDeepReport,
  generateDeepReportHTML,
  generateFocusedReading,
  generateNatalChart,
  generateProfileReport,
  generateReportHTML,
  getDecan,
  getDegreeInSign,
  getGeocentricLongitude,
  getHouseFromLongitude,
  getMotionState,
  getSignFromLongitude,
  inferPlanFromQuestion,
  interpretAngles,
  interpretFullChart,
  interpretPlacement,
  normalizeDegrees,
  searchKnowledge,
  traceRulership
};
/*! Bundled license information:

astronomy-engine/esm/astronomy.js:
  (**
      @preserve
  
      Astronomy library for JavaScript (browser and Node.js).
      https://github.com/cosinekitty/astronomy
  
      MIT License
  
      Copyright (c) 2019-2023 Don Cross <cosinekitty@gmail.com>
  
      Permission is hereby granted, free of charge, to any person obtaining a copy
      of this software and associated documentation files (the "Software"), to deal
      in the Software without restriction, including without limitation the rights
      to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
      copies of the Software, and to permit persons to whom the Software is
      furnished to do so, subject to the following conditions:
  
      The above copyright notice and this permission notice shall be included in all
      copies or substantial portions of the Software.
  
      THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
      IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
      FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
      AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
      LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
      OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
      SOFTWARE.
  *)
  (**
   * @fileoverview Astronomy calculation library for browser scripting and Node.js.
   * @author Don Cross <cosinekitty@gmail.com>
   * @license MIT
   *)
*/
